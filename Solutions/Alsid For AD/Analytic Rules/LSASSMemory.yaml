id: 3acf5617-7c41-4085-9a79-cc3a425ba83a
name: Alsid LSASS Memory
description: |
    'Searches for OS Credentials dumping attacks'
severity: High
requiredDataConnectors:
  - connectorId: AlsidForAD
    dataTypes:
      - AlsidForADLog_CL
queryFrequency: 2h
queryPeriod: 2h
triggerOperator: gt
triggerThreshold: 0
status: Available
tactics:
  - CredentialAccess
relevantTechniques:
  - T1003.001
query: |
    afad_parser
    | where MessageType == 2 and Codename == "OS Credential Dumping: LSASS Memory"
    | extend SrcHostName = tostring(split(SourceHostname, '.', 0)[0]), SrcDnsDomain = tostring(strcat_array(array_slice(split(SourceHostname, '.'), 1, -1), '.'))
    | extend DstHostName = tostring(split(DestinationHostname, '.', 0)[0]), DstDnsDomain = tostring(strcat_array(array_slice(split(DestinationHostname, '.'), 1, -1), '.'))
entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: SrcHostName
      - identifier: DnsDomain
        columnName: SrcDnsDomain
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: DstHostName
      - identifier: DnsDomain
        columnName: DstDnsDomain
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
  - entityType: IP
      - identifier: Address
        columnName: DestinationIP
version: 1.0.1
kind: Scheduled