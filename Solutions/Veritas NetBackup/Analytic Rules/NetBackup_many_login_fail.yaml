id: d39f0c47-2e85-49b9-a686-388c2eb7062c
name: NetBackup Too many failed login attempt
version: 1.0.0
kind: Scheduled
description: This rule will generate an incident if for a given host there are more than 5 failed login attemts in a last 1 hour timespan
severity: Medium
queryFrequency: 5m
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
- CredentialAccess
- Discovery
relevantTechniques:
- T1110
- T1212
query: |-
  let time_span = ago(60m);
  NetBackupAlerts_CL
  | where operation_s contains "LOGIN" and Message contains "authentication failed" 
  | extend userName =  split(userName_s, "@")[0] | extend host = 
  split(userName_s, "@")[1] 
  | where TimeGenerated >= time_span
  | summarize count() by tostring(host)
entityMappings:
- entityType: Host
  fieldMappings:
  - identifier: HostName
    columnName: host
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: false
    reopenClosedIncident: false
    lookbackDuration: 5h
    matchingMethod: AllEntities
    groupByEntities: []
    groupByAlertDetails: []
    groupByCustomDetails: []
suppressionDuration: 5h
eventGroupingSettings:
  aggregationKind: SingleAlert

