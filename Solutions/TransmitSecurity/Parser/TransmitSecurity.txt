  let parser = (
      starttime:datetime=datetime(null), 
      endtime:datetime=datetime(null), 
      tablesRequired:dynamic=dynamic([]), 
      eventTypesRequired:dynamic=dynamic([])
  )
  {
      union isfuzzy=true
      (
          TransmitSecurityUserActivity
          | where array_length(tablesRequired) == 0 or "UserActivity" in~ (tablesRequired)
          | where (isnull(starttime) or timestamp >= starttime)
                and (isnull(endtime) or timestamp <= endtime)
          | where array_length(eventTypesRequired) == 0 or activity in~ (eventTypesRequired)
      ),
      (
          TransmitSecurityAdminActivity
          | where array_length(tablesRequired) == 0 or "AdminActivity" in~ (tablesRequired)
          | where (isnull(starttime) or timestamp >= starttime)
                and (isnull(endtime) or timestamp <= endtime)
          | where array_length(eventTypesRequired) == 0 or activity in~ (eventTypesRequired)
      )
  };
  parser(
      starttime=starttime, 
      endtime=endtime, 
      tablesRequired=tablesRequired, 
      eventTypesRequired=eventTypesRequired
  )
