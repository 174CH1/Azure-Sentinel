let parser = (
    starttime:datetime=datetime(null), 
    endtime:datetime=datetime(null), 
    tablesRequired:dynamic=dynamic([]), 
    eventTypesRequired:dynamic=dynamic([])
)
{
    union isfuzzy=true
    (
        TransmitSecurityEvents_CL
        | where array_length(tablesRequired) == 0 or "UserActivity" in~ (tablesRequired)
        | where isnull(starttime) or timestamp_t >= starttime
        | where isnull(endtime) or timestamp_t <= endtime
        | where array_length(eventTypesRequired) == 0 or activity_s in~ (eventTypesRequired)
    ),
    (
        TransmitSecurityEvents_CL
        | where array_length(tablesRequired) == 0 or "AdminActivity" in~ (tablesRequired)
        | where isnull(starttime) or timestamp_t >= starttime
        | where isnull(endtime) or timestamp_t <= endtime
        | where array_length(eventTypesRequired) == 0 or activity_s in~ (eventTypesRequired)
    )
};
  parser(
      starttime=starttime, 
      endtime=endtime, 
      tablesRequired=tablesRequired, 
      eventTypesRequired=eventTypesRequired
  )
