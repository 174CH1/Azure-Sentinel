{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Recorded Future Premier Integrations - support@recordedfuture.com",
    "comments": "Solution template for Recorded Future"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "Recorded Future - Playbook Alerts Overview",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook2-name": {
      "type": "string",
      "defaultValue": "Recorded Future - Alerts Overview",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook3-name": {
      "type": "string",
      "defaultValue": "Recorded Future - Domain Correlation",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook4-name": {
      "type": "string",
      "defaultValue": "Recorded Future - Hash Correlation",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook5-name": {
      "type": "string",
      "defaultValue": "Recorded Future - IP Correlation",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook6-name": {
      "type": "string",
      "defaultValue": "Recorded Future - URL Correlation",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    },
    "workbook7-name": {
      "type": "string",
      "defaultValue": "Recorded Future Threat Actor Hunting",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "support@recordedfuture.com",
    "_email": "[variables('email')]",
    "_solutionName": "Recorded Future",
    "_solutionVersion": "3.1.0",
    "solutionId": "recordedfuture1605638642586.recorded_future_sentinel_solution",
    "_solutionId": "[variables('solutionId')]",
    "analyticRuleVersion1": "1.0.1",
    "analyticRulecontentId1": "a1c02815-4248-4728-a9ae-dac73c67db23",
    "_analyticRulecontentId1": "[variables('analyticRulecontentId1')]",
    "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId1'))]",
    "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId1'))))]",
    "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId1'),'-', variables('analyticRuleVersion1'))))]",
    "analyticRuleVersion2": "1.0.1",
    "analyticRulecontentId2": "dffd068f-fdab-440e-bbc0-34c14b623c89",
    "_analyticRulecontentId2": "[variables('analyticRulecontentId2')]",
    "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId2'))]",
    "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId2'))))]",
    "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId2'),'-', variables('analyticRuleVersion2'))))]",
    "analyticRuleVersion3": "1.0.0",
    "analyticRulecontentId3": "388e197d-ec9e-46b6-addb-947d74d2a5c4",
    "_analyticRulecontentId3": "[variables('analyticRulecontentId3')]",
    "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId3'))]",
    "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId3'))))]",
    "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId3'),'-', variables('analyticRuleVersion3'))))]",
    "analyticRuleVersion4": "1.0.0",
    "analyticRulecontentId4": "588dc717-7583-452c-a743-dee96705898e",
    "_analyticRulecontentId4": "[variables('analyticRulecontentId4')]",
    "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId4'))]",
    "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId4'))))]",
    "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId4'),'-', variables('analyticRuleVersion4'))))]",
    "analyticRuleVersion5": "1.0.0",
    "analyticRulecontentId5": "22cc1dff-14ad-481d-97e1-0602895e429e",
    "_analyticRulecontentId5": "[variables('analyticRulecontentId5')]",
    "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId5'))]",
    "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId5'))))]",
    "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId5'),'-', variables('analyticRuleVersion5'))))]",
    "analyticRuleVersion6": "1.0.0",
    "analyticRulecontentId6": "9acb3664-72c4-4676-80fa-9f81912e347e",
    "_analyticRulecontentId6": "[variables('analyticRulecontentId6')]",
    "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', variables('analyticRulecontentId6'))]",
    "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring(variables('_analyticRulecontentId6'))))]",
    "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-',variables('_analyticRulecontentId6'),'-', variables('analyticRuleVersion6'))))]",
    "parserName1": "RecordedFutureThreatHuntingHashAllActors",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1'))))]",
    "parserVersion1": "1.0.0",
    "parserContentId1": "RecordedFutureThreatHuntingHashAllActors-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "_parsercontentProductId1": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId1'),'-', variables('parserVersion1'))))]",
    "parserName2": "RecordedFutureThreatHuntingIPAllActors",
    "_parserName2": "[concat(parameters('workspace'),'/',variables('parserName2'))]",
    "parserId2": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
    "_parserId2": "[variables('parserId2')]",
    "parserTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId2'))))]",
    "parserVersion2": "1.0.0",
    "parserContentId2": "RecordedFutureThreatHuntingIPAllActors-Parser",
    "_parserContentId2": "[variables('parserContentId2')]",
    "_parsercontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId2'),'-', variables('parserVersion2'))))]",
    "parserName3": "RecordedFutureThreatHuntingDomainAllActors",
    "_parserName3": "[concat(parameters('workspace'),'/',variables('parserName3'))]",
    "parserId3": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
    "_parserId3": "[variables('parserId3')]",
    "parserTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId3'))))]",
    "parserVersion3": "1.0.0",
    "parserContentId3": "RecordedFutureThreatHuntingDomainAllActors-Parser",
    "_parserContentId3": "[variables('parserContentId3')]",
    "_parsercontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId3'),'-', variables('parserVersion3'))))]",
    "parserName4": "RecordedFutureThreatHuntingUrlAllActors",
    "_parserName4": "[concat(parameters('workspace'),'/',variables('parserName4'))]",
    "parserId4": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
    "_parserId4": "[variables('parserId4')]",
    "parserTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId4'))))]",
    "parserVersion4": "1.0.0",
    "parserContentId4": "RecordedFutureThreatHuntingUrlAllActors-Parser",
    "_parserContentId4": "[variables('parserContentId4')]",
    "_parsercontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId4'),'-', variables('parserVersion4'))))]",
    "parserName5": "RecordedFutureIPThreatActorHunt",
    "_parserName5": "[concat(parameters('workspace'),'/',variables('parserName5'))]",
    "parserId5": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName5'))]",
    "_parserId5": "[variables('parserId5')]",
    "parserTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId5'))))]",
    "parserVersion5": "1.0.0",
    "parserContentId5": "RecordedFutureIPThreatActorHunt-Parser",
    "_parserContentId5": "[variables('parserContentId5')]",
    "_parsercontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId5'),'-', variables('parserVersion5'))))]",
    "parserName6": "RecordedFutureHashThreatActorHunt",
    "_parserName6": "[concat(parameters('workspace'),'/',variables('parserName6'))]",
    "parserId6": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName6'))]",
    "_parserId6": "[variables('parserId6')]",
    "parserTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId6'))))]",
    "parserVersion6": "1.0.0",
    "parserContentId6": "RecordedFutureHashThreatActorHunt-Parser",
    "_parserContentId6": "[variables('parserContentId6')]",
    "_parsercontentProductId6": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId6'),'-', variables('parserVersion6'))))]",
    "parserName7": "RecordedFutureUrlThreatActorHunt",
    "_parserName7": "[concat(parameters('workspace'),'/',variables('parserName7'))]",
    "parserId7": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName7'))]",
    "_parserId7": "[variables('parserId7')]",
    "parserTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId7'))))]",
    "parserVersion7": "1.0.0",
    "parserContentId7": "RecordedFutureUrlThreatActorHunt-Parser",
    "_parserContentId7": "[variables('parserContentId7')]",
    "_parsercontentProductId7": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId7'),'-', variables('parserVersion7'))))]",
    "parserName8": "RecordedFutureDomainThreatActorHunt",
    "_parserName8": "[concat(parameters('workspace'),'/',variables('parserName8'))]",
    "parserId8": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName8'))]",
    "_parserId8": "[variables('parserId8')]",
    "parserTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId8'))))]",
    "parserVersion8": "1.0.0",
    "parserContentId8": "RecordedFutureDomainThreatActorHunt-Parser",
    "_parserContentId8": "[variables('parserContentId8')]",
    "_parsercontentProductId8": "[concat(take(variables('_solutionId'),50),'-','pr','-', uniqueString(concat(variables('_solutionId'),'-','Parser','-',variables('_parserContentId8'),'-', variables('parserVersion8'))))]",
    "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
    "_RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash": "[variables('RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash')]",
    "playbookVersion1": "2.5",
    "playbookContentId1": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookId1": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "RecordedFuture-Sandbox_Enrichment-Url": "RecordedFuture-Sandbox_Enrichment-Url",
    "_RecordedFuture-Sandbox_Enrichment-Url": "[variables('RecordedFuture-Sandbox_Enrichment-Url')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "RecordedFuture-Sandbox_Enrichment-Url",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "RecordedFuture-Playbook-Alert-Importer": "RecordedFuture-Playbook-Alert-Importer",
    "_RecordedFuture-Playbook-Alert-Importer": "[variables('RecordedFuture-Playbook-Alert-Importer')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "RecordedFuture-Playbook-Alert-Importer",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "RecordedFuture-Alert-Importer": "RecordedFuture-Alert-Importer",
    "_RecordedFuture-Alert-Importer": "[variables('RecordedFuture-Alert-Importer')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "RecordedFuture-Alert-Importer",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "RecordedFuture-ThreatIntelligenceImport": "RecordedFuture-ThreatIntelligenceImport",
    "_RecordedFuture-ThreatIntelligenceImport": "[variables('RecordedFuture-ThreatIntelligenceImport')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "RecordedFuture-ThreatIntelligenceImport",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5'))))]",
    "_playbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId5'),'-', variables('playbookVersion5'))))]",
    "RecordedFuture-Domain-IndicatorImport": "RecordedFuture-Domain-IndicatorImport",
    "_RecordedFuture-Domain-IndicatorImport": "[variables('RecordedFuture-Domain-IndicatorImport')]",
    "playbookVersion6": "1.0",
    "playbookContentId6": "RecordedFuture-Domain-IndicatorImport",
    "_playbookContentId6": "[variables('playbookContentId6')]",
    "playbookId6": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
    "playbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId6'))))]",
    "_playbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId6'),'-', variables('playbookVersion6'))))]",
    "RecordedFuture-Hash-IndicatorImport": "RecordedFuture-Hash-IndicatorImport",
    "_RecordedFuture-Hash-IndicatorImport": "[variables('RecordedFuture-Hash-IndicatorImport')]",
    "playbookVersion7": "1.0",
    "playbookContentId7": "RecordedFuture-Hash-IndicatorImport",
    "_playbookContentId7": "[variables('playbookContentId7')]",
    "playbookId7": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId7'))]",
    "playbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId7'))))]",
    "_playbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId7'),'-', variables('playbookVersion7'))))]",
    "RecordedFuture-IP-IndicatorImport": "RecordedFuture-IP-IndicatorImport",
    "_RecordedFuture-IP-IndicatorImport": "[variables('RecordedFuture-IP-IndicatorImport')]",
    "playbookVersion8": "1.0",
    "playbookContentId8": "RecordedFuture-IP-IndicatorImport",
    "_playbookContentId8": "[variables('playbookContentId8')]",
    "playbookId8": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId8'))]",
    "playbookTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId8'))))]",
    "_playbookcontentProductId8": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId8'),'-', variables('playbookVersion8'))))]",
    "RecordedFuture-URL-IndicatorImport": "RecordedFuture-URL-IndicatorImport",
    "_RecordedFuture-URL-IndicatorImport": "[variables('RecordedFuture-URL-IndicatorImport')]",
    "playbookVersion9": "1.0",
    "playbookContentId9": "RecordedFuture-URL-IndicatorImport",
    "_playbookContentId9": "[variables('playbookContentId9')]",
    "playbookId9": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId9'))]",
    "playbookTemplateSpecName9": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId9'))))]",
    "_playbookcontentProductId9": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId9'),'-', variables('playbookVersion9'))))]",
    "RecordedFuture-ImportToSentinel": "RecordedFuture-ImportToSentinel",
    "_RecordedFuture-ImportToSentinel": "[variables('RecordedFuture-ImportToSentinel')]",
    "playbookVersion10": "1.1",
    "playbookContentId10": "RecordedFuture-ImportToSentinel",
    "_playbookContentId10": "[variables('playbookContentId10')]",
    "playbookId10": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId10'))]",
    "playbookTemplateSpecName10": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId10'))))]",
    "_playbookcontentProductId10": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId10'),'-', variables('playbookVersion10'))))]",
    "RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor": "RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor",
    "_RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor": "[variables('RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor')]",
    "playbookVersion11": "1.1",
    "playbookContentId11": "RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor",
    "_playbookContentId11": "[variables('playbookContentId11')]",
    "playbookId11": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId11'))]",
    "playbookTemplateSpecName11": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId11'))))]",
    "_playbookcontentProductId11": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId11'),'-', variables('playbookVersion11'))))]",
    "RecordedFuture-HASH-Observed_in_Underground_Virus_Test_Sites-IndicatorProcessor": "RecordedFuture-HASH-Observed_in_Underground_Virus_Test_Sites-IndicatorProcessor",
    "_RecordedFuture-HASH-Observed_in_Underground_Virus_Test_Sites-IndicatorProcessor": "[variables('RecordedFuture-HASH-Observed_in_Underground_Virus_Test_Sites-IndicatorProcessor')]",
    "playbookVersion12": "1.1",
    "playbookContentId12": "RecordedFuture-HASH-Observed_in_Underground_Virus_Test_Sites-IndicatorProcessor",
    "_playbookContentId12": "[variables('playbookContentId12')]",
    "playbookId12": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId12'))]",
    "playbookTemplateSpecName12": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId12'))))]",
    "_playbookcontentProductId12": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId12'),'-', variables('playbookVersion12'))))]",
    "RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor": "RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor",
    "_RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor": "[variables('RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor')]",
    "playbookVersion13": "1.1",
    "playbookContentId13": "RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor",
    "_playbookContentId13": "[variables('playbookContentId13')]",
    "playbookId13": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId13'))]",
    "playbookTemplateSpecName13": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId13'))))]",
    "_playbookcontentProductId13": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId13'),'-', variables('playbookVersion13'))))]",
    "RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor": "RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor",
    "_RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor": "[variables('RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor')]",
    "playbookVersion14": "1.1",
    "playbookContentId14": "RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor",
    "_playbookContentId14": "[variables('playbookContentId14')]",
    "playbookId14": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId14'))]",
    "playbookTemplateSpecName14": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId14'))))]",
    "_playbookcontentProductId14": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId14'),'-', variables('playbookVersion14'))))]",
    "RecordedFuture-Ukraine-IndicatorProcessor": "RecordedFuture-Ukraine-IndicatorProcessor",
    "_RecordedFuture-Ukraine-IndicatorProcessor": "[variables('RecordedFuture-Ukraine-IndicatorProcessor')]",
    "playbookVersion15": "1.1",
    "playbookContentId15": "RecordedFuture-Ukraine-IndicatorProcessor",
    "_playbookContentId15": "[variables('playbookContentId15')]",
    "playbookId15": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId15'))]",
    "playbookTemplateSpecName15": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId15'))))]",
    "_playbookcontentProductId15": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId15'),'-', variables('playbookVersion15'))))]",
    "RecordedFuture-Azure-Connector": "RecordedFuture-Azure-Connector",
    "_RecordedFuture-Azure-Connector": "[variables('RecordedFuture-Azure-Connector')]",
    "TemplateEmptyArray": "[json('[]')]",
    "playbookVersion16": "1.0",
    "playbookContentId16": "RecordedFuture-Azure-Connector",
    "_playbookContentId16": "[variables('playbookContentId16')]",
    "playbookTemplateSpecName16": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId16'))))]",
    "_playbookcontentProductId16": "[concat(take(variables('_solutionId'),50),'-','lc','-', uniqueString(concat(variables('_solutionId'),'-','LogicAppsCustomConnector','-',variables('_playbookContentId16'),'-', variables('playbookVersion16'))))]",
    "RecordedFuture-ThreatMap-Importer": "RecordedFuture-ThreatMap-Importer",
    "_RecordedFuture-ThreatMap-Importer": "[variables('RecordedFuture-ThreatMap-Importer')]",
    "playbookVersion17": "1.0",
    "playbookContentId17": "RecordedFuture-ThreatMap-Importer",
    "_playbookContentId17": "[variables('playbookContentId17')]",
    "playbookId17": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId17'))]",
    "playbookTemplateSpecName17": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId17'))))]",
    "_playbookcontentProductId17": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId17'),'-', variables('playbookVersion17'))))]",
    "RecordedFuture-ThreatHunt-IndicatorImport": "RecordedFuture-ThreatHunt-IndicatorImport",
    "_RecordedFuture-ThreatHunt-IndicatorImport": "[variables('RecordedFuture-ThreatHunt-IndicatorImport')]",
    "blanks": "[replace('b', 'b', '')]",
    "playbookVersion18": "1.0",
    "playbookContentId18": "RecordedFuture-ThreatHunt-IndicatorImport",
    "_playbookContentId18": "[variables('playbookContentId18')]",
    "playbookId18": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId18'))]",
    "playbookTemplateSpecName18": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId18'))))]",
    "_playbookcontentProductId18": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId18'),'-', variables('playbookVersion18'))))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "RecordedFuturePlaybookAlertOverviewWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "workbookVersion2": "1.0.0",
    "workbookContentId2": "RecordedFutureAlertOverviewWorkbook",
    "workbookId2": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId2'))]",
    "workbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId2'))))]",
    "_workbookContentId2": "[variables('workbookContentId2')]",
    "_workbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId2'),'-', variables('workbookVersion2'))))]",
    "workbookVersion3": "1.0.1",
    "workbookContentId3": "RecordedFutureDomainCorrelationWorkbook",
    "workbookId3": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId3'))]",
    "workbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId3'))))]",
    "_workbookContentId3": "[variables('workbookContentId3')]",
    "_workbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId3'),'-', variables('workbookVersion3'))))]",
    "workbookVersion4": "1.0.1",
    "workbookContentId4": "RecordedFutureHashCorrelationWorkbook",
    "workbookId4": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId4'))]",
    "workbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId4'))))]",
    "_workbookContentId4": "[variables('workbookContentId4')]",
    "_workbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId4'),'-', variables('workbookVersion4'))))]",
    "workbookVersion5": "1.0.1",
    "workbookContentId5": "RecordedFutureIPCorrelationWorkbook",
    "workbookId5": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId5'))]",
    "workbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId5'))))]",
    "_workbookContentId5": "[variables('workbookContentId5')]",
    "_workbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId5'),'-', variables('workbookVersion5'))))]",
    "workbookVersion6": "1.0.1",
    "workbookContentId6": "RecordedFutureURLCorrelationWorkbook",
    "workbookId6": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId6'))]",
    "workbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId6'))))]",
    "_workbookContentId6": "[variables('workbookContentId6')]",
    "_workbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId6'),'-', variables('workbookVersion6'))))]",
    "workbookVersion7": "1.0.0",
    "workbookContentId7": "RecordedFutureThreatActorHuntingWorkbook",
    "workbookId7": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId7'))]",
    "workbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId7'))))]",
    "_workbookContentId7": "[variables('workbookContentId7')]",
    "_workbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId7'),'-', variables('workbookVersion7'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureDomainMalwareC2inDNSEvents_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId1')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies a match in DNSEvents from Recorded Future C2 DNS Name Domains Risklist.",
                "displayName": "Detection of Malware C2 Domains in DNS Events",
                "enabled": false,
                "query": "// Identifies a match in DnsEvent from the Recorded Future DOMAIN Malware C2 DNS Name \nlet dt_lookBack = 1h;\nlet ioc_lookBack = 1d;\n//Create a list of TLDs in our threat feed for later validation\nlet list_tlds = ThreatIntelligenceIndicator\n| where TimeGenerated > ago(ioc_lookBack)\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\n| where Description == 'Recorded Future - Domains - Command and Control Activity'\n| where isnotempty(DomainName)\n| extend parts = split(DomainName, '.')\n| extend tld = parts[(array_length(parts)-1)]\n| summarize count() by tostring(tld)\n| summarize make_list(tld);\nThreatIntelligenceIndicator\n| where TimeGenerated >= ago(ioc_lookBack) and ExpirationDateTime > now()\n| where Active == true\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\n| where Description == 'Recorded Future - Domains - Command and Control Activity'\n// Picking up only IOC's that contain the entities we want\n| where isnotempty(DomainName)\n| join (\n  DnsEvents\n  | where TimeGenerated > ago(dt_lookBack)\n  //Extract Domain patterns from syslog message\n  | where isnotempty(Name)\n  | extend parts = split(Name, '.')\n  //Split out the TLD\n  | extend tld = parts[(array_length(parts)-1)]\n  //Validate parsed Domain by checking if the TLD is in the list of TLDs in our threat feed\n  | where tld in~ (list_tlds)\n  | extend DNS_TimeGenerated = TimeGenerated\n  ) \non $left.DomainName==$right.Name\n| where DNS_TimeGenerated >= TimeGenerated and DNS_TimeGenerated < ExpirationDateTime\n| summarize LatestIndicatorTime = arg_max(TimeGenerated, *) by IndicatorId\n| project LatestIndicatorTime, DomainName, Description, ConfidenceScore, AdditionalInformation, ActivityGroupNames, IndicatorId, ThreatType, ExpirationDateTime, DNS_TimeGenerated, Computer, ClientIP, Name, QueryType\n| extend timestamp = DNS_TimeGenerated, HostCustomEntity = Computer, IPCustomEntity = ClientIP, DomainCustomEntity = DomainName\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "DnsEvents"
                    ],
                    "connectorId": "DNS"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "DomainCustomEntity",
                        "identifier": "DomainName"
                      }
                    ],
                    "entityType": "DNS"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId1'),'/'))))]",
              "properties": {
                "description": "Recorded Future Analytics Rule 1",
                "parentId": "[variables('analyticRuleId1')]",
                "contentId": "[variables('_analyticRulecontentId1')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId1')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Detection of Malware C2 Domains in DNS Events",
        "contentProductId": "[variables('_analyticRulecontentProductId1')]",
        "id": "[variables('_analyticRulecontentProductId1')]",
        "version": "[variables('analyticRuleVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureDomainMalwareC2inSyslogEvents_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId2')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies a match in Syslog from Recorded Future C2 DNS Name Domains Risklist.",
                "displayName": "Detection of Malware C2 Domains in Syslog Events",
                "enabled": false,
                "query": "// Identifies a match in Syslog from the Recorded Future DOMAIN Malware C2 DNS Name \nlet dt_lookBack = 1h;\nlet ioc_lookBack = 1d;\n//Create a list of TLDs in our threat feed for later validation\nlet list_tlds = ThreatIntelligenceIndicator\n| where TimeGenerated > ago(ioc_lookBack)\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\n| where Description == 'Recorded Future - Domains - Command and Control Activity'\n| where isnotempty(DomainName)\n| extend parts = split(DomainName, '.')\n| extend tld = parts[(array_length(parts)-1)]\n| summarize count() by tostring(tld)\n| summarize make_list(tld);\nThreatIntelligenceIndicator\n| where TimeGenerated >= ago(ioc_lookBack) and ExpirationDateTime > now()\n| where Active == true\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\n| where Description == 'Recorded Future - Domains - Command and Control Activity'\n// Picking up only IOC's that contain the entities we want\n| where isnotempty(DomainName)\n| join (\n  Syslog\n  | where TimeGenerated > ago(dt_lookBack)\n  //Extract domain patterns from syslog message\n  | extend domain = extract(\"(([a-z0-9]+(-[a-z0-9]+)*\\\\.)+[a-z]{2,})\",1, tolower(SyslogMessage))\n  | where isnotempty(domain)\n  | extend parts = split(domain, '.')\n  //Split out the TLD\n  | extend tld = parts[(array_length(parts)-1)]\n  //Validate parsed domain by checking if the TLD is in the list of TLDs in our threat feed\n  | where tld in~ (list_tlds)\n  | extend Syslog_TimeGenerated = TimeGenerated\n  ) \non $left.DomainName==$right.domain\n| where Syslog_TimeGenerated >= TimeGenerated and Syslog_TimeGenerated < ExpirationDateTime\n| summarize LatestIndicatorTime = arg_max(TimeGenerated, *) by IndicatorId\n| project LatestIndicatorTime, Description, ActivityGroupNames, IndicatorId, ThreatType, ExpirationDateTime, ConfidenceScore, Syslog_TimeGenerated, SyslogMessage, Computer, ProcessName, domain, HostIP, Url\n| extend timestamp = Syslog_TimeGenerated, HostCustomEntity = Computer, IPCustomEntity = HostIP, URLCustomEntity = Url\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Syslog"
                    ],
                    "connectorId": "Syslog"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "URLCustomEntity",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "domain",
                        "identifier": "DomainName"
                      }
                    ],
                    "entityType": "DNS"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId2'),'/'))))]",
              "properties": {
                "description": "Recorded Future Analytics Rule 2",
                "parentId": "[variables('analyticRuleId2')]",
                "contentId": "[variables('_analyticRulecontentId2')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId2')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Detection of Malware C2 Domains in Syslog Events",
        "contentProductId": "[variables('_analyticRulecontentProductId2')]",
        "id": "[variables('_analyticRulecontentProductId2')]",
        "version": "[variables('analyticRuleVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureHashObservedInUndergroundinCommonSecurityLog_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId3')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies a match in CommonSecurityLog from Recorded Future Hash Observed in Underground Virus Testing Sites RiskList.",
                "displayName": "Detection of Specific Hashes in CommonSecurityLog",
                "enabled": false,
                "query": "// Identifies a match in CommonSecurityLog from the Recorded Future Hashes Observed in Underground Virus Testing Sites\nlet dt_lookBack = 1h;\nlet ioc_lookBack = 1d;\nlet fileHashIndicators = ThreatIntelligenceIndicator\n| where TimeGenerated >= ago(ioc_lookBack) and ExpirationDateTime > now()\n// Picking up only Recorded Future IOC's that have been observed in undersground testing sites\n| where Description == \"Recorded Future - HASH - Observed in Underground Virus Testing Sites\"\n| where Active == true\n| where isnotempty(FileHashValue);\n// Handle matches against both lower case and uppercase versions of the hash:\n(fileHashIndicators | extend  FileHashValue = tolower(FileHashValue)\n| union (fileHashIndicators | extend FileHashValue = toupper(FileHashValue)))\n| join (\n  CommonSecurityLog | where TimeGenerated >= ago(dt_lookBack)\n  | where isnotempty(FileHash)\n  | extend CommonSecurityLog_TimeGenerated = TimeGenerated\n  )\non $left.FileHashValue == $right.FileHash\n| where CommonSecurityLog_TimeGenerated >= TimeGenerated and CommonSecurityLog_TimeGenerated < ExpirationDateTime\n| summarize LatestIndicatorTime = arg_max(TimeGenerated, *) by IndicatorId\n| project LatestIndicatorTime, Description, ActivityGroupNames, IndicatorId, ThreatType, Url, ExpirationDateTime, ConfidenceScore,\nCommonSecurityLog_TimeGenerated, SourceIP, SourcePort, DestinationIP, DestinationPort, SourceUserID, SourceUserName, DeviceName, DeviceAction, RequestURL, DestinationUserName, DestinationUserID, ApplicationProtocol, Activity, FileHash, AdditionalInformation\n| extend timestamp = CommonSecurityLog_TimeGenerated, IPCustomEntity = SourceIP, HostCustomEntity = DeviceName, AccountCustomEntity = SourceUserName, URLCustomEntity = Url\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "CommonSecurityLog"
                    ],
                    "connectorId": "CEF"
                  }
                ],
                "tactics": [
                  "PreAttack"
                ],
                "techniques": [
                  "T1587"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "URLCustomEntity",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId3'),'/'))))]",
              "properties": {
                "description": "Recorded Future Analytics Rule 3",
                "parentId": "[variables('analyticRuleId3')]",
                "contentId": "[variables('_analyticRulecontentId3')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId3')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Detection of Specific Hashes in CommonSecurityLog",
        "contentProductId": "[variables('_analyticRulecontentProductId3')]",
        "id": "[variables('_analyticRulecontentProductId3')]",
        "version": "[variables('analyticRuleVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureIPMalwareC2inAzureActivityEvents_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId4')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies a match in Azure Activity Events from Recorded Future Actively Communicating C&C Server Risklist.",
                "displayName": "Detection of Malware C2 IPs in Azure Act. Events",
                "enabled": false,
                "query": "// Identifies a match in AzureActivity from the Recorded Future C2 Malware Detection IPs (Actively Communicating C&C Server RiskList)\nlet dt_lookBack = 1h;\nlet ioc_lookBack = 1d;\nThreatIntelligenceIndicator\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\n| where Description == \"Recorded Future - IP - Actively Communicating C&C Server\"\n| where TimeGenerated >= ago(ioc_lookBack) and ExpirationDateTime > now()\n| where Active == true\n| extend TI_ipEntity = NetworkIP\n| join (\n  AzureActivity | where TimeGenerated >= ago(dt_lookBack)\n  // renaming time column so it is clear the log this came from\n  | extend AzureActivity_TimeGenerated = TimeGenerated\n  )\non $left.TI_ipEntity == $right.CallerIpAddress\n| where AzureActivity_TimeGenerated >= TimeGenerated and AzureActivity_TimeGenerated < ExpirationDateTime\n| summarize LatestIndicatorTime = arg_max(TimeGenerated, *) by IndicatorId\n| project LatestIndicatorTime, ActivityGroupNames, IndicatorId, ThreatType, Url, ExpirationDateTime, ConfidenceScore, AzureActivity_TimeGenerated, TI_ipEntity, CallerIpAddress, Caller, OperationNameValue, ActivityStatusValue, CategoryValue, ResourceId, NetworkIP, Description, AdditionalInformation\n| extend timestamp = AzureActivity_TimeGenerated, IPCustomEntity = CallerIpAddress, AccountCustomEntity = Caller, URLCustomEntity = Url\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "AzureActivity"
                    ],
                    "connectorId": "AzureActivity"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "AccountCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Account"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "URLCustomEntity",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "TI_ipEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId4'),'/'))))]",
              "properties": {
                "description": "Recorded Future Analytics Rule 4",
                "parentId": "[variables('analyticRuleId4')]",
                "contentId": "[variables('_analyticRulecontentId4')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId4')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Detection of Malware C2 IPs in Azure Act. Events",
        "contentProductId": "[variables('_analyticRulecontentProductId4')]",
        "id": "[variables('_analyticRulecontentProductId4')]",
        "version": "[variables('analyticRuleVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureIPMalwareC2inDNSEvents_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId5')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies a match in DnsEvents from Recorded Future Actively Communicating C&C Server Risklist.",
                "displayName": "Detection of Malware C2 IPs in DNS Events",
                "enabled": false,
                "query": "// Identifies a match in DnsEvent from the Recorded Future C2 Malware Detection IPs (Actively Communicating C&C Server RiskList)\nlet dt_lookBack = 1h;\nlet ioc_lookBack = 1d;\nThreatIntelligenceIndicator\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\n| where Description == \"Recorded Future - IP - Actively Communicating C&C Server\"\n| where TimeGenerated >= ago(ioc_lookBack) and ExpirationDateTime > now()\n| where Active == true\n| extend TI_ipEntity = NetworkIP\n| join (\n  DnsEvents | where TimeGenerated >= ago(dt_lookBack)\n  | where SubType =~ \"LookupQuery\" and isnotempty(IPAddresses)\n  | extend SingleIP = split(IPAddresses, \",\")\n  | mvexpand SingleIP\n  | extend SingleIP = tostring(SingleIP)\n  // renaming time column so it is clear the log this came from\n  | extend DNS_TimeGenerated = TimeGenerated\n  )\non $left.TI_ipEntity == $right.SingleIP\n| where DNS_TimeGenerated >= TimeGenerated and DNS_TimeGenerated < ExpirationDateTime\n| summarize LatestIndicatorTime = arg_max(TimeGenerated, *) by IndicatorId\n| project LatestIndicatorTime, ActivityGroupNames, IndicatorId, ThreatType, Url, ExpirationDateTime, ConfidenceScore, DNS_TimeGenerated, TI_ipEntity, Computer, EventId, SubType, ClientIP, Name, IPAddresses, NetworkIP, Description, AdditionalInformation\n| extend timestamp = DNS_TimeGenerated, IPCustomEntity = ClientIP, HostCustomEntity = Computer, URLCustomEntity = Url\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "DnsEvents"
                    ],
                    "connectorId": "DNS"
                  }
                ],
                "tactics": [
                  "CommandAndControl"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "URLCustomEntity",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "TI_ipEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId5'),'/'))))]",
              "properties": {
                "description": "Recorded Future Analytics Rule 5",
                "parentId": "[variables('analyticRuleId5')]",
                "contentId": "[variables('_analyticRulecontentId5')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId5')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Detection of Malware C2 IPs in DNS Events",
        "contentProductId": "[variables('_analyticRulecontentProductId5')]",
        "id": "[variables('_analyticRulecontentProductId5')]",
        "version": "[variables('analyticRuleVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureUrlReportedbyInsiktGroupinSyslogEvents_AnalyticalRules Analytics Rule with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRulecontentId6')]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "Identifies a match in Syslog from Recorded Future URLs Recently Reported as malicious by Insikt Group.",
                "displayName": "Detection of Malicious URLs in Syslog Events",
                "enabled": false,
                "query": "// Identifies a match in Syslog from the Recorded Future URLs Recently Reported by Insikt Group\nlet dt_lookBack = 1h;\nlet ioc_lookBack = 1d;\nThreatIntelligenceIndicator\n// Picking up only Recorded Future IOC's that have been recently reported as malicious by Insikt Group\n| where Description == 'Recorded Future - URL - Recently Reported by Insikt Group'\n| where TimeGenerated >= ago(ioc_lookBack) and ExpirationDateTime > now()\n| where Active == true\n// Picking up only IOC's that contain the entities we want\n| where isnotempty(Url)\n| join (\n  Syslog\n  | where TimeGenerated >= ago(dt_lookBack)\n  // Extract URL from the Syslog message but only take messages that include URLs\n  | extend Url = extract(\"(http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\\\(\\\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+)\", 1,SyslogMessage)\n  | where isnotempty(Url)\n  | extend Syslog_TimeGenerated = TimeGenerated\n  ) \non Url\n| where Syslog_TimeGenerated >= TimeGenerated and Syslog_TimeGenerated < ExpirationDateTime\n| summarize LatestIndicatorTime = arg_max(TimeGenerated, *) by IndicatorId\n| project LatestIndicatorTime, Description, ActivityGroupNames, IndicatorId, ThreatType, ExpirationDateTime, ConfidenceScore, Syslog_TimeGenerated, SyslogMessage, Computer, ProcessName, Url, AdditionalInformation, HostIP\n| extend timestamp = Syslog_TimeGenerated, HostCustomEntity = Computer, IPCustomEntity = HostIP, URLCustomEntity = Url\n",
                "queryFrequency": "PT1H",
                "queryPeriod": "P1D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": [
                  {
                    "dataTypes": [
                      "Syslog"
                    ],
                    "connectorId": "Syslog"
                  }
                ],
                "tactics": [
                  "Impact"
                ],
                "entityMappings": [
                  {
                    "fieldMappings": [
                      {
                        "columnName": "HostCustomEntity",
                        "identifier": "FullName"
                      }
                    ],
                    "entityType": "Host"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "IPCustomEntity",
                        "identifier": "Address"
                      }
                    ],
                    "entityType": "IP"
                  },
                  {
                    "fieldMappings": [
                      {
                        "columnName": "URLCustomEntity",
                        "identifier": "Url"
                      }
                    ],
                    "entityType": "URL"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleId6'),'/'))))]",
              "properties": {
                "description": "Recorded Future Analytics Rule 6",
                "parentId": "[variables('analyticRuleId6')]",
                "contentId": "[variables('_analyticRulecontentId6')]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_analyticRulecontentId6')]",
        "contentKind": "AnalyticsRule",
        "displayName": "Detection of Malicious URLs in Syslog Events",
        "contentProductId": "[variables('_analyticRulecontentProductId6')]",
        "id": "[variables('_analyticRulecontentProductId6')]",
        "version": "[variables('analyticRuleVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureThreatHuntingHashAllActors Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureThreatHuntingHashAllActors",
                "category": "Samples",
                "functionAlias": "RecordedFutureThreatHuntingHashAllActors",
                "query": "\nid: 6db6a8e6-2959-440b-ba57-a505875fcb37\r\nname: Recorded Future - Threat Hunting - Hash- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting hash correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \" {{Description}} \"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{Hash_s}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - InitialAccess\r\nrelevantTechniques:\r\n  - T1566.001\r\nquery: |\r\n  Squid_Proxy_Domain_CL\r\n  | where isnotempty(Domain_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(DomainName)\r\n  | distinct DomainName, Description, Tags\r\n  )\r\n  on $left.Domain_s == $right.DomainName\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']\r\n  | project Domain_s, Description, Type, Src_IPv4_s, TimeGenerated, RecordedFuturePortalLink\r\nentityMappings:\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Value\r\n        columnName: Hash_s\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Algorithm\r\n        columnName: FileHashType\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureThreatHuntingHashAllActors"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId1')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureThreatHuntingHashAllActors",
        "contentProductId": "[variables('_parsercontentProductId1')]",
        "id": "[variables('_parsercontentProductId1')]",
        "version": "[variables('parserVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureThreatHuntingHashAllActors",
        "category": "Samples",
        "functionAlias": "RecordedFutureThreatHuntingHashAllActors",
        "query": "\nid: 6db6a8e6-2959-440b-ba57-a505875fcb37\r\nname: Recorded Future - Threat Hunting - Hash- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting hash correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \" {{Description}} \"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{Hash_s}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - InitialAccess\r\nrelevantTechniques:\r\n  - T1566.001\r\nquery: |\r\n  Squid_Proxy_Domain_CL\r\n  | where isnotempty(Domain_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(DomainName)\r\n  | distinct DomainName, Description, Tags\r\n  )\r\n  on $left.Domain_s == $right.DomainName\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']\r\n  | project Domain_s, Description, Type, Src_IPv4_s, TimeGenerated, RecordedFuturePortalLink\r\nentityMappings:\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Value\r\n        columnName: Hash_s\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Algorithm\r\n        columnName: FileHashType\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureThreatHuntingHashAllActors"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureThreatHuntingIPAllActors Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName2')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureThreatHuntingIPAllActors",
                "category": "Samples",
                "functionAlias": "RecordedFutureThreatHuntingIPAllActors",
                "query": "\nid: e31bc14e-2b4c-42a4-af34-5bfd7d768aea\r\nname: Recorded Future - Threat Hunting - IP- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting IP correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \"{{Description}}\"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{NetworkIP}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T0869\r\nquery: |\r\n NetScreen_Firewall_CL\r\n  | where isnotempty(Dst_IPv4_s)\r\n  | join kind=innerunique  (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(NetworkIP)\r\n  | distinct NetworkIP, Description, Tags\r\n  ) on $left.Dst_IPv4_s == $right.NetworkIP\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']    \r\n  | project NetworkIP, Description, Type, TimeGenerated, RecordedFuturePortalLink\r\nentityMappings:\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: NetworkIP\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureThreatHuntingIPAllActors"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId2'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId2')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
                "contentId": "[variables('_parserContentId2')]",
                "kind": "Parser",
                "version": "[variables('parserVersion2')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId2')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureThreatHuntingIPAllActors",
        "contentProductId": "[variables('_parsercontentProductId2')]",
        "id": "[variables('_parsercontentProductId2')]",
        "version": "[variables('parserVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName2')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureThreatHuntingIPAllActors",
        "category": "Samples",
        "functionAlias": "RecordedFutureThreatHuntingIPAllActors",
        "query": "\nid: e31bc14e-2b4c-42a4-af34-5bfd7d768aea\r\nname: Recorded Future - Threat Hunting - IP- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting IP correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \"{{Description}}\"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{NetworkIP}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T0869\r\nquery: |\r\n NetScreen_Firewall_CL\r\n  | where isnotempty(Dst_IPv4_s)\r\n  | join kind=innerunique  (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(NetworkIP)\r\n  | distinct NetworkIP, Description, Tags\r\n  ) on $left.Dst_IPv4_s == $right.NetworkIP\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']    \r\n  | project NetworkIP, Description, Type, TimeGenerated, RecordedFuturePortalLink\r\nentityMappings:\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: NetworkIP\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureThreatHuntingIPAllActors"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId2'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId2')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName2'))]",
        "contentId": "[variables('_parserContentId2')]",
        "kind": "Parser",
        "version": "[variables('parserVersion2')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureThreatHuntingDomainAllActors Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName3')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureThreatHuntingDomainAllActors",
                "category": "Samples",
                "functionAlias": "RecordedFutureThreatHuntingDomainAllActors",
                "query": "\nid: acbf7ef6-f964-44c3-9031-7834ec68175f\r\nname: Recorded Future - Threat Hunting - Domain- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting domain correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \" {{Description}} \"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{Domain_s}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.004\r\nquery: |\r\n  Squid_Proxy_Domain_CL\r\n  | where isnotempty(Domain_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(DomainName)\r\n  | distinct DomainName, Description, Tags\r\n  )\r\n  on $left.Domain_s == $right.DomainName\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']\r\n  | project Domain_s, Description, Type, Src_IPv4_s, TimeGenerated, RecordedFuturePortalLink\r\nentityMappings:\r\n  - entityType: DNSResolution\r\n    fieldMappings:\r\n      - identifier: DomainName\r\n        columnName: Domain_s\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Src_IPv4_s\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureThreatHuntingDomainAllActors"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId3'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId3')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
                "contentId": "[variables('_parserContentId3')]",
                "kind": "Parser",
                "version": "[variables('parserVersion3')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId3')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureThreatHuntingDomainAllActors",
        "contentProductId": "[variables('_parsercontentProductId3')]",
        "id": "[variables('_parsercontentProductId3')]",
        "version": "[variables('parserVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName3')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureThreatHuntingDomainAllActors",
        "category": "Samples",
        "functionAlias": "RecordedFutureThreatHuntingDomainAllActors",
        "query": "\nid: acbf7ef6-f964-44c3-9031-7834ec68175f\r\nname: Recorded Future - Threat Hunting - Domain- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting domain correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \" {{Description}} \"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{Domain_s}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.004\r\nquery: |\r\n  Squid_Proxy_Domain_CL\r\n  | where isnotempty(Domain_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(DomainName)\r\n  | distinct DomainName, Description, Tags\r\n  )\r\n  on $left.Domain_s == $right.DomainName\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']\r\n  | project Domain_s, Description, Type, Src_IPv4_s, TimeGenerated, RecordedFuturePortalLink\r\nentityMappings:\r\n  - entityType: DNSResolution\r\n    fieldMappings:\r\n      - identifier: DomainName\r\n        columnName: Domain_s\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Src_IPv4_s\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureThreatHuntingDomainAllActors"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId3'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId3')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName3'))]",
        "contentId": "[variables('_parserContentId3')]",
        "kind": "Parser",
        "version": "[variables('parserVersion3')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureThreatHuntingUrlAllActors Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName4')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureThreatHuntingUrlAllActors",
                "category": "Samples",
                "functionAlias": "RecordedFutureThreatHuntingUrlAllActors",
                "query": "\nid: 3f6f0d1a-f2f9-4e01-881a-c55a4a71905b\r\nname: Recorded Future - Threat Hunting - Url- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting Url correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \"{{Description}}\"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{Url}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.001\r\nquery: |\r\n  Squid_Proxy_URL_CL\r\n  | where isnotempty(URL_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(Url)\r\n  | distinct Url, Description, Tags\r\n  )\r\n  on $left.URL_s == $right.Url\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']\r\n  | project Url, Description, Type, Src_IPv4_s, TimeGenerated, RecordedFuturePortalLink, Domain_s\r\nentityMappings:\r\n  - entityType: DNSResolution\r\n    fieldMappings:\r\n      - identifier: DomainName\r\n        columnName: Domain_s\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Src_IPv4_s\r\n  - entityType: URL\r\n    fieldMappings:\r\n      - identifier: Url\r\n        columnName: Url\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureThreatHuntingUrlAllActors"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId4'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId4')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
                "contentId": "[variables('_parserContentId4')]",
                "kind": "Parser",
                "version": "[variables('parserVersion4')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId4')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureThreatHuntingUrlAllActors",
        "contentProductId": "[variables('_parsercontentProductId4')]",
        "id": "[variables('_parsercontentProductId4')]",
        "version": "[variables('parserVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName4')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureThreatHuntingUrlAllActors",
        "category": "Samples",
        "functionAlias": "RecordedFutureThreatHuntingUrlAllActors",
        "query": "\nid: 3f6f0d1a-f2f9-4e01-881a-c55a4a71905b\r\nname: Recorded Future - Threat Hunting - Url- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting Url correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\nqueryFrequency: 15min\r\nqueryPeriod: 1d\r\ntriggerOperator: gt\r\ntriggerThreshold: 0\r\ncustomDetails: \r\n  - ActorInformation: RecordedFuturePortalLink\r\nalertDetailsOverride:\r\n  - alertDisplayNameFormat: \"{{Description}}\"\r\n    alertDescriptionFormat: \"**{{Description}}**\\n\\nCorrelation found on {{Url}} from the {{Type}} table.\\n\"\r\n    alertDynamicProperties:\r\n      - alertProperty: AlertLink\r\n        value: RecordedFuturePortalLink\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.001\r\nquery: |\r\n  Squid_Proxy_URL_CL\r\n  | where isnotempty(URL_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where isnotempty(Url)\r\n  | distinct Url, Description, Tags\r\n  )\r\n  on $left.URL_s == $right.Url\r\n  | mv-expand RecordedFuturePortalLink=parse_json(tostring(parse_json(Tags)[0]))['RecordedFuturePortalLink']\r\n  | project Url, Description, Type, Src_IPv4_s, TimeGenerated, RecordedFuturePortalLink, Domain_s\r\nentityMappings:\r\n  - entityType: DNSResolution\r\n    fieldMappings:\r\n      - identifier: DomainName\r\n        columnName: Domain_s\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Src_IPv4_s\r\n  - entityType: URL\r\n    fieldMappings:\r\n      - identifier: Url\r\n        columnName: Url\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureThreatHuntingUrlAllActors"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId4'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId4')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName4'))]",
        "contentId": "[variables('_parserContentId4')]",
        "kind": "Parser",
        "version": "[variables('parserVersion4')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureIPThreatActorHunt Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName5')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureIPThreatActorHunt",
                "category": "Samples",
                "functionAlias": "RecordedFutureIPThreatActorHunt",
                "query": "\nid: 7b5eb44d-3533-440e-9774-73a4d99bc2b2\r\nname: Recorded Future - Threat Hunting - IP- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting IP correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T0869\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  NetScreen_Firewall_CL\r\n  | join kind= innerunique  (ThreatIntelligenceIndicator\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where Active == true\r\n  | distinct NetworkIP\r\n  )\r\n  on $left.Dst_IPv4_s == $right.NetworkIP\r\n  | project Dst_IPv4_s\r\nentityMappings:\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Dst_IPv4_s\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureIPThreatActorHunt"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId5'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId5')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName5'))]",
                "contentId": "[variables('_parserContentId5')]",
                "kind": "Parser",
                "version": "[variables('parserVersion5')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId5')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureIPThreatActorHunt",
        "contentProductId": "[variables('_parsercontentProductId5')]",
        "id": "[variables('_parsercontentProductId5')]",
        "version": "[variables('parserVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName5')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureIPThreatActorHunt",
        "category": "Samples",
        "functionAlias": "RecordedFutureIPThreatActorHunt",
        "query": "\nid: 7b5eb44d-3533-440e-9774-73a4d99bc2b2\r\nname: Recorded Future - Threat Hunting - IP- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting IP correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T0869\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  NetScreen_Firewall_CL\r\n  | join kind= innerunique  (ThreatIntelligenceIndicator\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where Active == true\r\n  | distinct NetworkIP\r\n  )\r\n  on $left.Dst_IPv4_s == $right.NetworkIP\r\n  | project Dst_IPv4_s\r\nentityMappings:\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Dst_IPv4_s\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureIPThreatActorHunt"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId5'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId5')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName5'))]",
        "contentId": "[variables('_parserContentId5')]",
        "kind": "Parser",
        "version": "[variables('parserVersion5')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureHashThreatActorHunt Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName6')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureHashThreatActorHunt",
                "category": "Samples",
                "functionAlias": "RecordedFutureHashThreatActorHunt",
                "query": "\nid: 905da21a-c7d2-4f5b-b8fc-c8321da3ee83\r\nname: Recorded Future - Threat Hunting - Hash- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting hash correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - InitialAccess\r\nrelevantTechniques:\r\n  - T1566.001\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  EndpointProtection_HASH_CL\r\n  | where isnotempty(Hash_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where Active == true\r\n  | distinct FileHashValue\r\n  )\r\n  on $left.Hash_s == $right.FileHashValue\r\n  | project Hash_s, Hash_Type_s\r\nentityMappings:\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Value\r\n        columnName: Hash_s\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Algorithm\r\n        columnName: Hash_Type_s\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureHashThreatActorHunt"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId6'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId6')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName6'))]",
                "contentId": "[variables('_parserContentId6')]",
                "kind": "Parser",
                "version": "[variables('parserVersion6')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId6')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureHashThreatActorHunt",
        "contentProductId": "[variables('_parsercontentProductId6')]",
        "id": "[variables('_parsercontentProductId6')]",
        "version": "[variables('parserVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName6')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureHashThreatActorHunt",
        "category": "Samples",
        "functionAlias": "RecordedFutureHashThreatActorHunt",
        "query": "\nid: 905da21a-c7d2-4f5b-b8fc-c8321da3ee83\r\nname: Recorded Future - Threat Hunting - Hash- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting hash correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - InitialAccess\r\nrelevantTechniques:\r\n  - T1566.001\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  EndpointProtection_HASH_CL\r\n  | where isnotempty(Hash_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where Active == true\r\n  | distinct FileHashValue\r\n  )\r\n  on $left.Hash_s == $right.FileHashValue\r\n  | project Hash_s, Hash_Type_s\r\nentityMappings:\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Value\r\n        columnName: Hash_s\r\n  - entityType: FileHash\r\n    fieldMappings:\r\n      - identifier: Algorithm\r\n        columnName: Hash_Type_s\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureHashThreatActorHunt"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId6'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId6')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName6'))]",
        "contentId": "[variables('_parserContentId6')]",
        "kind": "Parser",
        "version": "[variables('parserVersion6')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureUrlThreatActorHunt Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName7')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureUrlThreatActorHunt",
                "category": "Samples",
                "functionAlias": "RecordedFutureUrlThreatActorHunt",
                "query": "\nid: dbc2438a-0d16-4890-aaae-cbe0dc433b08\r\nname: Recorded Future - URL - Threat Actor Hunt\r\ndescription: |\r\n  'Recorded Future - URL - Threat Actor Hunt.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.001\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  Squid_Proxy_URL_CL\r\n  | where isnotempty(URL_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where Active == true\r\n  | distinct Url\r\n  )\r\n  on $left.URL_s == $right.Url\r\n  | project URL_s\r\n  | extend URL_0_Url = URL_s\r\nentityMappings:\r\n  - entityType: URL\r\n    fieldMappings:\r\n      - identifier: Url\r\n        columnName: Url\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureUrlThreatActorHunt"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId7'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId7')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName7'))]",
                "contentId": "[variables('_parserContentId7')]",
                "kind": "Parser",
                "version": "[variables('parserVersion7')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId7')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureUrlThreatActorHunt",
        "contentProductId": "[variables('_parsercontentProductId7')]",
        "id": "[variables('_parsercontentProductId7')]",
        "version": "[variables('parserVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName7')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureUrlThreatActorHunt",
        "category": "Samples",
        "functionAlias": "RecordedFutureUrlThreatActorHunt",
        "query": "\nid: dbc2438a-0d16-4890-aaae-cbe0dc433b08\r\nname: Recorded Future - URL - Threat Actor Hunt\r\ndescription: |\r\n  'Recorded Future - URL - Threat Actor Hunt.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.001\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  Squid_Proxy_URL_CL\r\n  | where isnotempty(URL_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | where Active == true\r\n  | distinct Url\r\n  )\r\n  on $left.URL_s == $right.Url\r\n  | project URL_s\r\n  | extend URL_0_Url = URL_s\r\nentityMappings:\r\n  - entityType: URL\r\n    fieldMappings:\r\n      - identifier: Url\r\n        columnName: Url\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureUrlThreatActorHunt"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId7'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId7')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName7'))]",
        "contentId": "[variables('_parserContentId7')]",
        "kind": "Parser",
        "version": "[variables('parserVersion7')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('parserTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureDomainThreatActorHunt Data Parser with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion8')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName8')]",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "RecordedFutureDomainThreatActorHunt",
                "category": "Samples",
                "functionAlias": "RecordedFutureDomainThreatActorHunt",
                "query": "\nid: d641a534-ead8-41aa-a7c8-2b35e6b64c9f\r\nname: Recorded Future - Threat Hunting - Domain- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting domain correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.004\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  Squid_Proxy_Domain_CL\r\n  | where isnotempty(Domain_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | distinct DomainName\r\n  )\r\n  on $left.Domain_s == $right.DomainName\r\n  | project Domain_s, Src_IPv4_s\r\nentityMappings:\r\n  - entityType: DNSResolution\r\n    fieldMappings:\r\n      - identifier: DomainName\r\n        columnName: Domain_s\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Src_IPv4_s\r\nversion: 1.0.0",
                "functionParameters": "",
                "version": 1,
                "tags": [
                  {
                    "name": "description",
                    "value": "RecordedFutureDomainThreatActorHunt"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId8'),'/'))))]",
              "dependsOn": [
                "[variables('_parserId8')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName8'))]",
                "contentId": "[variables('_parserContentId8')]",
                "kind": "Parser",
                "version": "[variables('parserVersion8')]",
                "source": {
                  "name": "Recorded Future",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_parserContentId8')]",
        "contentKind": "Parser",
        "displayName": "RecordedFutureDomainThreatActorHunt",
        "contentProductId": "[variables('_parsercontentProductId8')]",
        "id": "[variables('_parsercontentProductId8')]",
        "version": "[variables('parserVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2022-10-01",
      "name": "[variables('_parserName8')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "RecordedFutureDomainThreatActorHunt",
        "category": "Samples",
        "functionAlias": "RecordedFutureDomainThreatActorHunt",
        "query": "\nid: d641a534-ead8-41aa-a7c8-2b35e6b64c9f\r\nname: Recorded Future - Threat Hunting - Domain- All Actors\r\ndescription: |\r\n  'Recorded Future Threat Hunting domain correlation for all actors.'\r\nseverity: Medium\r\nrequiredDataConnectors:\r\n  - connectorId: ThreatIntelligenceUploadIndicatorsAPI\r\n    dataTypes:\r\n      - ThreatIntelligenceIndicator\r\ntactics:\r\n  - CommandAndControl\r\nrelevantTechniques:\r\n  - T1071.004\r\ntags:\r\n  - RecordedFuture\r\nquery: |\r\n  Squid_Proxy_Domain_CL\r\n  | where isnotempty(Domain_s)\r\n  | join kind=inner (ThreatIntelligenceIndicator\r\n  | where Active == true\r\n  | where Description startswith \"Recorded Future - Threat Hunt\"\r\n  | distinct DomainName\r\n  )\r\n  on $left.Domain_s == $right.DomainName\r\n  | project Domain_s, Src_IPv4_s\r\nentityMappings:\r\n  - entityType: DNSResolution\r\n    fieldMappings:\r\n      - identifier: DomainName\r\n        columnName: Domain_s\r\n  - entityType: IP\r\n    fieldMappings:\r\n      - identifier: Address\r\n        columnName: Src_IPv4_s\r\nversion: 1.0.0",
        "functionParameters": "",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "RecordedFutureDomainThreatActorHunt"
          }
        ]
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId8'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId8')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName8'))]",
        "contentId": "[variables('_parserContentId8')]",
        "kind": "Parser",
        "version": "[variables('parserVersion8')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
              "type": "string"
            }
          },
          "variables": {
            "RecordedFutureConnectionName": "recordedfuture-connectorv2",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2019-05-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateVersion": "2.5",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "Parse_JSON_2": {
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "id": {
                                  "type": "string"
                                },
                                "kind": {
                                  "type": "string"
                                },
                                "properties": {
                                  "type": "object"
                                },
                                "type": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "ParseJson"
                        },
                        "Switch": {
                          "cases": {
                            "Case": {
                              "actions": {
                                "Add_comment_to_incident_(V3)_-_Domain": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>@{body('Domain_Enrichment')?['data']?['html_response']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Domain_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Add_comment_to_incident_(V3)_4": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Recorded%20Future/Playbooks/RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash/images/RecordedFuture.png\" /><br>\nNo Recorded Future data on @{body('Parse_JSON_-_DNS_Resolution')?['domainName']}<br>\n<a href=\"https://app.recordedfuture.com/live/sc/collection-request\" target=\"_blank\">Request Data Collection In The Recorded Future Portal</a></p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Add_comment_to_incident_(V3)_-_Domain": [
                                      "Skipped"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Domain_Enrichment": {
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/lookup/domain/@{encodeURIComponent(body('Parse_JSON_-_DNS_Resolution')?['domainName'])}",
                                    "queries": {
                                      "IntelligenceCloud": "@parameters('IntelligenceCloud')",
                                      "RFIncidentId": "@variables('RFIncidentId')",
                                      "Techniques": "@string(triggerBody()?['object']?['properties']?['additionalData']?['techniques'])",
                                      "WorkspaceId": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "fields": "intelCard,risk,links",
                                      "htmlresponse": "True"
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_DNS_Resolution": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Parse_JSON_-_DNS_Resolution": {
                                  "inputs": {
                                    "content": "@body('Parse_JSON_2')?['properties']",
                                    "schema": {
                                      "properties": {
                                        "domainName": {
                                          "type": "string"
                                        },
                                        "friendlyName": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "ParseJson"
                                }
                              },
                              "case": "DnsResolution"
                            },
                            "Case_2": {
                              "actions": {
                                "Add_comment_to_incident_(V3)_-_Hash": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>@{body('Hash_Enrichment')?['data']?['html_response']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Hash_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Add_comment_to_incident_(V3)_3": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Recorded%20Future/Playbooks/RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash/images/RecordedFuture.png\" /><br>\nNo Recorded Future data on @{body('Parse_JSON_-_File_Hash')?['hashValue']}<br>\n<a href=\"https://app.recordedfuture.com/live/sc/collection-request\" target=\"_blank\">Request Data Collection In The Recorded Future Portal</a></p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Add_comment_to_incident_(V3)_-_Hash": [
                                      "Skipped"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Hash_Enrichment": {
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/lookup/hash/@{encodeURIComponent(body('Parse_JSON_-_File_Hash')?['hashValue'])}",
                                    "queries": {
                                      "IntelligenceCloud": "@parameters('IntelligenceCloud')",
                                      "RFIncidentId": "@variables('RFIncidentId')",
                                      "Techniques": "@string(triggerBody()?['object']?['properties']?['additionalData']?['techniques'])",
                                      "WorkspaceId": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "fields": "intelCard,risk,links",
                                      "htmlresponse": "True"
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_File_Hash": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Parse_JSON_-_File_Hash": {
                                  "inputs": {
                                    "content": "@body('Parse_JSON_2')?['properties']",
                                    "schema": {
                                      "properties": {
                                        "algorithm": {
                                          "type": "string"
                                        },
                                        "friendlyName": {
                                          "type": "string"
                                        },
                                        "hashValue": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "ParseJson"
                                }
                              },
                              "case": "FileHash"
                            },
                            "Case_3": {
                              "actions": {
                                "Add_comment_to_incident_(V3)_-_URL": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>@{body('URL_Enrichment')?['data']?['html_response']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "URL_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Add_comment_to_incident_(V3)_2": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Recorded%20Future/Playbooks/RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash/images/RecordedFuture.png\" /><br>\nNo Recorded Future data on @{body('Parse_JSON_-_Url')?['url']}<br>\n<a href=\"https://app.recordedfuture.com/live/sc/collection-request\" target=\"_blank\">Request Data Collection In The Recorded Future Portal</a></p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Add_comment_to_incident_(V3)_-_URL": [
                                      "Skipped"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Parse_JSON_-_Url": {
                                  "inputs": {
                                    "content": "@body('Parse_JSON_2')?['properties']",
                                    "schema": {
                                      "properties": {
                                        "friendlyName": {
                                          "type": "string"
                                        },
                                        "url": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "ParseJson"
                                },
                                "URL_Enrichment": {
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/lookup/url/@{encodeURIComponent(body('Parse_JSON_-_Url')?['url'])}",
                                    "queries": {
                                      "IntelligenceCloud": "@parameters('IntelligenceCloud')",
                                      "RFIncidentId": "@variables('RFIncidentId')",
                                      "Techniques": "@string(triggerBody()?['object']?['properties']?['additionalData']?['techniques'])",
                                      "WorkspaceId": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "fields": "intelCard,risk,links",
                                      "htmlresponse": "True"
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_Url": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                }
                              },
                              "case": "Url"
                            },
                            "Case_4": {
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Recorded%20Future/Playbooks/RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash/images/RecordedFuture.png\" /><br>\nNo Recorded Future data on @{body('Parse_JSON_-_Ip')?['address']}<br>\n<a href=\"https://app.recordedfuture.com/live/sc/collection-request\" target=\"_blank\">Request Data Collection In The Recorded Future Portal</a></p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "Add_comment_to_incident_(V3)_-_IP": [
                                      "Skipped"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Add_comment_to_incident_(V3)_-_IP": {
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>@{body('IP_Enrichment')?['data']?['html_response']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  },
                                  "runAfter": {
                                    "IP_Enrichment": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "IP_Enrichment": {
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/lookup/ip/@{encodeURIComponent(body('Parse_JSON_-_Ip')?['address'])}",
                                    "queries": {
                                      "IntelligenceCloud": "@parameters('IntelligenceCloud')",
                                      "RFIncidentId": "@variables('RFIncidentId')",
                                      "Techniques": "@string(triggerBody()?['object']?['properties']?['additionalData']?['techniques'])",
                                      "WorkspaceId": "@triggerBody()?['workspaceInfo']?['WorkspaceName']",
                                      "fields": "intelCard,risk,links",
                                      "htmlresponse": "True"
                                    }
                                  },
                                  "runAfter": {
                                    "Parse_JSON_-_Ip": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection"
                                },
                                "Parse_JSON_-_Ip": {
                                  "inputs": {
                                    "content": "@body('Parse_JSON_2')?['properties']",
                                    "schema": {
                                      "properties": {
                                        "address": {
                                          "type": "string"
                                        },
                                        "friendlyName": {
                                          "type": "string"
                                        }
                                      },
                                      "type": "object"
                                    }
                                  },
                                  "type": "ParseJson"
                                }
                              },
                              "case": "Ip"
                            }
                          },
                          "expression": "@body('Parse_JSON_2')?['kind']",
                          "runAfter": {
                            "Parse_JSON_2": [
                              "Succeeded"
                            ]
                          },
                          "type": "Switch"
                        }
                      },
                      "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                      "runAfter": {
                        "RFIncidentId": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "RFIncidentId": {
                      "inputs": {
                        "variables": [
                          {
                            "name": "RFIncidentId",
                            "type": "string",
                            "value": "@{guid()}"
                          }
                        ]
                      },
                      "type": "InitializeVariable"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "IntelligenceCloud": {
                      "defaultValue": true,
                      "type": "Bool"
                    },
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered": {
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      },
                      "type": "ApiConnectionWebhook"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/azuresentinel')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]"
                      },
                      "recordedfuture": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedFutureConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedFutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
            "description": "This playbook leverages the Recorded Future API to enrich IP, Domain, Url & Hash indicators, found in Microsoft Sentinel incidents, with the following context: Risk Score, Risk Rules and Link to Intelligence Card. The enrichment content will be posted as a comment in the Microsoft Sentinel incident <img alt=\"Microsoft Sentinel incident comment\" src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Recorded%20Future/Playbooks/RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash/images/EnrichmentExampleDark.png\"/>.",
            "prerequisites": [
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment open the playbook in edit mode and configure/authorize all connections and press save.<img alt=\"Logic app schema\" src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Recorded%20Future/Playbooks/RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash/images/LogicAppDark.png\" />"
            ],
            "lastUpdateTime": "2023-03-08T00:00:00Z",
            "entities": [
              "ip",
              "url",
              "dnsresolution",
              "filehash"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
                "notes": [
                  "Initial version"
                ]
              },
              {
                "version": "1.1",
                "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
                "notes": [
                  "Improved layout and added Recorded Future Collective Insights."
                ]
              },
              {
                "version": "1.2",
                "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
                "notes": [
                  "Fixed risk rule severity and correct image url."
                ]
              },
              {
                "version": "2.3",
                "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
                "notes": [
                  "Updated readme and improved layout."
                ]
              },
              {
                "version": "2.4",
                "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
                "notes": [
                  "Handle 404 result from enrichment."
                ]
              },
              {
                "version": "2.5",
                "title": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
                "notes": [
                  "Backend rendered markdown/html to increse performance and reduce cost of enrichment."
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-Sandbox_Enrichment-Url Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-Sandbox_Enrichment-Url",
              "type": "string"
            },
            "Sandbox API Key": {
              "type": "string",
              "metadata": {
                "description": "Enter value for Sandbox API Key. Retrive API Key from [Recorded Future Portal](https://sandbox.recordedfuture.com/account)"
              }
            }
          },
          "variables": {
            "RecordedfutureConnectionName": "[[concat('', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/recordedfuturesandbo')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Sandbox API Key": {
                      "defaultValue": "[[parameters('Sandbox API Key')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Get_the_full_report": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>@{body('Get_the_full_report')?['html_report']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Get_the_full_report": {
                          "runAfter": {
                            "Wait_for_sandbox_report": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "headers": {
                              "SandboxToken": "@parameters('Sandbox API Key')"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['recordedfuturesandbo']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/samples/@{encodeURIComponent(body('Get_the_full_summary')?['id'])}/overview.json"
                          }
                        },
                        "Initialize_Sandbox_status": {
                          "runAfter": {
                            "Submit_url_samples": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "sandbox_status",
                            "value": "@body('Submit_url_samples')?['status']"
                          }
                        },
                        "Submit_url_samples": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "url": "@items('For_each')?['Url']"
                            },
                            "headers": {
                              "Content-Type": "application/json",
                              "SandboxToken": "@parameters('Sandbox API Key')"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['recordedfuturesandbo']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/samples/url"
                          }
                        },
                        "Wait_for_sandbox_report": {
                          "actions": {
                            "Delay": {
                              "runAfter": {
                                "Set_sandbox_status": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Wait",
                              "inputs": {
                                "interval": {
                                  "count": 2,
                                  "unit": "Minute"
                                }
                              }
                            },
                            "Get_the_full_summary": {
                              "type": "ApiConnection",
                              "inputs": {
                                "headers": {
                                  "SandboxToken": "@parameters('Sandbox API Key')"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['recordedfuturesandbo']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/samples/@{encodeURIComponent(body('Submit_url_samples')?['id'])}"
                              }
                            },
                            "Set_sandbox_status": {
                              "runAfter": {
                                "Get_the_full_summary": [
                                  "Succeeded"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "sandbox_status",
                                "value": "@body('Get_the_full_summary')?['status']"
                              }
                            }
                          },
                          "runAfter": {
                            "Initialize_Sandbox_status": [
                              "Succeeded"
                            ]
                          },
                          "expression": "@equals(variables('sandbox_status'), 'reported')",
                          "limit": {
                            "count": 60,
                            "timeout": "PT1H"
                          },
                          "type": "Until"
                        }
                      },
                      "runAfter": {
                        "Define_sandbox_status": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Define_sandbox_status": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "sandbox_status",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "recordedfuturesandbo": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]",
                        "connectionName": "recordedfuturesandbo",
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/recordedfuturesandbo')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-Sandbox_Enrichment-Url",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedfutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('RecordedfutureConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-Sandbox_Enrichment-Url",
            "description": "This playbook will enrich url entities in an incident and send them to Recorded Future Sandbox. The result will be written as a incident comment.",
            "prerequisites": "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials",
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-03-24T00:00:00Z",
            "entities": [
              "url"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-Sandbox_Enrichment-Url",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-Sandbox_Enrichment-Url",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-Playbook-Alert-Importer Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-Playbook-Alert-Importer",
              "type": "string"
            }
          },
          "variables": {
            "AzureloganalyticsdatacollectorConnectionName": "[[concat('Azureloganalyticsdatacollector-', parameters('PlaybookName'))]",
            "RecordedFutureConnectionName": "recordedfuture-connectorv2",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureloganalyticsdatacollector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Search_Playbook_Alerts')",
                      "actions": {
                        "Get_Playbook_Alert_by_ID": {
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['recordedfuturev2']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/playbook-alert/@{encodeURIComponent(items('For_each')?['playbook_alert_id'])}"
                          }
                        },
                        "Send_Data": {
                          "runAfter": {
                            "Get_Playbook_Alert_by_ID": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": "{\n\"title\": \"@{body('Get_Playbook_Alert_by_ID')?['title']}\",\n\"id\": \"@{body('Get_Playbook_Alert_by_ID')?['id']}\",\n\"category\":\"@{body('Get_Playbook_Alert_by_ID')?['category']}\",\n\"rule_label\":\"@{body('Get_Playbook_Alert_by_ID')?['rule_label']}\",\n\"status\": \"@{body('Get_Playbook_Alert_by_ID')?['status']}\", \n\"priority\": \"@{body('Get_Playbook_Alert_by_ID')?['priority']}\",\n\"created_date\": \"@{body('Get_Playbook_Alert_by_ID')?['created_date']}\",\n\"updated_date\": \"@{body('Get_Playbook_Alert_by_ID')?['updated_date']}\",\n\"targets\":\"@{body('Get_Playbook_Alert_by_ID')?['targets']}\",\n\"evidence_summary\": \"@{body('Get_Playbook_Alert_by_ID')?['evidence_summary']}\",\n\"link\": \"@{body('Get_Playbook_Alert_by_ID')?['link']}\"\n}",
                            "headers": {
                              "Log-Type": "RecordedFuturePlaybookAlerts"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azureloganalyticsdatacollector']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/api/logs"
                          }
                        }
                      },
                      "runAfter": {
                        "Search_Playbook_Alerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Search_Playbook_Alerts": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "categories": [
                            "domain_abuse",
                            "cyber_vulnerability",
                            "code_repo_leakage"
                          ],
                          "created_from_relative": "-1"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuturev2']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/playbook-alert/search"
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azureloganalyticsdatacollector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureloganalyticsdatacollectorConnectionName'))]",
                        "connectionName": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureloganalyticsdatacollector')]"
                      },
                      "recordedfuturev2": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedFutureConnectionName')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "PlaybookAlert-Import",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureloganalyticsdatacollectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedFutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-Playbook-Alert-Importer",
            "description": "This playbook imports alerts from Recorded Future and stores them in a custom log in the log analytics workspace.",
            "prerequisites": [
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Alert"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-Playbook-Alert-Importer",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-Playbook-Alert-Importer",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-AlertImporter Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-AlertImporter",
              "type": "string"
            },
            "create_incident": {
              "type": "string",
              "metadata": {
                "description": "Create Microsoft Sentinel incidents (possible values true/false)"
              }
            },
            "workspace_name": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Microsoft Sentinel Workspace name"
              }
            }
          },
          "variables": {
            "AzureloganalyticsdatacollectorConnectionName": "[[concat('Azureloganalyticsdatacollector-', parameters('PlaybookName'))]",
            "AzuremonitorlogsConnectionName": "[[concat('Azuremonitorlogs-', parameters('PlaybookName'))]",
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "Recordedfuturev2ConnectionName": "[[concat('Recordedfuturev2-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureloganalyticsdatacollector')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuremonitorlogs')]",
            "_connection-3": "[[variables('connection-3')]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-4": "[[variables('connection-4')]",
            "connection-5": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]",
            "_connection-5": "[[variables('connection-5')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "create_incident": {
                      "type": "string",
                      "defaultValue": "[[parameters('create_incident')]"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each_triggered_alert": {
                      "foreach": "@body('Search_Triggered_Alerts')?['data']",
                      "actions": {
                        "Create_incident_if_parameter_is_set": {
                          "actions": {
                            "Add_comment_to_incident_(V3)": {
                              "runAfter": {
                                "Parse_JSON_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@body('Create_incident')?['id']",
                                  "message": "<p>@{items('For_each_triggered_alert')?['title']}<br>\nAlert ID: @{items('For_each_triggered_alert')?['id']}<br>\nTriggered: @{items('For_each_triggered_alert')?['log']?['triggered']}<br>\n[Open Recorded Future portal](@{items('For_each_triggered_alert')?['url']?['portal']})<br>\nAI Summary: @{items('For_each_triggered_alert')?['ai_insights']?['text']}</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              }
                            },
                            "Create_incident": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "description": "**Recorded Future Alert**\n@{items('For_each_triggered_alert')?['title']}\nAlert ID: @{items('For_each_triggered_alert')?['id']}\nTriggered: @{items('For_each_triggered_alert')?['log']?['triggered']}\n[Open Recorded Future portal](@{items('For_each_triggered_alert')?['url']?['portal']})\nAI summary: @{items('For_each_triggered_alert')?['ai_insights']?['text']}",
                                  "severity": "Medium",
                                  "status": "New",
                                  "tagsToAdd": {
                                    "TagsToAdd": [
                                      {
                                        "Tag": "Recorded Future Alert"
                                      }
                                    ]
                                  },
                                  "title": "@items('For_each_triggered_alert')?['title']"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "[[concat('/Incidents/subscriptions/', subscription().subscriptionId,'/resourceGroups/',resourceGroup().name,'/workspaces/',parameters('workspace_name') ) ]"
                              }
                            },
                            "Parse_JSON_2": {
                              "runAfter": {
                                "Create_incident": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@items('For_each_triggered_alert')?['hits']",
                                "schema": {
                                  "items": {
                                    "properties": {
                                      "document": {
                                        "properties": {
                                          "authors": {
                                            "type": "array"
                                          },
                                          "source": {
                                            "properties": {
                                              "id": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "type": {
                                                "type": "string"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "title": {
                                            "type": [
                                              "string",
                                              "null"
                                            ]
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "entities": {
                                        "items": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "type": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "id",
                                            "name",
                                            "type"
                                          ],
                                          "type": "object"
                                        },
                                        "type": "array"
                                      },
                                      "fragment": {
                                        "type": "string"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "language": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "entities",
                                      "document",
                                      "fragment",
                                      "id",
                                      "language",
                                      "primary_entity",
                                      "analyst_note"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "For_each_hit": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "equals": [
                                  "@parameters('create_incident')",
                                  "true"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "For_each_hit": {
                          "foreach": "@items('For_each_triggered_alert')['hits']",
                          "actions": {
                            "Parse_JSON": {
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@items('For_each_hit')",
                                "schema": {
                                  "properties": {
                                    "document": {
                                      "properties": {
                                        "authors": {
                                          "items": {
                                            "properties": {
                                              "id": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "type": {
                                                "type": "string"
                                              }
                                            },
                                            "required": [
                                              "id",
                                              "name",
                                              "type"
                                            ],
                                            "type": "object"
                                          },
                                          "type": "array"
                                        },
                                        "source": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "type": {
                                              "type": "string"
                                            }
                                          },
                                          "type": "object"
                                        },
                                        "title": {
                                          "type": [
                                            "string",
                                            "null"
                                          ]
                                        }
                                      },
                                      "type": "object"
                                    },
                                    "entities": {
                                      "items": {
                                        "properties": {
                                          "id": {
                                            "type": "string"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "type": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "id",
                                          "name",
                                          "type"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "fragment": {
                                      "type": "string"
                                    },
                                    "id": {
                                      "type": "string"
                                    },
                                    "language": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                }
                              }
                            },
                            "Send_Data_2": {
                              "runAfter": {
                                "Parse_JSON": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": "{\n\"RuleName\": \"@{items('For_each_triggered_alert')?['rule']?['name']}\",\n\"Triggered\": \"@{items('For_each_triggered_alert')?['log']?['triggered']}\",\n\"AlertName\": \"@{items('For_each_triggered_alert')?['title']}\",\n\"AlertID\": \"@{items('For_each_triggered_alert')?['id']}\", \n\"Entity\": @{items('For_each_hit')?['entities']},\n\"Documents\": @{items('For_each_hit')?['document']},\n\"URL\": \"@{items('For_each_triggered_alert')?['rule']?['url']?['portal']}\",\n\"Document_url\": \"@{items('For_each_hit')?['document']?['url']}\",\n\"AISummary\": \"@{items('For_each_triggered_alert')?['ai_insights']?['text']}\",\n\"Fragment\": \"@{replace(replace(body('Parse_JSON')?['fragment'], '\\', '\\\\'), '\"', '\\\"')}\"}",
                                "headers": {
                                  "Log-Type": "RecordedFuturePortalAlerts"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azureloganalyticsdatacollector']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/api/logs"
                              }
                            }
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Search_Triggered_Alerts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Initialize_variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "latest_event_date",
                            "type": "string",
                            "value": "@{addHours(utcNow(), -24)}"
                          }
                        ]
                      }
                    },
                    "Run_query_and_list_results": {
                      "runAfter": {
                        "Initialize_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "RecordedFuturePortalAlerts_CL\n| summarize LatestEvent=max(Triggered_t)",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs_1']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "[[resourceGroup().name]",
                          "resourcename": "[[parameters('workspace_name')]",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "[[subscription().subscriptionId]",
                          "timerange": "Last 7 days"
                        }
                      }
                    },
                    "Search_Triggered_Alerts": {
                      "runAfter": {
                        "Set_variable": [
                          "Succeeded",
                          "Skipped"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuturev2']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/v2/alerts",
                        "queries": {
                          "triggered": "[[@{addSeconds(variables('latest_event_date'),1)},@{utcNow()}]"
                        }
                      }
                    },
                    "Set_variable": {
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "latest_event_date",
                        "value": "@string(body('Run_query_and_list_results')?['value'][0]['LatestEvent'])"
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azureloganalyticsdatacollector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureloganalyticsdatacollectorConnectionName'))]",
                        "connectionName": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureloganalyticsdatacollector')]"
                      },
                      "azuremonitorlogs_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzuremonitorlogsConnectionName'))]",
                        "connectionName": "[[variables('AzuremonitorlogsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "recordedfuturev2": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Recordedfuturev2ConnectionName'))]",
                        "connectionName": "[[variables('Recordedfuturev2ConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-AlertImporter",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureloganalyticsdatacollectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzuremonitorlogsConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('Recordedfuturev2ConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzuremonitorlogsConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzuremonitorlogsConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-4')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Recordedfuturev2ConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('Recordedfuturev2ConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-5')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-Alert-Importer",
            "description": "This playbook imports alerts from Recorded Future and stores them in a custom log in the log analytics workspace. It can create alerts dependant on the parameter: create_incident. ",
            "prerequisites": [
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-09-13T00:00:00Z",
            "tags": [
              "Alert"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-Alert-Importer",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-AlertImporter",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-ThreatIntelligenceImport Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-ThreatIntelligenceImport",
              "type": "string"
            },
            "workspace": {
              "type": "string",
              "defaultValue": "",
              "metadata": {
                "description": "Microsoft Sentinel Workspace name"
              }
            }
          },
          "variables": {
            "MicrosoftSentinelConnectionName": "[[concat('MicrosoftSentinel-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Batch_messages": {
                      "type": "Batch",
                      "inputs": {
                        "configurations": {
                          "RFImportToSentinel": {
                            "releaseCriteria": {
                              "messageCount": 100,
                              "recurrence": {
                                "frequency": "Minute",
                                "interval": 10
                              }
                            }
                          }
                        },
                        "mode": "Inline"
                      }
                    }
                  },
                  "actions": {
                    "Compose": {
                      "runAfter": {
                        "Select": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose",
                      "inputs": {
                        "sourcesystem": "Recorded Future",
                        "value": "@body('Select')"
                      }
                    },
                    "Select": {
                      "type": "Select",
                      "inputs": {
                        "from": "@triggerBody()['items']",
                        "select": "@item()['content']"
                      }
                    },
                    "Threat_Intelligence_-_Upload_Indicators_of_Compromise_(Private_Preview)": {
                      "runAfter": {
                        "Compose": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@outputs('Compose')",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "[[concat('/ThreatIntelligence/', reference(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace'))).customerId,'/UploadIndicators')]"
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]",
                        "connectionName": "[[variables('MicrosoftSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-ThreatIntelligenceImport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('MicrosoftSentinelConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('MicrosoftSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('MicrosoftSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-ThreatIntelligenceImport",
            "description": "This playbook will write indicators in batch to ThreatIntelligenceIndicator log analytics table.",
            "prerequisites": [
              "Microsoft Sentinel Threat Intelligence active"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-ThreatIntelligenceImport",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId5')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-ThreatIntelligenceImport",
        "contentProductId": "[variables('_playbookcontentProductId5')]",
        "id": "[variables('_playbookcontentProductId5')]",
        "version": "[variables('playbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-Domain-IndicatorImport Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion6')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-Domain-IndicatorImport",
              "type": "string"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ThreatIntelligenceImport",
              "type": "String"
            }
          },
          "variables": {
            "RecordedfutureConnectionName": "[[concat('Recordedfuture-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 2
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "actions": {
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "created": "@{utcNow()}",
                              "description": "Recorded Future - Domains - Command and Control Activity",
                              "id": "indicator--@{guid()}",
                              "indicator_types": [
                                "malicious-activity"
                              ],
                              "labels": [
                                "@{body('Parse_JSON')?['EvidenceDetails']?['EvidenceDetails']}"
                              ],
                              "modified": "@{utcNow()}",
                              "name": "@{body('Parse_JSON')?['Name']}",
                              "pattern": "[[[domain-name:value = '@{body('Parse_JSON')?['Name']}']",
                              "pattern_type": "stix",
                              "spec_version": "2.1",
                              "type": "indicator",
                              "valid_from": "@{utcNow()}",
                              "valid_until": "@{addHours(utcNow(),2)}"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/domain_c2_dns.json"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedfutureConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-Domain-IndicatorImport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedfutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('RecordedfutureConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId6'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId6')]",
                "contentId": "[variables('_playbookContentId6')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-Domain-IndicatorImport",
            "description": "This playbook imports Domain risk lists from Recorded Future and stores them as Threat Intelligence Indicators in Microsoft Sentinel, for detection purposes.\n\nThis playbook depends on RecordedFuture-ThreatIntelligenceImport that need to be installed **manually** before installing this playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ThreatIntelligenceImport playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-Domain-IndicatorImport",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId6')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-Domain-IndicatorImport",
        "contentProductId": "[variables('_playbookcontentProductId6')]",
        "id": "[variables('_playbookcontentProductId6')]",
        "version": "[variables('playbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-Hash-IndicatorImport Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion7')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-Hash-IndicatorImport",
              "type": "string"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ThreatIntelligenceImport",
              "type": "String"
            }
          },
          "variables": {
            "RecordedfutureConnectionName": "[[concat('Recordedfuture-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "actions": {
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "created": "@{utcNow()}",
                              "description": "Recorded Future - HASH - Observed in Underground Virus Testing Sites",
                              "id": "indicator--@{guid()}",
                              "indicator_types": [
                                "malicious-activity"
                              ],
                              "labels": [
                                "@{body('Parse_JSON')?['EvidenceDetails']?['EvidenceDetails']}"
                              ],
                              "modified": "@{utcNow()}",
                              "name": "@{body('Parse_JSON')?['Name']}",
                              "pattern": "[[[file:hashes.'@{body('Parse_JSON')?['Algorithm']}' = '@{body('Parse_JSON')?['Name']}']",
                              "pattern_type": "stix",
                              "spec_version": "2.1",
                              "type": "indicator",
                              "valid_from": "@{utcNow()}",
                              "valid_until": "@{addHours(utcNow(),24)}"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/hash_observed_testing.json"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedfutureConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-Hash-IndicatorImport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedfutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('RecordedfutureConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId7'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId7')]",
                "contentId": "[variables('_playbookContentId7')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-Hash-IndicatorImport",
            "description": "This playbook imports Hash risk lists from Recorded Future and stores them as Threat Intelligence Indicators in Microsoft Sentinel, for detection purposes.\n\nThis playbook depends on RecordedFuture-ThreatIntelligenceImport that need to be installed **manually** before installing this playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ThreatIntelligenceImport playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-Hash-IndicatorImport",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId7')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-Hash-IndicatorImport",
        "contentProductId": "[variables('_playbookcontentProductId7')]",
        "id": "[variables('_playbookcontentProductId7')]",
        "version": "[variables('playbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-IP-IndicatorImport Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion8')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-IP-IndicatorImport",
              "type": "string"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ThreatIntelligenceImport",
              "type": "String"
            }
          },
          "variables": {
            "RecordedfutureConnectionName": "[[concat('Recordedfuture-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "actions": {
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture-ThreatIntelligenceImport": {
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "created": "@{utcNow()}",
                              "description": "Recorded Future - IP - Actively Communicating C&C Server",
                              "id": "indicator--@{guid()}",
                              "indicator_types": [
                                "malicious-activity"
                              ],
                              "labels": [
                                "@{body('Parse_JSON')?['EvidenceDetails']?['EvidenceDetails']}"
                              ],
                              "modified": "@{utcNow()}",
                              "name": "@{body('Parse_JSON')?['Name']}",
                              "pattern": "[[[ipv4-addr:value = '@{body('Parse_JSON')?['Name']}']",
                              "pattern_type": "stix",
                              "spec_version": "2.1",
                              "type": "indicator",
                              "valid_from": "@{utcNow()}",
                              "valid_until": "@{addHours(utcNow(),1)}"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/ip_active_c2.json"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedfutureConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-IP-IndicatorImport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedfutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('RecordedfutureConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId8'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId8')]",
                "contentId": "[variables('_playbookContentId8')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-IP-IndicatorImport",
            "description": "This playbook imports IP risk lists from Recorded Future and stores them as Threat Intelligence Indicators in Microsoft Sentinel, for detection purposes.\n\nThis playbook depends on RecordedFuture-ThreatIntelligenceImport that need to be installed **manually** before installing this playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ThreatIntelligenceImport playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-IP-IndicatorImport",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId8')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-IP-IndicatorImport",
        "contentProductId": "[variables('_playbookcontentProductId8')]",
        "id": "[variables('_playbookcontentProductId8')]",
        "version": "[variables('playbookVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName9')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-URL-IndicatorImport Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion9')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-URL-IndicatorImport",
              "type": "string"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ThreatIntelligenceImport",
              "type": "String"
            }
          },
          "variables": {
            "RecordedfutureConnectionName": "[[concat('Recordedfuture-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 2
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "actions": {
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "created": "@{utcNow()}",
                              "description": "Recorded Future - URL - Recently Reported by Insikt Group",
                              "id": "indicator--@{guid()}",
                              "indicator_types": [
                                "malicious-activity"
                              ],
                              "labels": [
                                "@{body('Parse_JSON')?['EvidenceDetails']?['EvidenceDetails']}"
                              ],
                              "modified": "@{utcNow()}",
                              "name": "@{body('Parse_JSON')?['Name']}",
                              "pattern": "[[[url:value = '@{body('Parse_JSON')?['Name']}']",
                              "pattern_type": "stix",
                              "spec_version": "2.1",
                              "type": "indicator",
                              "valid_from": "@{utcNow()}",
                              "valid_until": "@{addHours(utcNow(),2)}"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/url_insikt.json"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedfutureConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2017-07-01",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-URL-IndicatorImport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedfutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('RecordedfutureConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId9'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId9')]",
                "contentId": "[variables('_playbookContentId9')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion9')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-URL-IndicatorImport",
            "description": "This playbook imports URL risk lists from Recorded Future and stores them as Threat Intelligence Indicators in Microsoft Sentinel, for detection purposes.\n\nThis playbook depends on RecordedFuture-ThreatIntelligenceImport that need to be installed **manually** before installing this playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ThreatIntelligenceImport playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-URL-IndicatorImport",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId9')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-URL-IndicatorImport",
        "contentProductId": "[variables('_playbookcontentProductId9')]",
        "id": "[variables('_playbookcontentProductId9')]",
        "version": "[variables('playbookVersion9')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName10')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-ImportToSentinel Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion10')]",
          "parameters": {
            "PlaybookName": {
              "type": "string",
              "defaultValue": "RecordedFuture-ImportToSentinel"
            }
          },
          "variables": {
            "GraphSecurityConnectionName": "[[concat('microsoftgraphsecurity-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/microsoftgraphsecurity')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2019-05-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-ImportToSentinel",
                "hidden-SentinelTemplateVersion": "1.1",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('GraphSecurityConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "Select": {
                      "inputs": {
                        "from": "@triggerBody()['items']",
                        "select": "@item()['content']"
                      },
                      "type": "Select"
                    },
                    "Submit_multiple_tiIndicators": {
                      "inputs": {
                        "body": {
                          "value": "@body('Select')"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['microsoftgraphsecurity']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/beta/security/tiIndicators/submitTiIndicators"
                      },
                      "runAfter": {
                        "Select": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Batch_messages": {
                      "inputs": {
                        "configurations": {
                          "RFImportToSentinel": {
                            "releaseCriteria": {
                              "messageCount": 100,
                              "recurrence": {
                                "frequency": "Minute",
                                "interval": 10
                              }
                            }
                          }
                        },
                        "mode": "Inline"
                      },
                      "type": "Batch"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "microsoftgraphsecurity": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/microsoftgraphsecurity')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('GraphSecurityConnectionName'))]",
                        "connectionName": "[[variables('GraphSecurityConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "location": "[[variables('workspace-location-inline')]",
              "name": "[[variables('GraphSecurityConnectionName')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId10'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId10')]",
                "contentId": "[variables('_playbookContentId10')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion10')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-ImportToSentinel",
            "description": "**[Deprecated]**\nDeprecated due to changes in the Threat Intelligence Platform. Use the new IndicatorImport playbooks that is provided in this Solution.\n\nThis playbook is purposed to listen (via batching mechanism provided by Microsoft Azure) for incoming messages from the IndicatorProcessor Playbooks and create submit the indicators for creation",
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "prerequisites": [
              "None"
            ],
            "lastUpdateTime": "2023-08-09T00:00:00Z",
            "tags": [
              "Deprecated",
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.1",
                "title": "Deprecated",
                "notes": [
                  "Deprecated in favor for the new IndicatorImport playbooks. More information can be found in the readme on Github https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Recorded%20Future/Playbooks/readme.md",
                  "Once a new IndicatorImport playbook is installed downloading the same risk list. Deactivate or delete this playbook."
                ]
              },
              {
                "version": "1.0",
                "title": "RecordedFuture-ImportToSentinel",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId10')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-ImportToSentinel",
        "contentProductId": "[variables('_playbookcontentProductId10')]",
        "id": "[variables('_playbookcontentProductId10')]",
        "version": "[variables('playbookVersion10')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName11')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-DOMAIN-C2_DNS_Name-TIProcessor Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion11')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-DOMAIN-C2_DNS_Name-TIProcessor",
              "type": "String"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ImportToSentinel",
              "type": "String"
            }
          },
          "variables": {
            "RecordedFutureConnectionName": "recordedfuture-connectorv2",
            "connection-2": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2019-05-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-DOMAIN-C2_DNS_Name-TIProcessor",
                "hidden-SentinelTemplateVersion": "1.1",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "Parse_JSON": {
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "ParseJson"
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "description": "Recorded Future - DOMAIN - C2 DNS Name",
                              "domainName": "@{body('Parse_JSON')?['Name']}",
                              "expirationDateTime": "@{addHours(utcNow(),2)}",
                              "ingestedDateTime": "@{utcNow()}",
                              "targetProduct": "Azure Sentinel",
                              "threatType": "C2",
                              "tlpLevel": "amber"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch"
                        }
                      },
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/domain_c2_dns.json"
                        }
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 2
                      },
                      "type": "Recurrence"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedFutureConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedFutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId11'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId11')]",
                "contentId": "[variables('_playbookContentId11')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion11')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-DOMAIN-C2_DNS_Name-TIProcessor",
            "description": "**[Deprecated]**\nDeprecated due to changes in the Threat Intelligence Platform. Use the new IndicatorImport playbooks that is provided in this Solution.\n\nThis playbook leverages the Recorded Future API and automatically imports the C&C DNS Name Domain RiskList, as Threat Intelligence Indicators, for detection purposes in Microsoft Sentinel.\n\nThis playbook depends on RecordedFuture-ImportToSentinel that need to be installed **manually** before installing current playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ImportToSentinel playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-08-07T00:00:00Z",
            "tags": [
              "Deprecated",
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor",
                "notes": [
                  "Initial version"
                ]
              },
              {
                "version": "1.1",
                "title": "Deprecated",
                "notes": [
                  "Deprecated in favor for the new IndicatorImport playbooks. More information can be found in the readme on Github https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Recorded%20Future/Playbooks/readme.md",
                  "Once a new IndicatorImport playbook is installed downloading the same risk list. Deactivate or delete this playbook."
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId11')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-DOMAIN-C2_DNS_Name-TIProcessor",
        "contentProductId": "[variables('_playbookcontentProductId11')]",
        "id": "[variables('_playbookcontentProductId11')]",
        "version": "[variables('playbookVersion11')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName12')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-HASH-Obs_in_Underground-TIProcessor Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion12')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-HASH-Obs_in_Underground-TIProcessor",
              "type": "String"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ImportToSentinel",
              "type": "String"
            }
          },
          "variables": {
            "RecordedFutureConnectionName": "recordedfuture-connectorv2",
            "connection-2": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2019-05-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-HASH-Obs_in_Underground-TIProcessor",
                "hidden-SentinelTemplateVersion": "1.1",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "Parse_JSON": {
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "ParseJson"
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "description": "Recorded Future - HASH - Observed in Underground Virus Testing Sites",
                              "expirationDateTime": "@{addDays(utcNow(),1)}",
                              "fileHashType": "unknown",
                              "fileHashValue": "@{body('Parse_JSON')?['Name']}",
                              "ingestedDateTime": "@{utcNow()}",
                              "targetProduct": "Azure Sentinel",
                              "threatType": "Malware",
                              "tlpLevel": "amber"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch"
                        }
                      },
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/hash_observed_testing.json"
                        }
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedFutureConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedFutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId12'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId12')]",
                "contentId": "[variables('_playbookContentId12')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion12')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-HASH-Obs_in_Underground-TIProcessor",
            "description": "**[Deprecated]**\nDeprecated due to changes in the Threat Intelligence Platform. Use the new IndicatorImport playbooks that is provided in this Solution.\n\nThis playbook leverages the Recorded Future API and automatically imports the Observed in Underground Virus Testing Sites Hash RiskList, as Threat Intelligence Indicators, for detection purposes in Microsoft Sentinel.\n\nThis playbook depends on RecordedFuture-ImportToSentinel that need to be installed **manually** before installing current playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ImportToSentinel playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-08-09T00:00:00Z",
            "tags": [
              "Deprecated",
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.1",
                "title": "Deprecated",
                "notes": [
                  "Deprecated in favor for the new IndicatorImport playbooks. More information can be found in the readme on Github https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Recorded%20Future/Playbooks/readme.md",
                  "Once a new IndicatorImport playbook is installed downloading the same risk list. Deactivate or delete this playbook."
                ]
              },
              {
                "version": "1.0",
                "title": "RecordedFuture-HASH-Obs_in_Underground-TIProcessor",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId12')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-HASH-Obs_in_Underground-TIProcessor",
        "contentProductId": "[variables('_playbookcontentProductId12')]",
        "id": "[variables('_playbookcontentProductId12')]",
        "version": "[variables('playbookVersion12')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName13')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-IP-Actively_Comm_C2_Server-TIProcessor Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion13')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-IP-Actively_Comm_C2_Server-TIProcessor",
              "type": "String"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ImportToSentinel",
              "type": "String"
            }
          },
          "variables": {
            "RecordedFutureConnectionName": "recordedfuture-connectorv2",
            "connection-2": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2019-05-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-IP-Actively_Comm_C2_Server-TIProcessor",
                "hidden-SentinelTemplateVersion": "1.1",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "Parse_JSON": {
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "ParseJson"
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "description": "Recorded Future - IP - Actively Communicating C&C Server",
                              "expirationDateTime": "@{addHours(utcNow(),1)}",
                              "ingestedDateTime": "@{utcNow()}",
                              "networkIPv4": "@{body('Parse_JSON')?['Name']}",
                              "targetProduct": "Azure Sentinel",
                              "threatType": "C2",
                              "tlpLevel": "amber"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch"
                        }
                      },
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/ip_active_c2.json"
                        }
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedFutureConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedFutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId13'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId13')]",
                "contentId": "[variables('_playbookContentId13')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion13')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-IP-Actively_Comm_C2_Server-TIProcessor",
            "description": "**[Deprecated]**\nDeprecated due to changes in the Threat Intelligence Platform. Use the new IndicatorImport playbooks that is provided in this Solution.\n\nThis playbook leverages the Recorded Future API and automatically imports the Actively Communicating C&C Server IP RiskList, as Threat Intelligence Indicators, for detection purposes in Microsoft Sentinel.\n\nThis playbook depends on RecordedFuture-ImportToSentinel that need to be installed **manually** before installing current playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ImportToSentinel playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-08-09T00:00:00Z",
            "tags": [
              "Deprecated",
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.1",
                "title": "Deprecated",
                "notes": [
                  "Deprecated in favor for the new IndicatorImport playbooks. More information can be found in the readme on Github https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Recorded%20Future/Playbooks/readme.md",
                  "Once a new IndicatorImport playbook is installed downloading the same risk list. Deactivate or delete this playbook."
                ]
              },
              {
                "version": "1.0",
                "title": "RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId13')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-IP-Actively_Comm_C2_Server-TIProcessor",
        "contentProductId": "[variables('_playbookcontentProductId13')]",
        "id": "[variables('_playbookcontentProductId13')]",
        "version": "[variables('playbookVersion13')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName14')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-URL-Recent_Rep_by_Insikt-TIProcessor Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion14')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-URL-Recent_Rep_by_Insikt-TIProcessor",
              "type": "String"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ImportToSentinel",
              "type": "String"
            }
          },
          "variables": {
            "RecordedFutureConnectionName": "recordedfuture-connectorv2",
            "connection-2": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2019-05-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-URL-Recent_Rep_by_Insikt-TIProcessor",
                "hidden-SentinelTemplateVersion": "1.1",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]"
              ],
              "properties": {
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "actions": {
                    "For_each": {
                      "actions": {
                        "Parse_JSON": {
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "ParseJson"
                        },
                        "RecordedFuture-ImportToSentinel": {
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "description": "Recorded Future - URL - Recently Reported by Insikt Group",
                              "expirationDateTime": "@{addHours(utcNow(),2)}",
                              "ingestedDateTime": "@{utcNow()}",
                              "targetProduct": "Azure Sentinel",
                              "threatType": "MaliciousUrl",
                              "tlpLevel": "amber",
                              "url": "@{body('Parse_JSON')?['Name']}"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          },
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch"
                        }
                      },
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/MicrosoftAzure/url_insikt.json"
                        }
                      },
                      "type": "ApiConnection"
                    }
                  },
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 2
                      },
                      "type": "Recurrence"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "id": "[[concat('/subscriptions/',subscription().subscriptionId,'/providers/Microsoft.Web/locations/',variables('workspace-location-inline'),'/managedApis/recordedfuturev2')]",
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedFutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedFutureConnectionName')]"
                      }
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedFutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId14'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId14')]",
                "contentId": "[variables('_playbookContentId14')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion14')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-URL-Recent_Rep_by_Insikt-TIProcessor",
            "description": "**[Deprecated]**\nDeprecated due to changes in the Threat Intelligence Platform. Use the new IndicatorImport playbooks that is provided in this Solution.\n\nThis playbook leverages the Recorded Future API and automatically imports the Recently Reported by Insikt Group URL RiskList, as Threat Intelligence Indicators, for detection purposes in Microsoft Sentinel.\n\nThis playbook depends on RecordedFuture-ImportToSentinel that need to be installed **manually** before installing current playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ImportToSentinel playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2022-08-09T00:00:00Z",
            "tags": [
              "Deprecated",
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.1",
                "title": "Deprecated",
                "notes": [
                  "Deprecated in favor for the new IndicatorImport playbooks. More information can be found in the readme on Github https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Recorded%20Future/Playbooks/readme.md",
                  "Once a new IndicatorImport playbook is installed downloading the same risk list. Deactivate or delete this playbook."
                ]
              },
              {
                "version": "1.0",
                "title": "RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId14')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-URL-Recent_Rep_by_Insikt-TIProcessor",
        "contentProductId": "[variables('_playbookcontentProductId14')]",
        "id": "[variables('_playbookcontentProductId14')]",
        "version": "[variables('playbookVersion14')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName15')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-Ukraine-IndicatorProcessor Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion15')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-Ukraine-IndicatorProcessor",
              "type": "string"
            },
            "PlaybookNameBatching": {
              "defaultValue": "RecordedFuture-ImportToSentinel",
              "type": "string"
            }
          },
          "variables": {
            "RecordedfutureConnectionName": "recordedfuture-connectorv2",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Day",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download')",
                      "actions": {
                        "Parse_JSON": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture_Ukraine_Detection_ImportToSentinel": {
                          "runAfter": {
                            "Parse_JSON": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON')?['Risk'])",
                              "description": "Recorded Future - Ukraine IP Detection",
                              "expirationDateTime": "@{addDays(utcNow(),1)}",
                              "ingestedDateTime": "@{utcNow()}",
                              "isActive": true,
                              "networkIPv4": "@{body('Parse_JSON')?['Name']}",
                              "targetProduct": "Azure Sentinel",
                              "threatType": "WatchList",
                              "tlpLevel": "Amber"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_2": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download_2')",
                      "actions": {
                        "Parse_JSON_2": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each_2')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture_Ukraine_Detection_ImportToSentinel_2": {
                          "runAfter": {
                            "Parse_JSON_2": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON_2')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON_2')?['Risk'])",
                              "description": "Recorded Future - Ukraine Domain Detection",
                              "domainName": "@{body('Parse_JSON_2')?['Name']}",
                              "expirationDateTime": "@{addHours(utcNow(),2)}",
                              "ingestedDateTime": "@{utcNow()}",
                              "isActive": true,
                              "targetProduct": "Microsoft Sentinel",
                              "threatType": "WatchList",
                              "tlpLevel": "Amber"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download_2": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_3": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download_3')",
                      "actions": {
                        "Parse_JSON_3": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each_3')",
                            "schema": {
                              "properties": {
                                "EvidenceDetails": {
                                  "properties": {
                                    "EvidenceDetails": {
                                      "items": {
                                        "properties": {
                                          "Criticality": {
                                            "type": "integer"
                                          },
                                          "CriticalityLabel": {
                                            "type": "string"
                                          },
                                          "EvidenceString": {
                                            "type": "string"
                                          },
                                          "Rule": {
                                            "type": "string"
                                          },
                                          "Timestamp": {
                                            "type": "integer"
                                          }
                                        },
                                        "required": [
                                          "Rule",
                                          "EvidenceString",
                                          "CriticalityLabel",
                                          "Timestamp",
                                          "Criticality"
                                        ],
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "Name": {
                                  "type": "string"
                                },
                                "Risk": {
                                  "type": "integer"
                                },
                                "riskString": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture_Ukraine_Detection_ImportToSentinel_3": {
                          "runAfter": {
                            "Parse_JSON_3": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON_3')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON_3')?['Risk'])",
                              "description": "Recorded Future - Ukraine Url Detection",
                              "expirationDateTime": "@{addHours(utcNow(),2)}",
                              "ingestedDateTime": "@{utcNow()}",
                              "isActive": true,
                              "targetProduct": "Microsoft Sentinel",
                              "threatType": "MaliciousUrl",
                              "tlpLevel": "Amber",
                              "url": "@{body('Parse_JSON_3')?['Name']}"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download_3": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "For_each_4": {
                      "foreach": "@body('Recorded_Future_RiskLists_and_SCF_Download_4')",
                      "actions": {
                        "Parse_JSON_4": {
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@items('For_each_4')",
                            "schema": {
                              "properties": {
                                "body": {
                                  "items": {
                                    "properties": {
                                      "Algorithm": {
                                        "type": "string"
                                      },
                                      "EvidenceDetails": {
                                        "properties": {
                                          "EvidenceDetails": {
                                            "items": {
                                              "properties": {
                                                "Criticality": {
                                                  "type": "integer"
                                                },
                                                "CriticalityLabel": {
                                                  "type": "string"
                                                },
                                                "EvidenceString": {
                                                  "type": "string"
                                                },
                                                "MitigationString": {
                                                  "type": "string"
                                                },
                                                "Rule": {
                                                  "type": "string"
                                                },
                                                "Timestamp": {
                                                  "type": "integer"
                                                }
                                              },
                                              "required": [
                                                "Rule",
                                                "EvidenceString",
                                                "CriticalityLabel",
                                                "Timestamp",
                                                "MitigationString",
                                                "Criticality"
                                              ],
                                              "type": "object"
                                            },
                                            "type": "array"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "Name": {
                                        "type": "string"
                                      },
                                      "Risk": {
                                        "type": "integer"
                                      },
                                      "RiskString": {
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "Name",
                                      "Algorithm",
                                      "Risk",
                                      "RiskString",
                                      "EvidenceDetails"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                },
                                "headers": {
                                  "properties": {
                                    "CF-Cache-Status": {
                                      "type": "string"
                                    },
                                    "CF-RAY": {
                                      "type": "string"
                                    },
                                    "Cache-Control": {
                                      "type": "string"
                                    },
                                    "Content-Length": {
                                      "type": "string"
                                    },
                                    "Content-Type": {
                                      "type": "string"
                                    },
                                    "Date": {
                                      "type": "string"
                                    },
                                    "Expect-CT": {
                                      "type": "string"
                                    },
                                    "Timing-Allow-Origin": {
                                      "type": "string"
                                    },
                                    "Transfer-Encoding": {
                                      "type": "string"
                                    },
                                    "pragma": {
                                      "type": "string"
                                    },
                                    "referrer-policy": {
                                      "type": "string"
                                    },
                                    "strict-transport-security": {
                                      "type": "string"
                                    },
                                    "x-content-type-options": {
                                      "type": "string"
                                    },
                                    "x-frame-options": {
                                      "type": "string"
                                    },
                                    "x-ms-apihub-cached-response": {
                                      "type": "string"
                                    },
                                    "x-ms-apihub-obo": {
                                      "type": "string"
                                    },
                                    "x-rf-proxy-basepath": {
                                      "type": "string"
                                    },
                                    "x-rf-proxy-serviceid": {
                                      "type": "string"
                                    },
                                    "x-xss-protection": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "statusCode": {
                                  "type": "integer"
                                }
                              },
                              "type": "object"
                            }
                          }
                        },
                        "RecordedFuture_Ukraine_Detection_ImportToSentinel_4": {
                          "runAfter": {
                            "Parse_JSON_4": [
                              "Succeeded"
                            ]
                          },
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": {
                              "action": "alert",
                              "additionalInformation": "@{body('Parse_JSON_4')?['EvidenceDetails']}",
                              "azureTenantId": "[[subscription().tenantId]",
                              "confidence": "@int(body('Parse_JSON_4')?['Risk'])",
                              "description": "Recorded Future - Ukraine File Hash Detection",
                              "expirationDateTime": "@{addHours(utcNow(),2)}",
                              "filehashtype": "@{replace(replace(body('Parse_JSON_4')?['Algorithm'],'SHA-256', 'sha256'),'SHA-1', 'sha1')}",
                              "filehashvalue": "@{body('Parse_JSON_4')?['Name']}",
                              "ingestedDateTime": "@{utcNow()}",
                              "isActive": true,
                              "targetProduct": "Microsoft Sentinel",
                              "threatType": "Malware",
                              "tlpLevel": "Amber"
                            },
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Logic/workflows/', parameters('PlaybookNameBatching'))]"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Recorded_Future_RiskLists_and_SCF_Download_4": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/ukraine/ukraine_russia_ip.csv"
                        }
                      }
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download_2": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/ukraine/ukraine_russia_domain.csv"
                        }
                      }
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download_3": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/ukraine/ukraine_russia_url.csv"
                        }
                      }
                    },
                    "Recorded_Future_RiskLists_and_SCF_Download_4": {
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['recordedfuture']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/fusion/files",
                        "queries": {
                          "path": "/public/ukraine/ukraine_russia_hash.csv"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "recordedfuture": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]",
                        "connectionName": "[[variables('RecordedfutureConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Recordedfuturev2')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-Ukraine-IndicatorProcessor",
                "hidden-SentinelTemplateVersion": "1.1",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "identity": {
                "type": "SystemAssigned"
              },
              "apiVersion": "2019-05-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('RecordedfutureConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('RecordedfutureConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('RecordedfutureConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId15'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId15')]",
                "contentId": "[variables('_playbookContentId15')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion15')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-Ukraine-IndicatorProcessor",
            "description": "**[Deprecated]**\nDeprecated due to changes in the Threat Intelligence Platform. Use the new IndicatorImport playbooks that is provided in this Solution.\n\nThis playbook leverages the Recorded Future API and automatically imports the Ukraine RiskLists, as Threat Intelligence Indicators, for detection purposes in Microsoft Sentinel.\n\nThis playbook depends on RecordedFuture-ImportToSentinel that need to be installed **manually** before installing current playbook.",
            "prerequisites": [
              "First install the RecordedFuture-ImportToSentinel playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment you have to open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-09-13T00:00:00Z",
            "tags": [
              "Deprecated",
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.1",
                "title": "Deprecated",
                "notes": [
                  "Deprecated in favor for the new IndicatorImport playbooks. More information can be found in the readme on Github https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/Recorded%20Future/Playbooks/readme.md",
                  "Once a new IndicatorImport playbook is installed downloading the same risk list. Deactivate or delete this playbook."
                ]
              },
              {
                "version": "1.0",
                "title": "RecordedFuture-Ukraine-IndicatorProcessor",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId15')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-Ukraine-IndicatorProcessor",
        "contentProductId": "[variables('_playbookcontentProductId15')]",
        "id": "[variables('_playbookcontentProductId15')]",
        "version": "[variables('playbookVersion15')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName16')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-Azure-Connector Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion16')]",
          "parameters": {
            "ConnectorName": {
              "defaultValue": "RecordedFutureCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Recorded Future Custom Connector"
              }
            },
            "ServiceEndpoint": {
              "defaultValue": "https://api.recordedfuture.com/gw/azure/",
              "type": "String",
              "metadata": {
                "description": "Recorded Future API"
              }
            }
          },
          "variables": {
            "operationId-IP_E": "IP_E",
            "_operationId-IP_E": "[[variables('operationId-IP_E')]",
            "operationId-Threat_Map_Actors": "Threat_Map_Actors",
            "_operationId-Threat_Map_Actors": "[[variables('operationId-Threat_Map_Actors')]",
            "operationId-D_E": "D_E",
            "_operationId-D_E": "[[variables('operationId-D_E')]",
            "operationId-U_E": "U_E",
            "_operationId-U_E": "[[variables('operationId-U_E')]",
            "operationId-H_E": "H_E",
            "_operationId-H_E": "[[variables('operationId-H_E')]",
            "operationId-Vuln_E": "Vuln_E",
            "_operationId-Vuln_E": "[[variables('operationId-Vuln_E')]",
            "operationId-Alert_Rules_Search": "Alert_Rules_Search",
            "_operationId-Alert_Rules_Search": "[[variables('operationId-Alert_Rules_Search')]",
            "operationId-Alert_Not_Search": "Alert_Not_Search",
            "_operationId-Alert_Not_Search": "[[variables('operationId-Alert_Not_Search')]",
            "operationId-Alert_Not_Lookup": "Alert_Not_Lookup",
            "_operationId-Alert_Not_Lookup": "[[variables('operationId-Alert_Not_Lookup')]",
            "operationId-R_List_D": "R_List_D",
            "_operationId-R_List_D": "[[variables('operationId-R_List_D')]",
            "operationId-Soar_Bulk_Lookup": "Soar_Bulk_Lookup",
            "_operationId-Soar_Bulk_Lookup": "[[variables('operationId-Soar_Bulk_Lookup')]",
            "operationId-STIX_Indicators": "STIX_Indicators",
            "_operationId-STIX_Indicators": "[[variables('operationId-STIX_Indicators')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId16": "RecordedFuture-Azure-Connector",
            "playbookId16": "[[resourceId('Microsoft.Web/customApis', parameters('ConnectorName'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('ConnectorName')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring"
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('ServiceEndPoint')]"
                },
                "capabilities": "[variables('TemplateEmptyArray')]",
                "brandColor": "#FFFFFF",
                "description": "Recorded Future Connector enables access to the Recorded Future Intelligence. The connector has dedicated actions for pulling Recorded Future indicators (IP, Domain, URL, Hash) and associated context (Risk Score, Risk Rules, Intelligence Card Link and High Confidence Evidence Based Links), Vulnerabilities, Recorded Future Alerts and enables access to Recorded Future SOAR API and Fusion Files.",
                "displayName": "[[parameters('ConnectorName')]",
                "iconUri": "data:image/jpeg;base64,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",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Recorded Future V2",
                    "description": "Recorded Future Connector enables access to the Recorded Future Intelligence. The connector has dedicated actions for pulling Recorded Future indicators (IP, Domain, URL, Hash) and associated context (Risk Score, Risk Rules, Intelligence Card Link and High Confidence Evidence Based Links), Vulnerabilities, Recorded Future Alerts and enables access to Recorded Future SOAR API and Fusion Files",
                    "contact": {
                      "name": "Recorded Future Support",
                      "url": "https://support.recordedfuture.com",
                      "email": "support@recordedfuture.com"
                    },
                    "version": "1.0"
                  },
                  "host": "api.recordedfuture.com",
                  "basePath": "/gw/azure",
                  "schemes": [
                    "https"
                  ],
                  "paths": {
                    "/lookup/ip/{ip}": {
                      "get": {
                        "tags": [
                          "Lookup"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "intelCard": {
                                      "type": "string",
                                      "description": "Recorded Future Intelligence Card Link",
                                      "title": "intelCard",
                                      "x-ms-visibility": "important"
                                    },
                                    "risk": {
                                      "type": "object",
                                      "properties": {
                                        "criticalityLabel": {
                                          "type": "string",
                                          "description": "Recorded Future Indicator Criticality Level",
                                          "title": "criticalityLabel",
                                          "x-ms-visibility": "important"
                                        },
                                        "score": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Recorded Future Indicator Risk Score",
                                          "title": "score",
                                          "x-ms-visibility": "important"
                                        },
                                        "evidenceDetails": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "mitigationString": {
                                                "type": "string",
                                                "description": "Mitigating string",
                                                "x-ms-visibility": "internal"
                                              },
                                              "timestamp": {
                                                "type": "string",
                                                "description": "Timestamp",
                                                "x-ms-visibility": "internal"
                                              },
                                              "criticalityLabel": {
                                                "type": "string",
                                                "description": "Criticality label",
                                                "x-ms-visibility": "internal"
                                              },
                                              "evidenceString": {
                                                "type": "string",
                                                "description": "Recorded Future Risk Rules Evidence Details",
                                                "title": "evidenceString",
                                                "x-ms-visibility": "advanced"
                                              },
                                              "rule": {
                                                "type": "string",
                                                "description": "Recorded Future Indicator Risk Rules",
                                                "title": "rule",
                                                "x-ms-visibility": "important"
                                              },
                                              "criticality": {
                                                "type": "integer",
                                                "format": "int32",
                                                "description": "Criticality",
                                                "x-ms-visibility": "internal"
                                              }
                                            }
                                          },
                                          "description": "Evidence details"
                                        },
                                        "riskString": {
                                          "type": "string",
                                          "description": "Risk string",
                                          "x-ms-visibility": "internal"
                                        },
                                        "rules": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Rules",
                                          "x-ms-visibility": "internal"
                                        },
                                        "criticality": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Criticality",
                                          "x-ms-visibility": "internal"
                                        },
                                        "riskSummary": {
                                          "type": "string",
                                          "description": "Recorded Future Risk Rules Summary",
                                          "title": "riskSummary",
                                          "x-ms-visibility": "advanced"
                                        }
                                      },
                                      "description": "Risk"
                                    },
                                    "links": {
                                      "$ref": "#/definitions/Links"
                                    }
                                  },
                                  "description": "Data"
                                }
                              }
                            }
                          }
                        },
                        "summary": "IP Enrichment",
                        "description": "IP Enrichment with Recorded Future data",
                        "operationId": "[[variables('_operationId-IP_E')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "ip",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "description": "The IP address to lookup. Must be a single IP address",
                            "x-ms-summary": "IP input",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "name": "fields",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "intelCard,risk,links",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "IntelligenceCloudTracking",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "default": true,
                            "description": "Consent",
                            "x-ms-summary": "See trends and track incidents over time using the Recorded Future Intelligence Cloud. This feature stores alerts generated from correlations in the Intelligence Cloud for additional intelligence to provide new analytical insights."
                          }
                        ]
                      }
                    },
                    "/threat/map/actors": {
                      "post": {
                        "tags": [
                          "Threat Hunt"
                        ],
                        "summary": "Fetch Threat Map actors",
                        "description": "Fetch Threat Map data for the enterprise's primary organization with filters.",
                        "operationId": "[[variables('_operationId-Threat_Map_Actors')]",
                        "x-ms-visibility": "important",
                        "consumes": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "x-ms-visibility": "important",
                            "schema": {
                              "type": "object",
                              "x-ms-visibility": "important",
                              "properties": {
                                "actors": {
                                  "description": "List of actors",
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "Description actor1",
                                    "title": "Title actor1",
                                    "x-ms-visibility": "important"
                                  }
                                },
                                "categories": {
                                  "description": "List of categories",
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "Description category1",
                                    "title": "Title category1",
                                    "x-ms-visibility": "important"
                                  }
                                },
                                "watchlists": {
                                  "description": "List of watchlists",
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "Description watchlist1",
                                    "title": "Title watchlist1",
                                    "x-ms-visibility": "important"
                                  }
                                }
                              },
                              "required": [
                                "actors",
                                "categories",
                                "watchlists"
                              ]
                            }
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "Returns Threat Map",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "$ref": "#/definitions/ThreatMapActors"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "/lookup/domain/{domain}": {
                      "get": {
                        "tags": [
                          "Lookup"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "intelCard": {
                                      "type": "string",
                                      "description": "Recorded Future Intelligence Card Link",
                                      "title": "intelCard",
                                      "x-ms-visibility": "important"
                                    },
                                    "risk": {
                                      "type": "object",
                                      "properties": {
                                        "criticalityLabel": {
                                          "type": "string",
                                          "description": "Recorded Future Indicator Criticality Level",
                                          "title": "criticalityLabel",
                                          "x-ms-visibility": "important"
                                        },
                                        "score": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Recorded Future Indicator Risk Score",
                                          "title": "score",
                                          "x-ms-visibility": "important"
                                        },
                                        "evidenceDetails": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "mitigationString": {
                                                "type": "string",
                                                "description": "Mitigating string",
                                                "x-ms-visibility": "internal"
                                              },
                                              "timestamp": {
                                                "type": "string",
                                                "description": "Timestamp",
                                                "x-ms-visibility": "internal"
                                              },
                                              "criticalityLabel": {
                                                "type": "string",
                                                "description": "Criticality label",
                                                "x-ms-visibility": "internal"
                                              },
                                              "evidenceString": {
                                                "type": "string",
                                                "description": "Recorded Future Risk Rules Evidence Details",
                                                "title": "evidenceString",
                                                "x-ms-visibility": "advanced"
                                              },
                                              "rule": {
                                                "type": "string",
                                                "description": "Recorded Future Indicator Risk Rules",
                                                "title": "rule",
                                                "x-ms-visibility": "advanced"
                                              },
                                              "criticality": {
                                                "type": "integer",
                                                "format": "int32",
                                                "description": "Criticality",
                                                "x-ms-visibility": "internal"
                                              }
                                            }
                                          },
                                          "description": "Evidence details"
                                        },
                                        "riskString": {
                                          "type": "string",
                                          "description": "Risk string",
                                          "x-ms-visibility": "internal"
                                        },
                                        "rules": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Rules",
                                          "x-ms-visibility": "internal"
                                        },
                                        "criticality": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Criticality",
                                          "x-ms-visibility": "internal"
                                        },
                                        "riskSummary": {
                                          "type": "string",
                                          "description": "Recorded Future Risk Rules Summary",
                                          "title": "riskSummary",
                                          "x-ms-visibility": "advanced"
                                        }
                                      },
                                      "description": "Risk"
                                    },
                                    "links": {
                                      "$ref": "#/definitions/Links"
                                    }
                                  },
                                  "description": "Data"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Domain Enrichment",
                        "description": "Domain Enrichment with Recorded Future data",
                        "operationId": "[[variables('_operationId-D_E')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "domain",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "description": "The domain to lookup. Must be a single domain",
                            "x-ms-summary": "Domain input",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "name": "fields",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "intelCard,risk,links",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "IntelligenceCloudTracking",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "default": true,
                            "description": "Consent",
                            "x-ms-summary": "See trends and track incidents over time using the Recorded Future Intelligence Cloud. This feature stores alerts generated from correlations in the Intelligence Cloud for additional intelligence to provide new analytical insights."
                          }
                        ]
                      }
                    },
                    "/lookup/url/{url}": {
                      "get": {
                        "tags": [
                          "Lookup"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "risk": {
                                      "type": "object",
                                      "properties": {
                                        "criticalityLabel": {
                                          "type": "string",
                                          "description": "Recorded Future Indicator Criticality Level",
                                          "title": "criticalityLabel",
                                          "x-ms-visibility": "important"
                                        },
                                        "score": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Recorded Future Indicator Risk Score",
                                          "title": "score",
                                          "x-ms-visibility": "important"
                                        },
                                        "evidenceDetails": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "mitigationString": {
                                                "type": "string",
                                                "description": "Mitigating string",
                                                "x-ms-visibility": "internal"
                                              },
                                              "timestamp": {
                                                "type": "string",
                                                "description": "Timestamp",
                                                "x-ms-visibility": "internal"
                                              },
                                              "criticalityLabel": {
                                                "type": "string",
                                                "description": "Criticality label",
                                                "x-ms-visibility": "internal"
                                              },
                                              "evidenceString": {
                                                "type": "string",
                                                "description": "Recorded Future Risk Rules Evidence Details",
                                                "title": "evidenceString",
                                                "x-ms-visibility": "advanced"
                                              },
                                              "rule": {
                                                "type": "string",
                                                "description": "Recorded Future Indicator Risk Rules",
                                                "title": "rule",
                                                "x-ms-visibility": "important"
                                              },
                                              "criticality": {
                                                "type": "integer",
                                                "format": "int32",
                                                "description": "Criticality",
                                                "x-ms-visibility": "internal"
                                              }
                                            }
                                          },
                                          "description": "Evidence details"
                                        },
                                        "riskString": {
                                          "type": "string",
                                          "description": "Risk string",
                                          "x-ms-visibility": "internal"
                                        },
                                        "rules": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Rules",
                                          "x-ms-visibility": "internal"
                                        },
                                        "criticality": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Criticality",
                                          "x-ms-visibility": "internal"
                                        },
                                        "riskSummary": {
                                          "type": "string",
                                          "description": "Recorded Future Risk Rules Summary",
                                          "title": "riskSummary",
                                          "x-ms-visibility": "advanced"
                                        }
                                      },
                                      "description": "Risk"
                                    },
                                    "links": {
                                      "$ref": "#/definitions/Links"
                                    }
                                  },
                                  "description": "Data"
                                }
                              }
                            }
                          }
                        },
                        "summary": "URL Enrichment",
                        "description": "URL Enrichment with Recorded Future data",
                        "operationId": "[[variables('_operationId-U_E')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "url",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "description": "The URL to lookup. Must be a single URL",
                            "x-ms-summary": "URL input",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "name": "fields",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "intelCard,risk,links",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "IntelligenceCloudTracking",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "default": true,
                            "description": "Consent",
                            "x-ms-summary": "See trends and track incidents over time using the Recorded Future Intelligence Cloud. This feature stores alerts generated from correlations in the Intelligence Cloud for additional intelligence to provide new analytical insights."
                          }
                        ]
                      }
                    },
                    "/lookup/hash/{hash}": {
                      "get": {
                        "tags": [
                          "Lookup"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "intelCard": {
                                      "type": "string",
                                      "description": "Recorded Future Intelligence Card Link",
                                      "title": "intelCard",
                                      "x-ms-visibility": "important"
                                    },
                                    "risk": {
                                      "type": "object",
                                      "properties": {
                                        "criticalityLabel": {
                                          "type": "string",
                                          "description": "Recorded Future Indicator Criticality Level",
                                          "title": "criticalityLabel",
                                          "x-ms-visibility": "important"
                                        },
                                        "score": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Recorded Future Indicator Risk Score",
                                          "title": "score",
                                          "x-ms-visibility": "important"
                                        },
                                        "evidenceDetails": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "mitigationString": {
                                                "type": "string",
                                                "description": "Mitigating string",
                                                "x-ms-visibility": "internal"
                                              },
                                              "timestamp": {
                                                "type": "string",
                                                "description": "Timestamp",
                                                "x-ms-visibility": "internal"
                                              },
                                              "criticalityLabel": {
                                                "type": "string",
                                                "description": "Criticality label",
                                                "x-ms-visibility": "internal"
                                              },
                                              "evidenceString": {
                                                "type": "string",
                                                "description": "Recorded Future Risk Rules Evidence Details",
                                                "title": "evidenceString",
                                                "x-ms-visibility": "advanced"
                                              },
                                              "rule": {
                                                "type": "string",
                                                "description": "Recorded Future Indicator Risk Rules",
                                                "title": "rule",
                                                "x-ms-visibility": "important"
                                              },
                                              "criticality": {
                                                "type": "integer",
                                                "format": "int32",
                                                "description": "Criticality",
                                                "x-ms-visibility": "internal"
                                              }
                                            }
                                          },
                                          "description": "Evidence details"
                                        },
                                        "riskString": {
                                          "type": "string",
                                          "description": "Risk string",
                                          "x-ms-visibility": "internal"
                                        },
                                        "rules": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Rules",
                                          "x-ms-visibility": "internal"
                                        },
                                        "criticality": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Criticality",
                                          "x-ms-visibility": "internal"
                                        },
                                        "riskSummary": {
                                          "type": "string",
                                          "description": "Recorded Future Risk Rules Summary",
                                          "title": "riskSummary",
                                          "x-ms-visibility": "advanced"
                                        }
                                      },
                                      "description": "Risk"
                                    },
                                    "links": {
                                      "$ref": "#/definitions/Links"
                                    }
                                  },
                                  "description": "Data"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Hash Enrichment",
                        "description": "Hash Enrichment with Recorded Future data",
                        "operationId": "[[variables('_operationId-H_E')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "hash",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "description": "The HASH to lookup. Must be a single HASH",
                            "x-ms-summary": "HASH input",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "name": "fields",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "intelCard,risk,links",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "IntelligenceCloudTracking",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "default": true,
                            "description": "Consent",
                            "x-ms-summary": "See trends and track incidents over time using the Recorded Future Intelligence Cloud. This feature stores alerts generated from correlations in the Intelligence Cloud for additional intelligence to provide new analytical insights."
                          }
                        ]
                      }
                    },
                    "/lookup/vulnerability/{id}": {
                      "get": {
                        "tags": [
                          "Lookup"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "intelCard": {
                                      "type": "string",
                                      "description": "Recorded Future Intelligence Card Link",
                                      "title": "intelCard",
                                      "x-ms-visibility": "important"
                                    },
                                    "risk": {
                                      "type": "object",
                                      "properties": {
                                        "criticalityLabel": {
                                          "type": "string",
                                          "description": "Recorded Future Vulnerability Criticality Level",
                                          "title": "criticalityLabel",
                                          "x-ms-visibility": "important"
                                        },
                                        "score": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Recorded Future Vulnerability Risk Score",
                                          "title": "score",
                                          "x-ms-visibility": "important"
                                        },
                                        "evidenceDetails": {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "properties": {
                                              "mitigationString": {
                                                "type": "string",
                                                "description": "Mitigating string",
                                                "x-ms-visibility": "internal"
                                              },
                                              "timestamp": {
                                                "type": "string",
                                                "description": "Timestamp",
                                                "x-ms-visibility": "internal"
                                              },
                                              "criticalityLabel": {
                                                "type": "string",
                                                "description": "Criticality label",
                                                "x-ms-visibility": "internal"
                                              },
                                              "evidenceString": {
                                                "type": "string",
                                                "description": "Recorded Future Risk Rules Evidence Details",
                                                "title": "evidenceString",
                                                "x-ms-visibility": "advanced"
                                              },
                                              "rule": {
                                                "type": "string",
                                                "description": "Recorded Future Vulnerability Risk Rules",
                                                "title": "rule",
                                                "x-ms-visibility": "important"
                                              },
                                              "criticality": {
                                                "type": "integer",
                                                "format": "int32",
                                                "description": "Criticality",
                                                "x-ms-visibility": "internal"
                                              }
                                            }
                                          },
                                          "description": "Evidence details"
                                        },
                                        "riskString": {
                                          "type": "string",
                                          "description": "Risk string",
                                          "x-ms-visibility": "internal"
                                        },
                                        "rules": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Rules",
                                          "x-ms-visibility": "internal"
                                        },
                                        "criticality": {
                                          "type": "integer",
                                          "format": "int32",
                                          "description": "Criticality",
                                          "x-ms-visibility": "internal"
                                        },
                                        "riskSummary": {
                                          "type": "string",
                                          "description": "Recorded Future Risk Rules Summary",
                                          "title": "riskSummary",
                                          "x-ms-visibility": "advanced"
                                        }
                                      },
                                      "description": "Risk"
                                    },
                                    "links": {
                                      "$ref": "#/definitions/Links"
                                    }
                                  },
                                  "description": "Data"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Vulnerability Enrichment",
                        "description": "Vulnerability Enrichment with Recorded Future data",
                        "parameters": [
                          {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "description": "The Vulnerability ID (CVE, name) to lookup. Must be a single Vulnerability ID (CVE, name)",
                            "x-ms-summary": "Vulnerability ID (CVE, name) input",
                            "x-ms-url-encoding": "single"
                          },
                          {
                            "name": "fields",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "intelCard,risk,links",
                            "x-ms-visibility": "internal"
                          },
                          {
                            "name": "IntelligenceCloudTracking",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "default": true,
                            "description": "Consent",
                            "x-ms-summary": "See trends and track incidents over time using the Recorded Future Intelligence Cloud. This feature stores alerts generated from correlations in the Intelligence Cloud for additional intelligence to provide new analytical insights."
                          }
                        ],
                        "operationId": "[[variables('_operationId-Vuln_E')]",
                        "x-ms-visibility": "advanced"
                      }
                    },
                    "/alert/rules": {
                      "get": {
                        "tags": [
                          "Alerts"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "results": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "title": {
                                            "type": "string",
                                            "description": "Title",
                                            "title": "Alert Rule Title",
                                            "x-ms-visibility": "advanced"
                                          },
                                          "id": {
                                            "type": "string",
                                            "description": "Id",
                                            "title": "Alert Rule ID",
                                            "x-ms-visibility": "important"
                                          }
                                        }
                                      },
                                      "description": "Results"
                                    }
                                  },
                                  "description": "Data"
                                },
                                "counts": {
                                  "type": "object",
                                  "properties": {
                                    "returned": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "Returned",
                                      "title": "Returned Number of Alert Rules",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "total": {
                                      "type": "integer",
                                      "format": "int32",
                                      "description": "Total",
                                      "title": "Total Number of Alert Rules",
                                      "x-ms-visibility": "advanced"
                                    }
                                  },
                                  "description": "Counts"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Search Alert Rules",
                        "description": "Search Recorded Future UI Alert Rules",
                        "operationId": "[[variables('_operationId-Alert_Rules_Search')]",
                        "x-ms-visibility": "advanced",
                        "parameters": [
                          {
                            "name": "freetext",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "Freetext search for Alert Rule Name",
                            "x-ms-visibility": "advanced",
                            "x-ms-summary": "Freetext search"
                          },
                          {
                            "name": "limit",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "default": 10,
                            "x-ms-visibility": "advanced",
                            "description": "Maximum number of records",
                            "x-ms-summary": "Maximum number of records"
                          }
                        ]
                      }
                    },
                    "/alert/search": {
                      "get": {
                        "tags": [
                          "Alerts"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "$ref": "#/definitions/AlertSearch"
                            }
                          }
                        },
                        "summary": "Search Alert Notifications",
                        "operationId": "[[variables('_operationId-Alert_Not_Search')]",
                        "x-ms-visibility": "advanced",
                        "parameters": [
                          {
                            "name": "triggered",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "All Elasticsearch compatible date formats are valid.",
                            "x-ms-summary": "Triggered",
                            "x-ms-visibility": "advanced"
                          },
                          {
                            "name": "alertRule",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Alert Rule ID",
                            "x-ms-visibility": "important",
                            "x-ms-summary": "Alert Rule ID"
                          },
                          {
                            "name": "limit",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "default": 10,
                            "x-ms-visibility": "advanced",
                            "description": "Maximum number of records",
                            "x-ms-summary": "Maximum number of records"
                          },
                          {
                            "name": "from",
                            "in": "query",
                            "required": false,
                            "type": "integer",
                            "description": "Records from offset",
                            "x-ms-visibility": "advanced",
                            "x-ms-summary": "Records from offset"
                          }
                        ],
                        "description": "Search Alert Notifications"
                      }
                    },
                    "/alert/{id}": {
                      "get": {
                        "tags": [
                          "Alerts"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "$ref": "#/definitions/AlertLookup"
                            }
                          }
                        },
                        "summary": "Lookup Alert Notification",
                        "description": "Lookup Alert Notification",
                        "operationId": "[[variables('_operationId-Alert_Not_Lookup')]",
                        "parameters": [
                          {
                            "name": "id",
                            "in": "path",
                            "required": true,
                            "type": "string",
                            "description": "Alert Notification ID",
                            "x-ms-visibility": "important",
                            "x-ms-summary": "Alert Notification ID",
                            "x-ms-url-encoding": "single"
                          }
                        ],
                        "x-ms-visibility": "advanced"
                      }
                    },
                    "/fusion/files": {
                      "get": {
                        "tags": [
                          "Fusion Files"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "Name": {
                                    "type": "string"
                                  },
                                  "Risk": {
                                    "type": "integer"
                                  },
                                  "RiskString": {
                                    "type": "string"
                                  },
                                  "EvidenceDetails": {
                                    "type": "object",
                                    "properties": {
                                      "EvidenceDetails": {
                                        "type": "array",
                                        "items": {
                                          "type": "object",
                                          "properties": {
                                            "Rule": {
                                              "type": "string"
                                            },
                                            "EvidenceString": {
                                              "type": "string"
                                            },
                                            "CriticalityLabel": {
                                              "type": "string"
                                            },
                                            "Timestamp": {
                                              "type": "integer"
                                            },
                                            "MitigationString": {
                                              "type": "string"
                                            },
                                            "Criticality": {
                                              "type": "integer"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "summary": "Recorded Future RiskLists and SCF Download",
                        "description": "Recorded Future RiskList & Security Control Feeds Download",
                        "operationId": "[[variables('_operationId-R_List_D')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "path",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "x-ms-visibility": "important",
                            "enum": [
                              "/public/MicrosoftAzure/ip_default.json",
                              "/public/MicrosoftAzure/ip_gt_90.json",
                              "/public/MicrosoftAzure/ip_active_c2.json",
                              "/public/MicrosoftAzure/ip_current_c2.json",
                              "/public/MicrosoftAzure/ip_botnet.json",
                              "/public/MicrosoftAzure/ip_insikt.json",
                              "/public/MicrosoftAzure/ip_phishing.json",
                              "/public/MicrosoftAzure/domain_default.json",
                              "/public/MicrosoftAzure/domain_gt_90.json",
                              "/public/MicrosoftAzure/domain_c2_dns.json",
                              "/public/MicrosoftAzure/domain_ransomware_payment.json",
                              "/public/MicrosoftAzure/domain_recent_weaponized.json",
                              "/public/MicrosoftAzure/domain_insikt.json",
                              "/public/MicrosoftAzure/domain_covid_lure.json",
                              "/public/MicrosoftAzure/domain_phishing.json",
                              "/public/MicrosoftAzure/url_gt_90.json",
                              "/public/MicrosoftAzure/url_c2.json",
                              "/public/MicrosoftAzure/url_ransomware_distribution.json",
                              "/public/MicrosoftAzure/url_compromised.json",
                              "/public/MicrosoftAzure/url_insikt.json",
                              "/public/MicrosoftAzure/url_malware_verdict.json",
                              "/public/MicrosoftAzure/hash_targeting_vulns.json",
                              "/public/MicrosoftAzure/hash_observed_testing.json",
                              "/public/MicrosoftAzure/hash_malware_ssl.json",
                              "/public/MicrosoftAzure/vuln_default.json",
                              "/public/MicrosoftAzure/vuln_gt_90.json",
                              "/public/MicrosoftAzure/vuln_recent_active_malware.json",
                              "/public/MicrosoftAzure/vuln_recent_exploit_kit.json",
                              "/public/MicrosoftAzure/vuln_recent_ransomware.json",
                              "/public/MicrosoftAzure/vuln_recent_rat.json",
                              "/public/MicrosoftAzure/vuln_recent_poc_remote.json",
                              "/public/MicrosoftAzure/vuln_recent_exploit_dev_itw.json",
                              "/public/MicrosoftAzure/vuln_exploited_itw_malware.json",
                              "/public/MicrosoftAzure/vuln_critical_cyber_signal.json",
                              "/public/prevent/c2_communicating_ips.json",
                              "/public/prevent/weaponized_domains.json",
                              "/public/prevent/weaponized_urls.json",
                              "/public/ukraine/ukraine_russia_ip.csv",
                              "/public/ukraine/ukraine_russia_domain.csv",
                              "/public/ukraine/ukraine_russia_hash.csv",
                              "/public/ukraine/ukraine_russia_url.csv"
                            ],
                            "x-ms-editor-options": {
                              "items": [
                                {
                                  "title": "IP - Default RiskList",
                                  "value": "/public/MicrosoftAzure/ip_default.json"
                                },
                                {
                                  "title": "IP - 90+ (Very Malicious) RiskList",
                                  "value": "/public/MicrosoftAzure/ip_gt_90.json"
                                },
                                {
                                  "title": "IP - Actively Communicating C&C Server",
                                  "value": "/public/MicrosoftAzure/ip_active_c2.json"
                                },
                                {
                                  "title": "IP - Current C&C Server",
                                  "value": "/public/MicrosoftAzure/ip_current_c2.json"
                                },
                                {
                                  "title": "IP - Recent Botnet Traffic",
                                  "value": "/public/MicrosoftAzure/ip_botnet.json"
                                },
                                {
                                  "title": "IP - Recently Reported by Insikt Group",
                                  "value": "/public/MicrosoftAzure/ip_insikt.json"
                                },
                                {
                                  "title": "IP - Phishing Host",
                                  "value": "/public/MicrosoftAzure/ip_phishing.json"
                                },
                                {
                                  "title": "IP - Ukraine Russia Conflict",
                                  "value": "/public/ukraine/ukraine_russia_ip.csv"
                                },
                                {
                                  "title": "DOMAIN - Default RiskList",
                                  "value": "/public/MicrosoftAzure/domain_default.json"
                                },
                                {
                                  "title": "DOMAIN - 90+ (Very Malicious) RiskList",
                                  "value": "/public/MicrosoftAzure/domain_gt_90.json"
                                },
                                {
                                  "title": "DOMAIN - C&C DNS Name",
                                  "value": "/public/MicrosoftAzure/domain_c2_dns.json"
                                },
                                {
                                  "title": "DOMAIN - Ransomware Payment DNS Name",
                                  "value": "/public/MicrosoftAzure/domain_ransomware_payment.json"
                                },
                                {
                                  "title": "DOMAIN - Recently Active Weaponized Domain",
                                  "value": "/public/MicrosoftAzure/domain_recent_weaponized.json"
                                },
                                {
                                  "title": "DOMAIN - Recently Reported by Insikt Group",
                                  "value": "/public/MicrosoftAzure/domain_insikt.json"
                                },
                                {
                                  "title": "DOMAIN -  Recent COVID-19-Related Domain Lure: Malicious",
                                  "value": "/public/MicrosoftAzure/domain_covid_lure.json"
                                },
                                {
                                  "title": "DOMAIN -  Recent Phishing Lure: Malicious",
                                  "value": "/public/MicrosoftAzure/domain_phishing.json"
                                },
                                {
                                  "title": "DOMAIN - Ukraine Russia Conflict",
                                  "value": "/public/ukraine/ukraine_russia_domain.csv"
                                },
                                {
                                  "title": "URL - 90+ (Very Malicious) RiskList",
                                  "value": "/public/MicrosoftAzure/url_gt_90.json"
                                },
                                {
                                  "title": "URL - C&C URL",
                                  "value": "/public/MicrosoftAzure/url_c2.json"
                                },
                                {
                                  "title": "URL - Ransomware Distribution URL",
                                  "value": "/public/MicrosoftAzure/url_ransomware_distribution.json"
                                },
                                {
                                  "title": "URL - Compromised URL",
                                  "value": "/public/MicrosoftAzure/url_compromised.json"
                                },
                                {
                                  "title": "URL - Recently Reported by Insikt Group",
                                  "value": "/public/MicrosoftAzure/url_insikt.json"
                                },
                                {
                                  "title": "URL - Positive Malware Verdict",
                                  "value": "/public/MicrosoftAzure/url_malware_verdict.json"
                                },
                                {
                                  "title": "URL - Ukraine Russia Conflict",
                                  "value": "/public/ukraine/ukraine_russia_url.csv"
                                },
                                {
                                  "title": "HASH - Recently Active Targeting Vulnerabilities in the Wild",
                                  "value": "/public/MicrosoftAzure/hash_targeting_vulns.json"
                                },
                                {
                                  "title": "HASH - Observed in Underground Virus Testing Sites  ",
                                  "value": "/public/MicrosoftAzure/hash_observed_testing.json"
                                },
                                {
                                  "title": "HASH - Malware SSL Certificate Fingerprint",
                                  "value": "/public/MicrosoftAzure/hash_malware_ssl.json"
                                },
                                {
                                  "title": "HASH - Ukraine Russia Conflict",
                                  "value": "/public/ukraine/ukraine_russia_hash.csv"
                                },
                                {
                                  "title": "(SCF) Security Control Feed: Command and Control IPs",
                                  "value": "/public/prevent/c2_communicating_ips.json"
                                },
                                {
                                  "title": "(SCF) Security Control Feed: Weaponized Domains",
                                  "value": "/public/prevent/weaponized_domains.json"
                                },
                                {
                                  "title": "(SCF) Security Control Feed: Weaponized URLs",
                                  "value": "/public/prevent/weaponized_urls.json"
                                },
                                {
                                  "title": "VULNERABILITY - Default RiskList",
                                  "value": "/public/MicrosoftAzure/vuln_default.json"
                                },
                                {
                                  "title": "VULNERABILITY - 90+ (Very Malicious) RiskList",
                                  "value": "/public/MicrosoftAzure/vuln_gt_90.json"
                                },
                                {
                                  "title": "VULNERABILITY - Exploited in the Wild by Recently Active Malware",
                                  "value": "/public/MicrosoftAzure/vuln_recent_active_malware.json"
                                },
                                {
                                  "title": "VULNERABILITY - Recently Linked to Exploit Kit",
                                  "value": "/public/MicrosoftAzure/vuln_recent_exploit_kit.json"
                                },
                                {
                                  "title": "VULNERABILITY - Recently Linked to Ransomware",
                                  "value": "/public/MicrosoftAzure/vuln_recent_ransomware.json"
                                },
                                {
                                  "title": "VULNERABILITY - Recently Linked to Remote Access Trojan",
                                  "value": "/public/MicrosoftAzure/vuln_recent_rat.json"
                                },
                                {
                                  "title": "VULNERABILITY - Recent Verified Proof of Concept Available Using Remote Execution",
                                  "value": "/public/MicrosoftAzure/vuln_recent_poc_remote.json"
                                },
                                {
                                  "title": "VULNERABILITY - Recently Observed Exploit/Tool Development in the Wild",
                                  "value": "/public/MicrosoftAzure/vuln_recent_exploit_dev_itw.json"
                                },
                                {
                                  "title": "VULNERABILITY - Exploited in the Wild by Malware",
                                  "value": "/public/MicrosoftAzure/vuln_exploited_itw_malware.json"
                                },
                                {
                                  "title": "VULNERABILITY - Cyber Exploit Signal: Critical",
                                  "value": "/public/MicrosoftAzure/vuln_critical_cyber_signal.json"
                                }
                              ]
                            },
                            "description": "Path to file",
                            "x-ms-summary": "Path to file"
                          }
                        ]
                      }
                    },
                    "/soar/lookup": {
                      "post": {
                        "tags": [
                          "SOAR",
                          "Lookup"
                        ],
                        "responses": {
                          "200": {
                            "description": "Default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "counts": {
                                  "type": "object",
                                  "properties": {
                                    "returned": {
                                      "type": "integer"
                                    },
                                    "total": {
                                      "type": "integer"
                                    }
                                  }
                                },
                                "data": {
                                  "type": "object",
                                  "properties": {
                                    "results": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "entity": {
                                            "type": "object",
                                            "properties": {
                                              "id": {
                                                "type": "string"
                                              },
                                              "name": {
                                                "type": "string"
                                              },
                                              "type": {
                                                "type": "string"
                                              }
                                            }
                                          },
                                          "risk": {
                                            "type": "object",
                                            "properties": {
                                              "context": {
                                                "type": "object"
                                              },
                                              "level": {
                                                "type": "number"
                                              },
                                              "rule": {
                                                "type": "object"
                                              },
                                              "score": {
                                                "type": "number"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "summary": "SOAR API - Look up multiple entities",
                        "description": "SOAR API - Look up multiple entities (Specific Access is Required)",
                        "operationId": "[[variables('_operationId-Soar_Bulk_Lookup')]",
                        "x-ms-visibility": "important",
                        "consumes": [
                          "application/json"
                        ],
                        "parameters": [
                          {
                            "name": "body",
                            "in": "body",
                            "required": false,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "ip": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "An IP or array of IPs: array[string]",
                                    "title": "IP",
                                    "x-ms-visibility": "important"
                                  },
                                  "description": "Ip"
                                },
                                "url": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "An URL or array of URLs: array[string]",
                                    "title": "URL",
                                    "x-ms-visibility": "important"
                                  },
                                  "description": "Url"
                                },
                                "domain": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "A domain or array of domains: array[string]",
                                    "title": "Domain",
                                    "x-ms-visibility": "important"
                                  },
                                  "description": "Domain"
                                },
                                "hash": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "A hash or array of hashes: array[string]",
                                    "title": "HASH",
                                    "x-ms-visibility": "advanced"
                                  },
                                  "description": "Hash"
                                },
                                "vulnerability": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "description": "A vulnerability ID or an array of vulnerability IDs: array[string]",
                                    "title": "Vulnerability",
                                    "x-ms-visibility": "advanced"
                                  },
                                  "description": "Vulnerability"
                                }
                              }
                            }
                          },
                          {
                            "name": "IntelligenceCloudTracking",
                            "in": "query",
                            "required": false,
                            "type": "boolean",
                            "default": true,
                            "description": "Consent",
                            "x-ms-summary": "See trends and track incidents over time using the Recorded Future Intelligence Cloud. This feature stores alerts generated from correlations in the Intelligence Cloud for additional intelligence to provide new analytical insights."
                          }
                        ]
                      }
                    },
                    "/threat/indicators/actors": {
                      "post": {
                        "tags": [
                          "Threat Hunt",
                          "STIX"
                        ],
                        "summary": "Fetch Threat Indicators for Actors in STIX format.",
                        "parameters": [
                          {
                            "name": "body",
                            "in": "body",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "actors": {
                                  "type": "array",
                                  "items": {
                                    "type": "string",
                                    "example": "QCwdoU"
                                  }
                                },
                                "categories": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "watchlists": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "trigger_score_ip": {
                                  "type": "integer",
                                  "example": 85
                                },
                                "trigger_score_url": {
                                  "type": "integer",
                                  "example": 85
                                },
                                "trigger_score_domain": {
                                  "type": "integer",
                                  "example": 85
                                },
                                "trigger_score_hash": {
                                  "type": "integer",
                                  "example": 85
                                },
                                "valid_until_delta_hours": {
                                  "type": "integer",
                                  "example": 1
                                },
                                "threat_hunt_description": {
                                  "type": "string",
                                  "example": "Lazarus Group high risk"
                                }
                              },
                              "x-ms-visibility": "important"
                            },
                            "required": true,
                            "x-ms-visibility": "important"
                          }
                        ],
                        "responses": {
                          "200": {
                            "description": "List of Threat Indicator in STIX format.",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "data": {
                                  "$ref": "#/definitions/ThreatHuntActors"
                                }
                              }
                            }
                          }
                        },
                        "operationId": "[[variables('_operationId-STIX_Indicators')]",
                        "description": "Fetch Threat Indicators for Actors in STIX format.",
                        "x-ms-visibility": "important"
                      }
                    }
                  },
                  "x-ms-connector-metadata": [
                    {
                      "propertyName": "Website",
                      "propertyValue": "https://www.recordedfuture.com"
                    },
                    {
                      "propertyName": "Privacy Policy",
                      "propertyValue": "https://www.recordedfuture.com/privacy-policy/"
                    },
                    {
                      "propertyName": "Categories",
                      "propertyValue": "AI;Data"
                    }
                  ],
                  "definitions": {
                    "Links": {
                      "type": "object",
                      "title": "links",
                      "description": "High Confidence Evidence Based Links",
                      "x-ms-visibility": "important",
                      "properties": {
                        "technical": {
                          "type": "object",
                          "title": "technical",
                          "description": "Technical links generated through network traffic analysis, malware analysis, infrastructure analysis and more",
                          "x-ms-visibility": "important",
                          "properties": {
                            "start_date": {
                              "type": "string",
                              "title": "startDate",
                              "description": "Link start date",
                              "x-ms-visibility": "important"
                            },
                            "stop_date": {
                              "type": "string",
                              "title": "stopDate",
                              "description": "Link stop date",
                              "x-ms-visibility": "important"
                            },
                            "entities": {
                              "type": "array",
                              "title": "entities",
                              "description": "Related entities",
                              "x-ms-visibility": "important",
                              "items": {
                                "$ref": "#/definitions/LinkEntities"
                              }
                            }
                          }
                        },
                        "research": {
                          "type": "object",
                          "title": "research",
                          "description": "Research links discovered by Insikt Group",
                          "x-ms-visibility": "important",
                          "properties": {
                            "start_date": {
                              "type": "string",
                              "title": "startDate",
                              "description": "Link start date",
                              "x-ms-visibility": "important"
                            },
                            "stop_date": {
                              "type": "string",
                              "title": "stopDate",
                              "description": "Link stop date",
                              "x-ms-visibility": "important"
                            },
                            "entities": {
                              "type": "array",
                              "title": "entities",
                              "description": "Related entities",
                              "x-ms-visibility": "important",
                              "items": {
                                "$ref": "#/definitions/LinkEntities"
                              }
                            }
                          }
                        }
                      }
                    },
                    "LinkEntities": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string",
                          "title": "type",
                          "description": "Enitity type",
                          "x-ms-visibility": "important"
                        },
                        "name": {
                          "type": "string",
                          "title": "name",
                          "description": "Entity name",
                          "x-ms-visibility": "important"
                        },
                        "score": {
                          "type": "integer",
                          "title": "score",
                          "description": "Risk score",
                          "x-ms-visibility": "important"
                        },
                        "category": {
                          "type": "string",
                          "title": "category",
                          "description": "Entity category",
                          "x-ms-visibility": "important"
                        }
                      }
                    },
                    "AlertSearch": {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "results": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "review": {
                                    "$ref": "#/definitions/AlertReview"
                                  },
                                  "url": {
                                    "$ref": "#/definitions/AlertURL"
                                  },
                                  "rule": {
                                    "$ref": "#/definitions/AlertRule"
                                  },
                                  "triggered": {
                                    "$ref": "#/definitions/AlertTriggered"
                                  },
                                  "id": {
                                    "$ref": "#/definitions/AlertID"
                                  },
                                  "title": {
                                    "$ref": "#/definitions/AlertTitle"
                                  },
                                  "type": {
                                    "$ref": "#/definitions/AlertType"
                                  }
                                }
                              }
                            }
                          }
                        },
                        "counts": {
                          "type": "object",
                          "properties": {
                            "returned": {
                              "type": "integer"
                            },
                            "total": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    },
                    "ThreatMapActors": {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "threat_map": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "string"
                                  },
                                  "name": {
                                    "type": "string"
                                  },
                                  "alias": {
                                    "type": "array",
                                    "items": {
                                      "type": "string"
                                    }
                                  },
                                  "categories": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "id": {
                                          "type": "string"
                                        },
                                        "name": {
                                          "type": "string"
                                        }
                                      }
                                    }
                                  },
                                  "intent": {
                                    "type": "integer",
                                    "format": "int32"
                                  },
                                  "opportunity": {
                                    "type": "integer",
                                    "format": "int32"
                                  },
                                  "log_entries": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "watchlist": {
                                          "type": "object",
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            }
                                          }
                                        },
                                        "entity": {
                                          "type": "object",
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            }
                                          }
                                        },
                                        "severity": {
                                          "type": "integer",
                                          "format": "int32"
                                        },
                                        "axis": {
                                          "type": "string"
                                        },
                                        "date": {
                                          "type": "string",
                                          "format": "date-time"
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            },
                            "date": {
                              "type": "string",
                              "format": "date-time"
                            }
                          }
                        }
                      }
                    },
                    "ThreatHuntActors": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "confidence": {
                            "type": "integer",
                            "example": 89
                          },
                          "description": {
                            "type": "string",
                            "example": "Recorded Future - Threat Hunt - Threat Actor - DOMAIN - Lazarus Group (QCwdoU) - [Lazarus Group high risk]"
                          },
                          "id": {
                            "type": "string",
                            "example": "indicator--321991ed-aca0-4e25-85a0-c1615c95074f"
                          },
                          "indicator_types": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "example": "malicious-activity"
                            }
                          },
                          "labels": {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "example": "{ \"RecordedFuturePortalLink\": \"https://app.recordedfuture.com/live/sc/entity/QCwdoU\"}"
                            }
                          },
                          "name": {
                            "type": "string",
                            "example": "akamaicontainer.com"
                          },
                          "pattern": {
                            "type": "string",
                            "example": "[[[domain-name:value = 'akamaicontainer.com']"
                          },
                          "pattern_type": {
                            "type": "string",
                            "example": "stix"
                          },
                          "spec_version": {
                            "type": "string",
                            "example": "2.1"
                          },
                          "type": {
                            "type": "string",
                            "example": "indicator"
                          },
                          "created": {
                            "type": "string",
                            "example": "2023-09-20T15:39:35.993568+02:00"
                          },
                          "modified": {
                            "type": "string",
                            "example": "2023-09-20T15:39:35.993568+02:00"
                          },
                          "valid_from": {
                            "type": "string",
                            "example": "2023-09-20T15:39:35.993568+02:00"
                          },
                          "valid_until": {
                            "type": "string",
                            "example": "2023-09-20T16:39:35.993568+02:00"
                          },
                          "external_references": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "source_name": {
                                  "type": "string",
                                  "example": "Recorded Future"
                                },
                                "description": {
                                  "type": "string",
                                  "example": "Recorded Future Entity card for Threat Actor: Lazarus Group (QCwdoU)"
                                },
                                "external_id": {
                                  "type": "string",
                                  "example": "QCwdoU"
                                },
                                "url": {
                                  "type": "string",
                                  "example": "https://app.recordedfuture.com/live/sc/entity/QCwdoU"
                                }
                              }
                            }
                          }
                        },
                        "required": [
                          "confidence",
                          "description",
                          "id",
                          "indicator_types",
                          "labels",
                          "name",
                          "pattern",
                          "pattern_type",
                          "spec_version",
                          "type",
                          "created",
                          "modified",
                          "valid_from",
                          "valid_until",
                          "external_references"
                        ]
                      }
                    },
                    "AlertLookup": {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "review": {
                              "$ref": "#/definitions/AlertReview"
                            },
                            "entities": {
                              "$ref": "#/definitions/AlertEntities"
                            },
                            "url": {
                              "$ref": "#/definitions/AlertURL"
                            },
                            "rule": {
                              "$ref": "#/definitions/AlertRule"
                            },
                            "triggered": {
                              "$ref": "#/definitions/AlertTriggered"
                            },
                            "id": {
                              "$ref": "#/definitions/AlertID"
                            },
                            "counts": {
                              "type": "object",
                              "properties": {
                                "references": {
                                  "type": "integer"
                                },
                                "entities": {
                                  "type": "integer"
                                },
                                "documents": {
                                  "type": "integer"
                                }
                              }
                            },
                            "title": {
                              "$ref": "#/definitions/AlertTitle"
                            },
                            "type": {
                              "$ref": "#/definitions/AlertType"
                            }
                          }
                        }
                      }
                    },
                    "AlertReview": {
                      "type": "object",
                      "properties": {
                        "assignee": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string"
                        },
                        "noteDate": {
                          "type": "string"
                        },
                        "noteAuthor": {
                          "type": "string"
                        },
                        "note": {
                          "type": "string"
                        }
                      }
                    },
                    "AlertEntities": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "trend": {
                            "type": "object",
                            "additionalProperties": true
                          },
                          "documents": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "references": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "fragment": {
                                        "type": "string"
                                      },
                                      "entities": {
                                        "type": "array",
                                        "items": {
                                          "type": "object",
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            },
                                            "type": {
                                              "type": "string"
                                            }
                                          }
                                        }
                                      },
                                      "language": {
                                        "type": "string"
                                      }
                                    }
                                  }
                                },
                                "source": {
                                  "type": "object",
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "type": {
                                      "type": "string"
                                    }
                                  }
                                },
                                "title": {
                                  "type": "string"
                                },
                                "url": {
                                  "type": "string"
                                }
                              }
                            }
                          },
                          "risk": {
                            "type": "object",
                            "additionalProperties": true
                          },
                          "entity": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    },
                    "AlertURL": {
                      "type": "string"
                    },
                    "AlertRule": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "id": {
                          "type": "string"
                        },
                        "url": {
                          "type": "string"
                        }
                      }
                    },
                    "AlertTriggered": {
                      "type": "string"
                    },
                    "AlertID": {
                      "type": "string"
                    },
                    "AlertTitle": {
                      "type": "string"
                    },
                    "AlertType": {
                      "type": "string"
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "X-RFToken"
                    }
                  },
                  "security": [
                    {
                      "API Key": "[variables('TemplateEmptyArray')]"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId16'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId16')]",
                "contentId": "[variables('_playbookContentId16')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion16')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId16')]",
        "contentKind": "LogicAppsCustomConnector",
        "displayName": "RecordedFuture-Azure-Connector",
        "contentProductId": "[variables('_playbookcontentProductId16')]",
        "id": "[variables('_playbookcontentProductId16')]",
        "version": "[variables('playbookVersion16')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName17')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-ThreatMap-Importer Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion17')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-ThreatMap-Importer",
              "type": "string"
            },
            "actors": {
              "type": "string",
              "metadata": {
                "description": "Enter value for actors"
              }
            },
            "categories": {
              "type": "string",
              "metadata": {
                "description": "Enter value for categories"
              }
            },
            "watchlists": {
              "type": "string",
              "metadata": {
                "description": "Enter value for watchlists"
              }
            }
          },
          "variables": {
            "Recordedfuturev2devConnectionName": "[[concat('Recordedfuturev2dev-', parameters('PlaybookName'))]",
            "AzureloganalyticsdatacollectorConnectionName": "[[concat('Azureloganalyticsdatacollector-', parameters('PlaybookName'))]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/customApis/Recordedfuturev2dev')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureloganalyticsdatacollector')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "actors": {
                      "defaultValue": "[[parameters('actors')]",
                      "type": "string"
                    },
                    "categories": {
                      "defaultValue": "[[parameters('categories')]",
                      "type": "string"
                    },
                    "watchlists": {
                      "defaultValue": "[[parameters('watchlists')]",
                      "type": "string"
                    }
                  },
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 1
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "Fetch_Threat_Map_actors": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": {
                          "actors": "@parameters('actors')",
                          "categories": "@parameters('categories')",
                          "watchlists": "@parameters('watchlists')"
                        },
                        "headers": {
                          "Content-Type": "application/json"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['RecordedFutureV2Dev_1']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/threat/map/actors"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Parse_JSON')?['data']?['threat_map']",
                      "actions": {
                        "For_each_2": {
                          "foreach": "@items('For_each')?['log_entries']",
                          "actions": {
                            "Compose": {
                              "type": "Compose",
                              "inputs": "@addProperty(items('For_each_2'), 'name', items('For_each')?['name'])"
                            },
                            "Compose_2": {
                              "runAfter": {
                                "Compose": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": "@addProperty(outputs('Compose'), 'id', items('For_each')?['id'])"
                            },
                            "Send_Data": {
                              "runAfter": {
                                "Compose_2": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": "@{outputs('Compose_2')}",
                                "headers": {
                                  "Log-Type": "RecordedFutureThreatMapLogEntries"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azureloganalyticsdatacollector']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/api/logs"
                              }
                            }
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Send_Data_-_Save_full_ThreatMap_response": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Parse_JSON": {
                      "runAfter": {
                        "Fetch_Threat_Map_actors": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Fetch_Threat_Map_actors')",
                        "schema": {
                          "properties": {
                            "data": {
                              "properties": {
                                "date": {
                                  "type": "string"
                                },
                                "threat_map": {
                                  "items": {
                                    "properties": {
                                      "alias": {
                                        "items": {
                                          "type": "string"
                                        },
                                        "type": "array"
                                      },
                                      "categories": {
                                        "items": {
                                          "properties": {
                                            "id": {
                                              "type": "string"
                                            },
                                            "name": {
                                              "type": "string"
                                            }
                                          },
                                          "required": [
                                            "id",
                                            "name"
                                          ],
                                          "type": "object"
                                        },
                                        "type": "array"
                                      },
                                      "id": {
                                        "type": "string"
                                      },
                                      "intent": {
                                        "type": "integer"
                                      },
                                      "log_entries": {
                                        "items": {
                                          "properties": {
                                            "axis": {
                                              "type": "string"
                                            },
                                            "date": {
                                              "type": "string"
                                            },
                                            "entity": {
                                              "properties": {
                                                "id": {
                                                  "type": "string"
                                                },
                                                "name": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            },
                                            "severity": {
                                              "type": "integer"
                                            },
                                            "watchlist": {
                                              "properties": {
                                                "id": {
                                                  "type": "string"
                                                },
                                                "name": {
                                                  "type": "string"
                                                }
                                              },
                                              "type": "object"
                                            }
                                          },
                                          "required": [
                                            "axis",
                                            "date",
                                            "entity",
                                            "severity"
                                          ],
                                          "type": "object"
                                        },
                                        "type": "array"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "opportunity": {
                                        "type": "integer"
                                      }
                                    },
                                    "required": [
                                      "alias",
                                      "categories",
                                      "id",
                                      "intent",
                                      "log_entries",
                                      "name",
                                      "opportunity"
                                    ],
                                    "type": "object"
                                  },
                                  "type": "array"
                                }
                              },
                              "type": "object"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Send_Data_-_Save_full_ThreatMap_response": {
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@{body('Parse_JSON')?['data']?['threat_map']}",
                        "headers": {
                          "Log-Type": "RecordedFutureThreatMap"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azureloganalyticsdatacollector']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/api/logs"
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "RecordedFutureV2Dev_1": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('Recordedfuturev2devConnectionName'))]",
                        "connectionName": "[[variables('Recordedfuturev2devConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/customApis/Recordedfuturev2dev')]"
                      },
                      "azureloganalyticsdatacollector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureloganalyticsdatacollectorConnectionName'))]",
                        "connectionName": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/Azureloganalyticsdatacollector')]"
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-ThreatMap-Importer",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('Recordedfuturev2devConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureloganalyticsdatacollectorConnectionName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('Recordedfuturev2devConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('Recordedfuturev2devConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureloganalyticsdatacollectorConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId17'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId17')]",
                "contentId": "[variables('_playbookContentId17')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion17')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-ThreatIntelligenceImport",
            "description": "This playbook will import Threat Map data from Recorded Future and store it in a custom log.",
            "prerequisites": [
              "Microsoft Sentinel Threat Intelligence active"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-ThreatMap-Importer",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId17')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-ThreatMap-Importer",
        "contentProductId": "[variables('_playbookcontentProductId17')]",
        "id": "[variables('_playbookcontentProductId17')]",
        "version": "[variables('playbookVersion17')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName18')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuture-ThreatHunt-IndicatorImport Playbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion18')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "RecordedFuture-ThreatHunt-IndicatorImport",
              "type": "string"
            }
          },
          "variables": {
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "properties": {
                "provisioningState": "Succeeded",
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "triggers": {
                    "Recurrence": {
                      "recurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "evaluatedRecurrence": {
                        "frequency": "Hour",
                        "interval": 24
                      },
                      "type": "Recurrence"
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Parse_JSON')",
                      "actions": {
                        "RecordedFuture-ThreatIntelligenceImport": {
                          "type": "SendToBatch",
                          "inputs": {
                            "batchName": "RFImportToSentinel",
                            "content": "@items('For_each')",
                            "host": {
                              "triggerName": "Batch_messages",
                              "workflow": {
                                "id": "/subscriptions/5129b3ff-c0c6-4e86-bd1c-70e5fcd579cf/resourceGroups/RF/providers/Microsoft.Logic/workflows/RecordedFuture-ThreatIntelligenceImport"
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Parse_JSON": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "HTTP": {
                      "type": "Http",
                      "inputs": {
                        "body": {
                          "actors": "[variables('TemplateEmptyArray')]",
                          "categories": "[variables('TemplateEmptyArray')]",
                          "threat_hunt_description": "[variables('blanks')]",
                          "trigger_score_domain": 65,
                          "trigger_score_hash": 65,
                          "trigger_score_ip": 65,
                          "trigger_score_url": 65,
                          "valid_until_delta_hours": 24,
                          "watchlists": "[variables('TemplateEmptyArray')]"
                        },
                        "headers": {
                          "Content-Type": "application/json",
                          "X-RFToken": "8077c62e3266491ca3d6897e48f6cc0f"
                        },
                        "method": "POST",
                        "uri": "https://api.recordedfuture.com/gw/azure-qa/threat/indicators/actors"
                      }
                    },
                    "Parse_JSON": {
                      "runAfter": {
                        "HTTP": [
                          "Succeeded"
                        ]
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('HTTP')",
                        "schema": {
                          "items": {
                            "properties": {
                              "confidence": {
                                "type": "integer"
                              },
                              "created": {
                                "type": "string"
                              },
                              "description": {
                                "type": "string"
                              },
                              "id": {
                                "type": "string"
                              },
                              "indicator_types": {
                                "items": {
                                  "type": "string"
                                },
                                "type": "array"
                              },
                              "modified": {
                                "type": "string"
                              },
                              "name": {
                                "type": "string"
                              },
                              "pattern": {
                                "type": "string"
                              },
                              "pattern_type": {
                                "type": "string"
                              },
                              "spec_version": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              },
                              "valid_from": {
                                "type": "string"
                              },
                              "valid_until": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "confidence",
                              "description",
                              "id",
                              "indicator_types",
                              "name",
                              "pattern",
                              "pattern_type",
                              "spec_version",
                              "type",
                              "created",
                              "modified",
                              "valid_from",
                              "valid_until"
                            ],
                            "type": "object"
                          },
                          "type": "array"
                        }
                      }
                    }
                  }
                }
              },
              "name": "[[parameters('PlaybookName')]",
              "type": "Microsoft.Logic/workflows",
              "location": "[[variables('workspace-location-inline')]",
              "tags": {
                "hidden-SentinelTemplateName": "RecordedFuture-ThreatHunt-IndicatorImport",
                "hidden-SentinelTemplateVersion": "1.0",
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              },
              "apiVersion": "2017-07-01",
              "dependsOn": "[variables('TemplateEmptyArray')]"
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId18'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId18')]",
                "contentId": "[variables('_playbookContentId18')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion18')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                }
              }
            }
          ],
          "metadata": {
            "title": "RecordedFuture-ThreatIntelligenceImport",
            "description": "This playbook will write threat hunting indicators in batch to ThreatIntelligenceIndicator log analytics table.",
            "prerequisites": [
              "First install the RecordedFuture-ThreatIntelligenceImport playbook.",
              "To use the Recorded Future for Azure connector, you will need a valid API token from Recorded Future as described in the documentation https://learn.microsoft.com/en-us/connectors/recordedfuturev2/#how-to-get-credentials"
            ],
            "postDeployment": [
              "After deployment, open the playbook to configure all connections and press save."
            ],
            "lastUpdateTime": "2023-07-06T00:00:00Z",
            "tags": [
              "Threat Intelligence"
            ],
            "releaseNotes": [
              {
                "version": "1.0",
                "title": "RecordedFuture-ThreatHunt-IndicatorImport",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId18')]",
        "contentKind": "Playbook",
        "displayName": "RecordedFuture-ThreatHunt-IndicatorImport",
        "contentProductId": "[variables('_playbookcontentProductId18')]",
        "id": "[variables('_playbookcontentProductId18')]",
        "version": "[variables('playbookVersion18')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFuturePlaybookAlertOverviewWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future Playbook Alerts Overview Workbook. This workbook will visualize playbook alerts imported via the RecordedFuture-Playbook-Alert-Importer."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Recorded Future Playbook Alerts\\n---\\n\\nWorkbook to display and analyze Recorded Future Playbook Alerts. This workbook visualize data that is retrived by the ```Recorded Future Playbook Alerts Importer``` Logic app. First run the Logic app once and then select the RecordedFuturePlaybookAlerts_CL table.\",\"style\":\"info\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"8e8c2f1a-d25d-49d1-a217-9831dbc4f919\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_picker\",\"label\":\"Time Picker\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":259200000}},{\"id\":\"f8d34a51-ba10-4241-abff-cb6c14b50a55\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"log_table\",\"label\":\"Playbook Alerts Log Table\",\"type\":2,\"description\":\"Run the Recorded Future Playbook Alert Importer Playbook first.\",\"isRequired\":true,\"query\":\"search *\\n| where $table endswith \\\"_CL\\\" \\n| distinct $table\\n\",\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"RecordedFuturePlaybookAlerts_CL\"},{\"id\":\"89279a9c-af9e-4734-8a98-21aa1f2fa545\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"categories\",\"label\":\"Category\",\"type\":2,\"description\":\"Filter categories you're looking at\",\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"{log_table}\\n| distinct rule_label_s\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_picker\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"a0947450-1ebd-4dea-94d7-41a751c79237\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"status\",\"label\":\"Alert Status\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"{log_table}\\n| distinct status_s\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"25a82661-1700-43a6-ba7a-b3ae5d8fe7b9\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"priority\",\"label\":\"Alert Priority\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"{log_table}\\n| distinct priority_s\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":172800000},\"timeContextFromParameter\":\"time_picker\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where rule_label_s in ({categories:value})\\n| where status_s in ({status:value}) \\n| where priority_s in ({priority:value})\\n| distinct id_s, rule_label_s, updated_date_t\\n| summarize alert_count = count() by rule_label_s\\n| project alert_count, Alert = rule_label_s\",\"size\":0,\"title\":\"Top Categories Triggered\",\"timeContextFromParameter\":\"time_picker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 2\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where rule_label_s in ({categories:value})\\n| where status_s in ({status:value}) \\n| where priority_s in ({priority:value})\\n| distinct id_s, rule_label_s, updated_date_t\\n| summarize Alert=count() by bin(updated_date_t, 1h)\\n\",\"size\":0,\"title\":\"Playbook Alerts triggered over time\",\"timeContextFromParameter\":\"time_picker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy\",\"styleSettings\":{\"maxWidth\":\"70\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where rule_label_s in ({categories:value})\\n| where status_s in ({status:value}) \\n| where priority_s in ({priority:value})\\n| distinct updated_date_t, title_s, rule_label_s, status_s, priority_s, link_s, evidence_summary_s, targets_s, created_date_t, id_s\\n| project-rename Updated=updated_date_t, Title=title_s, Category=rule_label_s, Status=status_s, Priority=priority_s, Created=created_date_t, Targets=targets_s, [\\\"Evidence\\\"]=evidence_summary_s, [\\\"External Link\\\"]=link_s, ID=id_s\\n\\n\",\"size\":0,\"title\":\"Triggered Playbook Alerts\",\"noDataMessage\":\"No data in Playbook Alert custom log. Check that playbook/logic apps is running without errors and rules for playbook alerts is setup in Recorded Future Portal.\",\"timeContextFromParameter\":\"time_picker\",\"exportFieldName\":\"id_s\",\"exportParameterName\":\"exported_alert_id\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Title\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Recorded Future\"}},{\"columnMatch\":\"ID\",\"formatter\":5}],\"sortBy\":[{\"itemKey\":\"Updated\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Updated\",\"sortOrder\":2}]},\"name\":\"query - 8\"}],\"fromTemplateId\":\"sentinel-RecordedFuturePlaybookAlertOverview\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFuturePlaybookAlertOverviewWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future Playbook Alerts Overview Workbook. This workbook will visualize playbook alerts imported via the RecordedFuture-Playbook-Alert-Importer.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Recorded Future - Playbook Alerts Overview; templateRelativePath=RecordedFuturePlaybookAlertOverview.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "RecordedFuturePlaybookAlerts_CL",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureAlertOverviewWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion2')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId2')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future Alerts Overview Workbook. This workbook will visualize playbook alerts imported via the RecordedFuture-Alert-Importer."
              },
              "properties": {
                "displayName": "[parameters('workbook2-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## Recorded Future Alerts\\n---\\n\\nWorkbook to display and analyze Recorded Future Alerts. This workbook visualize data that is retrived by the ```Recorded Future Alerts Importer``` Logic app. First run the Logic app once and then select the RecordedFuturePortalAlerts_CL table.\",\"style\":\"info\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"8e8c2f1a-d25d-49d1-a217-9831dbc4f919\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"time_picker\",\"label\":\"Time Picker\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":86400000}},{\"id\":\"f8d34a51-ba10-4241-abff-cb6c14b50a55\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"log_table\",\"label\":\"Alerts Log Table\",\"type\":2,\"isRequired\":true,\"query\":\"search \\\"*\\\" | summarize count() by $table | sort by count_ desc | where $table endswith \\\"CL\\\" | project $table\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_picker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"RecordedFuturePortalAlerts_CL\"},{\"id\":\"89279a9c-af9e-4734-8a98-21aa1f2fa545\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"alert_rules\",\"label\":\"Alert Rules\",\"type\":2,\"description\":\"Filter alert rules you're looking at\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"{log_table}\\n| distinct RuleName_s\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"time_picker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":[\"value::all\"]}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where RuleName_s in ({alert_rules:value})\\n| distinct AlertID_s, RuleName_s, Triggered_t\\n| summarize alert_count = count() by RuleName_s\\n| project alert_count, Alert = RuleName_s\\n\",\"size\":0,\"title\":\"Top Rules Triggered\",\"noDataMessage\":\"There are no alerts within this time frame.\",\"timeContextFromParameter\":\"time_picker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"query - 2\",\"styleSettings\":{\"maxWidth\":\"30\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where RuleName_s in ({alert_rules:value})\\n| distinct AlertID_s, RuleName_s, Triggered_t\\n| summarize Alert=count() by bin(Triggered_t, 1h)\\n\",\"size\":0,\"title\":\"Alerts triggered over time\",\"timeContextFromParameter\":\"time_picker\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\"},\"customWidth\":\"50\",\"name\":\"query - 2 - Copy\",\"styleSettings\":{\"maxWidth\":\"70\"}},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"20edde78-9485-4056-8eca-6ef7cd86c8b5\",\"cellValue\":\"TAB\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Alert\",\"subTarget\":\"Reference\",\"preText\":\"Some thing\",\"postText\":\"Some thing\",\"style\":\"link\"}]},\"name\":\"links - 5\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where RuleName_s in ({alert_rules:value})\\n//| where Documents_s != \\\"[]\\\"\\n//| distinct AlertID_s, AlertName_s, Documents_s, Entity_description_s, Entity_id_s, Entity_name_s, Entity_type_s, Risk_criticalityLabel_s, \\n//Risk_criticality_d, Risk_documents_s, Risk_evidence_s, RuleName_s, Trend_documents_s, Trend_name_s, Trend_strengthLabel_s, Trend_strength_d, Triggered_t\\n| distinct  Triggered = Triggered_t, [\\\"Alert ID\\\"]=AlertID_s, [\\\"Alert Name\\\"]=AlertName_s, [\\\"Rule Name\\\"]=RuleName_s, [\\\"External Link\\\"]= URL_s\\n\\n\\n\\n\",\"size\":0,\"timeContextFromParameter\":\"time_picker\",\"exportFieldName\":\"Alert ID\",\"exportParameterName\":\"Ref_AlertID\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"External Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Recorded Future\"}},{\"columnMatch\":\"Recorded Future Portal\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}},{\"columnMatch\":\"URL\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Recorded Future\"}}],\"sortBy\":[{\"itemKey\":\"Triggered\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Triggered\",\"sortOrder\":2}]},\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{log_table:value}\\n| where AlertID_s == \\\"{Ref_AlertID}\\\"\\n| project Fragment=Fragment_s, Source=Documents_source_name_s, Title=Documents_title_s, URL=Document_url_s, AlertName = RuleName_s, AlertID=AlertID_s, entities=parse_json(Entity_s)\\n| mv-apply with_itemindex=i entities on (\\n    extend p = pack(strcat(\\\"Entity \\\", i+1), strcat(entities.type, \\\", \\\", entities.name, \\\", id:\\\", entities.id))\\n    | summarize b = make_bag(p)\\n)\\n| evaluate bag_unpack(b)\\n| project-reorder Fragment, Source, Title, URL, Entity*\\n\\n\",\"size\":0,\"timeContextFromParameter\":\"time_picker\",\"exportedParameters\":[{\"fieldName\":\"Fragment\",\"parameterName\":\"FragmentRef\",\"parameterType\":1},{\"fieldName\":\"Title\",\"parameterName\":\"TitleRef\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Fragment\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkIsContextBlade\":true},\"tooltipFormat\":{\"tooltip\":\"{0}\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"Reference\"},\"name\":\"Reference View\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"**Document Title**\\r\\n{TitleRef}\"},\"name\":\"text - 3\"},{\"type\":1,\"content\":{\"json\":\"**Fragment**\\r\\n{FragmentRef}\\r\\n\\r\\n\\r\\n\"},\"showPin\":false,\"name\":\"Fragment\"}]},\"name\":\"group - 4\"}]},\"conditionalVisibility\":{\"parameterName\":\"TAB\",\"comparison\":\"isEqualTo\",\"value\":\"Reference\"},\"name\":\"Reference Alerts\"}],\"fromTemplateId\":\"sentinel-RecordedFutureAlertOverviewWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId2'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFutureAlertOverviewWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future Alerts Overview Workbook. This workbook will visualize playbook alerts imported via the RecordedFuture-Alert-Importer.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Recorded Future - Alerts Overview; templateRelativePath=RecordedFutureAlertOverview.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId2')]",
                "contentId": "[variables('_workbookContentId2')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "RecordedFuturePortalAlerts_CL",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId2')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook2-name')]",
        "contentProductId": "[variables('_workbookcontentProductId2')]",
        "id": "[variables('_workbookcontentProductId2')]",
        "version": "[variables('workbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureDomainCorrelationWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion3')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId3')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future Domain Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel."
              },
              "properties": {
                "displayName": "[parameters('workbook3-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"d7ccc5ca-c8ec-458f-ab0d-564a7ef1d217\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Guide\",\"type\":10,\"isRequired\":true,\"jsonData\":\"[\\n    {\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\n    {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\"}\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"No\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 7\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Guide: Domain Correlation \\n\\nRecorded Future’s Domain Correlation Workbook helps you detect malicious domains within your environment by correlating your logs with Recorded Future Domain Risk Lists.\\n\\n### How to Correlate Domains\\n\\nTo correlate domains, follow the steps below:\\n\\n1. In the **Domain Logs Table** dropdown, select a log table that contains domain logs.\\n\\t* If a particular log table is not listed in the dropdown, ensure it is enabled in your environment.\\n2. In the **Log field with domains** dropdown, select the log field that holds the domains to be correlated.\\n\\t* The workbook can correlate domains in the format: `domainName.net`.\\n3. Select a Recorded Future Domain Risk List for correlation.\\n4. If necessary, adjust the values in the **Logs from** and **Data from** dropdowns to match your requirements.\\n5. Done\\n\\n---\\n\\n#### Log table with examples of correlatable log fields\\n\\n| Table      \\t | Field |\\n| ----------- \\t | ----------- |\\n| DNSEvents      | Name        |\\n| _Im_Dns   \\t | DnsQuery    |\",\"style\":\"info\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"group - 15\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Domains (from logs)\"},\"customWidth\":\"50\",\"name\":\"text - 2\"},{\"type\":1,\"content\":{\"json\":\"### Recorded Future Risk List\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b91b8b5b-10cf-4106-99e2-793eb0d72dce\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Domain_Logs_Time_Range\",\"label\":\"Logs from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":604800000}},{\"id\":\"3300ad41-acbc-4ebd-900a-c6ab250b7c73\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Domain_Logs_Table\",\"label\":\"Domain Logs Table\",\"type\":2,\"description\":\"Log Table to correlate Domains Against\",\"isRequired\":true,\"query\":\"search \\\"*\\\" \\n| where TimeGenerated {Domain_Logs_Time_Range:query}\\n| summarize count() by $table \\n| sort by count_ desc \\n| where $table != \\\"ThreatIntelligenceIndicator\\\" \\n| project $table\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Squid_Proxy_URL_CL\"},{\"id\":\"f4f77ada-b97c-4a82-9421-20a58fb7ce26\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Domain_Logs_Field\",\"label\":\"Log Field with Domains\",\"type\":2,\"description\":\"Select the field containing the Domain Name that you want to correlate against\",\"isRequired\":true,\"query\":\"{Domain_Logs_Table:value}\\n| getschema\\n| where DataType == \\\"System.String\\\"\\n| project ColumnName\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Domain_s\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"95e78560-1e69-437c-8226-7b0f8c4dc199\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Threat_Intelligence_Time_Range\",\"label\":\"Data from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"value\":{\"durationMs\":604800000}},{\"id\":\"e7c7e2ea-f5b3-4505-b64c-b18ca8561168\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RF_Risk_list\",\"label\":\"Risk List\",\"type\":2,\"description\":\"Which Domain Risk List do you want to correlate against\",\"isRequired\":true,\"query\":\"ThreatIntelligenceIndicator\\n| where isnotempty(DomainName)\\n| where Description contains \\\"Recorded Future\\\"\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| summarize count() by Description\\n| project output = strcat('\\\"', Description, '\\\"')\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\\\"Recorded Future - DOMAIN - Default RiskList\\\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 1\"}],\"exportParameters\":true},\"name\":\"group - 10\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected Domains Per Day\\n\\nThe chart displays the number of correlation detections per day between domain logs and Recorded Future's domain Risk lists.\",\"style\":\"info\"},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let list_tlds = ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\\n| where Description == {RF_Risk_list:value}\\n| where isnotempty(DomainName)\\n| where isnotempty(Tags)\\n| extend parts = split(DomainName, '.')\\n| extend tld = parts[(array_length(parts)-1)]\\n| summarize count() by tostring(tld)\\n| summarize make_list(tld);\\nThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where Active == true\\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\\n| where Description == {RF_Risk_list:value}\\n// Picking up only IOC's that contain the entities we want\\n| where isnotempty(DomainName)\\n| where isnotempty(Tags)\\n| join (\\n    {Domain_Logs_Table:value}\\n    | where TimeGenerated  {Domain_Logs_Time_Range:query}\\n    //Extract Domain patterns from syslog message\\n    | where isnotempty({Domain_Logs_Field:value})\\n    | extend parts = split({Domain_Logs_Field:value}, '.')\\n    //Split out the TLD\\n    | extend tld = parts[(array_length(parts)-1)]\\n    //Validate parsed Domain by checking if the TLD is in the list of TLDs in our threat feed\\n    | where tld in~ (list_tlds)\\n    | extend DNS_TimeGenerated = TimeGenerated\\n) on $left.DomainName==$right.{Domain_Logs_Field:value}\\n| summarize Correlation_Matches=count() by bin(DNS_TimeGenerated, 1d)\\n| render barchart\",\"size\":0,\"title\":\"Detected Domains Per Day\",\"noDataMessage\":\"No detected domains\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"100\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"group - 14\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected Domains\\n\\nThe Detected Domains table lists domains from the correlated logs that have been matched with Recorded Future Domain Risk Lists.\\n\\n**Table Columns**\\n\\n* **Risk Score:** The Recorded Future Risk Score for the domain (IOC), ranging from 1 to 99, with 99 being the highest level of severity.\\n* **Domain:** The detected domain.\\n* **Detected:** The time when the log was correlated with a Risk List.\\n* **Log Created:** The time when the log event itself was created.\\n* **Threat Classification:** The type of threat associated with the domain (IOC).\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let list_tlds = ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\\r\\n| where Description == {RF_Risk_list:value}\\r\\n| where isnotempty(DomainName)\\r\\n| where isnotempty(Tags)\\r\\n| extend parts = split(DomainName, '.')\\r\\n| extend tld = parts[(array_length(parts)-1)]\\r\\n| summarize count() by tostring(tld)\\r\\n| summarize make_list(tld);\\r\\nThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Active == true\\r\\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\\r\\n| where Description == {RF_Risk_list:value}\\r\\n// Picking up only IOC's that contain the entities we want\\r\\n| where isnotempty(DomainName)\\r\\n| join (\\r\\n    {Domain_Logs_Table:value}\\r\\n    | where TimeGenerated  {Domain_Logs_Time_Range:query}\\r\\n    //Extract Domain patterns from syslog message\\r\\n    | where isnotempty({Domain_Logs_Field:value})\\r\\n    | extend parts = split({Domain_Logs_Field:value}, '.')\\r\\n    //Split out the TLD\\r\\n    | extend tld = parts[(array_length(parts)-1)]\\r\\n    //Validate parsed Domain by checking if the TLD is in the list of TLDs in our threat feed\\r\\n    | where tld in~ (list_tlds)\\r\\n    | extend DNS_TimeGenerated = TimeGenerated\\r\\n) on $left.DomainName==$right.{Domain_Logs_Field:value}\\r\\n| project [\\\"Risk Score\\\"]=ConfidenceScore, Domain=DomainName, Detected=format_datetime(TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Log Created\\\"]=format_datetime(DNS_TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Threat Classification\\\"]=ThreatType\\r\\n| summarize [\\\"Log Created\\\"]=max([\\\"Log Created\\\"]) by Domain, [\\\"Risk Score\\\"], Detected, [\\\"Threat Classification\\\"]\\r\\n| project [\\\"Risk Score\\\"], Domain, Detected, [\\\"Log Created\\\"], [\\\"Threat Classification\\\"]\\r\\n| sort by [\\\"Risk Score\\\"] desc\",\"size\":0,\"title\":\"Detected Domains\",\"noDataMessage\":\"No detected domains\",\"exportFieldName\":\"Domain\",\"exportParameterName\":\"MaliciousDomainMatch\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Risk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"90\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"65\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"25\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}}]}},\"customWidth\":\"70\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let list_tlds = ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\\r\\n| where Description == {RF_Risk_list:value}\\r\\n| where isnotempty(DomainName)\\r\\n| where isnotempty(Tags)\\r\\n| extend parts = split(DomainName, '.')\\r\\n| extend tld = parts[(array_length(parts)-1)]\\r\\n| summarize count() by tostring(tld)\\r\\n| summarize make_list(tld);\\r\\nThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Active == true\\r\\n// Picking up only Recorded Future IOC's that are pertinent to the use case (Malware C2 Detection)\\r\\n| where Description == {RF_Risk_list:value}\\r\\n// Picking up only IOC's that contain the entities we want\\r\\n| where isnotempty(DomainName)\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {Domain_Logs_Table:value}\\r\\n    | where TimeGenerated  {Domain_Logs_Time_Range:query}\\r\\n    //Extract Domain patterns from syslog message\\r\\n    | where isnotempty({Domain_Logs_Field:value})\\r\\n    | extend parts = split({Domain_Logs_Field:value}, '.')\\r\\n    //Split out the TLD\\r\\n    | extend tld = parts[(array_length(parts)-1)]\\r\\n    //Validate parsed Domain by checking if the TLD is in the list of TLDs in our threat feed\\r\\n    | where tld in~ (list_tlds)\\r\\n    | extend DNS_TimeGenerated = TimeGenerated\\r\\n) on $left.DomainName==$right.{Domain_Logs_Field:value}\\r\\n| project Risk=ConfidenceScore, DomainName, ThreatType, Tags\\r\\n| extend Evidence=parse_json(Tags)[0]\\r\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\r\\n| extend Rule=Evidence['Rule']\\r\\n| summarize count() by tostring(Rule)\\r\\n| sort by count_ desc\\r\\n\\r\\n\",\"size\":0,\"title\":\"Top Triggered Risk Rules\",\"noDataMessage\":\"No triggered Risk Rules\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"30\",\"name\":\"query - 2\"},{\"type\":1,\"content\":{\"json\":\"### Detected Domains: Evidence Details\\n\\nTo view evidence details, click a row (domain) in the Detected Domains table.\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where Description contains {RF_Risk_list:value}\\n| where DomainName == \\\"{MaliciousDomainMatch}\\\"\\n| where isnotempty(Tags)\\n//| where ExpirationDateTime > now()\\n| extend Evidence=parse_json(Tags)[0]\\n| take 1\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\n| project Rules = Evidence['Rule'], Criticality = Evidence['Criticality'], Evidence_String = Evidence['EvidenceString'] \\n| sort by toint(Criticality) desc\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Evidence_String\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"70%\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"MaliciousDomainMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 3\"},{\"type\":1,\"content\":{\"json\":\"\\n### Source data from {Domain_Logs_Table:value}\\nTo view source data of correlated domain, click a row (domain) in the Detected Domains table.\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{Domain_Logs_Table:value}\\n| where TimeGenerated {Domain_Logs_Time_Range:query}\\n| where {Domain_Logs_Field:value} == \\\"{MaliciousDomainMatch}\\\"\\n\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"MaliciousDomainMatch\",\"comparison\":\"isNotEqualTo\",\"value\":\"\"},\"name\":\"query - 1\"}]},\"name\":\"group - 8\"}],\"styleSettings\":{\"paddingStyle\":\"wide\"},\"fromTemplateId\":\"sentinel-RecordedFutureDomainCorrelationWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId3'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFutureDomainCorrelationWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future Domain Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.1; title=Recorded Future - Domain Correlation; templateRelativePath=RecordedFutureDomainCorrelation.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId3')]",
                "contentId": "[variables('_workbookContentId3')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId3')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook3-name')]",
        "contentProductId": "[variables('_workbookcontentProductId3')]",
        "id": "[variables('_workbookcontentProductId3')]",
        "version": "[variables('workbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureHashCorrelationWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion4')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId4')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future Hash Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel."
              },
              "properties": {
                "displayName": "[parameters('workbook4-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"d7ccc5ca-c8ec-458f-ab0d-564a7ef1d217\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"🔎 Guide\",\"type\":10,\"isRequired\":true,\"jsonData\":\"[\\n    {\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\n    {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\"}\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"No\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 7\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Guide: Hash Correlation \\n\\nRecorded Future’s Hash Correlation Workbook helps you detect malicious hashes within your environment by correlating your logs with Recorded Future Hash Risk Lists.\\n\\n### How to Correlate hashs\\n\\nTo correlate hashes, follow the steps below:\\n\\n1. In the **Hash Logs Table** dropdown, select a log table that contains hash logs.\\n\\t* If a particular log table is not listed in the dropdown, ensure it is enabled in your environment.\\n2. In the **Log field with hashes** dropdown, select the log field that holds the hashs to be correlated.\\n\\t* The workbook can correlate hashes in the format: `b0a0c7ae387c00161f4cc26405600b1a`.\\n3. Select a Recorded Future Hash Risk List for correlation.\\n4. If necessary, adjust the values in the **Logs from** and **Data from** dropdowns to match your requirements.\\n5. Done\\n\\n---\\n\\n#### Log table with examples of correlatable log fields\\n| Table      \\t \\t| Field |\\n| ----------- \\t \\t| ----------- |\\n| CommonSecurityLog | FileHash    |\\n| SecurityEvent   \\t| FileHash    |\",\"style\":\"info\"},\"name\":\"text - 0\"}]},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"group - 15\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### Hashes (from logs)\"},\"customWidth\":\"50\",\"name\":\"text - 2\"},{\"type\":1,\"content\":{\"json\":\"### Recorded Future Risk List\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b91b8b5b-10cf-4106-99e2-793eb0d72dce\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Hash_Logs_Time_Range\",\"label\":\"Logs from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":1209600000}},{\"id\":\"3300ad41-acbc-4ebd-900a-c6ab250b7c73\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Hash_Logs_Table\",\"label\":\"Hash Logs Table\",\"type\":2,\"description\":\"Log Table to correlate Domains Against\",\"isRequired\":true,\"query\":\"search \\\"*\\\" \\n| where TimeGenerated {Hash_Logs_Time_Range:query}\\n| summarize count() by $table | sort by count_ desc | where $table != \\\"ThreatIntelligenceIndicator\\\" | project $table\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"EndpointProtection_HASH_CL\"},{\"id\":\"f4f77ada-b97c-4a82-9421-20a58fb7ce26\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Hash_Logs_Field\",\"label\":\"Log Field with Hashes\",\"type\":2,\"description\":\"Select the field containing the Domain Name that you want to correlate against\",\"isRequired\":true,\"query\":\"{Hash_Logs_Table:value}\\n| getschema\\n| where DataType == \\\"System.String\\\"\\n| project ColumnName\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Hash_s\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"95e78560-1e69-437c-8226-7b0f8c4dc199\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Threat_Intelligence_Time_Range\",\"label\":\"Data from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"value\":{\"durationMs\":1209600000}},{\"id\":\"e7c7e2ea-f5b3-4505-b64c-b18ca8561168\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RF_Risk_list\",\"label\":\"Risk List\",\"type\":2,\"description\":\"Which Domain Risk List do you want to correlate against\",\"isRequired\":true,\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where isnotempty(FileHashValue)\\n| where Description contains \\\"Recorded Future\\\"\\n| summarize count() by Description\\n| project output = strcat('\\\"', Description, '\\\"')\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\\\"Recorded Future - HASH - Observed in Underground Virus Testing Sites\\\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 1\"}],\"exportParameters\":true},\"name\":\"group - 10\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected Domains Per Day\\n\\nThe chart displays the number of correlation detections per day between domain logs and Recorded Future's domain Risk lists.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query} \\r\\n| where Description == {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| extend FileHashValue = tolower(FileHashValue)\\r\\n| join (\\r\\n    {Hash_Logs_Table:value}\\r\\n    | where TimeGenerated {Hash_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend Hash_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.FileHashValue == $right.{Hash_Logs_Field:value}\\r\\n| summarize Correlation_Matches=count() by bin(Hash_TimeGenerated, 1d)\\r\\n| render barchart\",\"size\":0,\"title\":\"Detected File Hashes Per Day\",\"noDataMessage\":\"No detected hashes\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 1\"}]},\"name\":\"group - 11\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected Hashs\\n\\nThe Detected Hashs table lists hashs from the correlated logs that have been matched with Recorded Future Hash Risk Lists.\\n\\n**Table Columns**\\n\\n* **Risk Score:** The Recorded Future Risk Score for the Hashe (IOC), ranging from 1 to 99, with 99 being the highest level of severity.\\n* **Hash:** The detected hash.\\n* **Detected:** The time when the log was correlated with a Risk List.\\n* **Log Created:** The time when the log event itself was created.\\n* **Threat Classification:** The type of threat associated with the hash (IOC).\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| extend FileHashValue = tolower(FileHashValue)\\r\\n| join (\\r\\n    {Hash_Logs_Table:value}\\r\\n    | where TimeGenerated {Hash_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend Hash_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.FileHashValue == $right.{Hash_Logs_Field:value}\\r\\n| project [\\\"Risk Score\\\"]=ConfidenceScore, Hash=FileHashValue, Detected = format_datetime(TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Log Created\\\"] = format_datetime(Hash_TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Threat Classification\\\"]=ThreatType\\r\\n| summarize [\\\"Log Created\\\"]=max([\\\"Log Created\\\"]) by Hash, [\\\"Risk Score\\\"], Detected, [\\\"Threat Classification\\\"]\\r\\n| project [\\\"Risk Score\\\"], Hash, Detected, [\\\"Log Created\\\"], [\\\"Threat Classification\\\"]\\r\\n| sort by [\\\"Risk Score\\\"] desc\\r\\n\",\"size\":0,\"title\":\"Detected Hashes\",\"noDataMessage\":\"No detected hashes\",\"exportedParameters\":[{\"fieldName\":\"Hash\",\"parameterName\":\"MaliciousHashMatch\",\"parameterType\":5}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Risk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"90\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"65\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"25\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}}]}},\"customWidth\":\"70\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| extend FileHashValue = tolower(FileHashValue)\\r\\n| join (\\r\\n    {Hash_Logs_Table:value}\\r\\n    | where TimeGenerated {Hash_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend Hash_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.FileHashValue == $right.{Hash_Logs_Field:value}\\r\\n| project Risk=ConfidenceScore, FileHashValue, ThreatType, Tags\\r\\n| extend Evidence=parse_json(Tags)[0]\\r\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\r\\n| extend Rule=Evidence['Rule']\\r\\n| summarize count() by tostring(Rule)\\r\\n| sort by count_ desc\\r\\n\\r\\n\",\"size\":0,\"title\":\"Top Triggered Risk Rules\",\"noDataMessage\":\"No triggered Risk Rules\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}}],\"labelSettings\":[{\"columnId\":\"count_\",\"label\":\"Count\"}]}},\"customWidth\":\"30\",\"name\":\"query - 2\"},{\"type\":1,\"content\":{\"json\":\"### Detected Hashes: Evidence Details\\n\\nTo view evidence details, click a row (hash) in the Detected Hashes table.\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where Description contains {RF_Risk_list:value}\\n| extend FileHashValue = tolower(FileHashValue)\\n| where FileHashValue == \\\"{MaliciousHashMatch}\\\"\\n| where isnotempty(Tags)\\n//| where ExpirationDateTime > now()\\n| extend Evidence=parse_json(Tags)[0]\\n| take 1\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\n| project Rules = Evidence['Rule'], Criticality = Evidence['Criticality'], Evidence_String = Evidence['EvidenceString']\\n| sort by toint(Criticality) desc\",\"size\":1,\"noDataMessage\":\"No evidence details to show\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"MaliciousHashMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 5\"},{\"type\":1,\"content\":{\"json\":\"\\n### Source data from {Hash_Logs_Table:value}\\n\\nTo view source data of correlated hash, click a row (hash) in the Detected Hashes table.\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{Hash_Logs_Table:value}\\n| where TimeGenerated {Hash_Logs_Time_Range:query}\\n| where {Hash_Logs_Field:value} == \\\"{MaliciousHashMatch}\\\"\\n\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"MaliciousHashMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 6\"}]},\"name\":\"group - 8\"}],\"styleSettings\":{\"paddingStyle\":\"wide\"},\"fromTemplateId\":\"sentinel-RecordedFutureHashCorrelationWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId4'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFutureHashCorrelationWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future Hash Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.1; title=Recorded Future - Hash Correlation; templateRelativePath=RecordedFutureHashCorrelation.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId4')]",
                "contentId": "[variables('_workbookContentId4')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId4')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook4-name')]",
        "contentProductId": "[variables('_workbookcontentProductId4')]",
        "id": "[variables('_workbookcontentProductId4')]",
        "version": "[variables('workbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureIPCorrelationWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion5')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId5')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future IP Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel."
              },
              "properties": {
                "displayName": "[parameters('workbook5-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"041885bf-2e2c-42ae-ad35-2e12272b4dc4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Guide\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":\"[variables('TemplateEmptyArray')]\"},\"jsonData\":\"[\\n    {\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\n    {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\"}\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"No\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 6\"},{\"type\":1,\"content\":{\"json\":\"### Guide: IP Correlation \\n\\nRecorded Future’s IP Correlation Workbook helps you detect malicious IPs within your environment by correlating your logs with Recorded Future IP Risk Lists.\\n\\n### How to Correlate IPs\\n\\nTo correlate IPs, follow the steps below:\\n\\n1. In the **IP Logs Table** dropdown, select a log table that contains IP logs.\\n\\t* If a particular log table is not listed in the dropdown, ensure it is enabled in your environment.\\n2. In the **Log field with IPs** dropdown, select the log field that holds the IPs to be correlated.\\n\\t* The workbook can correlate IPs in the format: `5.56.61.62`.\\n3. Select a Recorded Future IP Risk List for correlation.\\n4. If necessary, adjust the values in the **Logs from** and **Data from** dropdowns to match your requirements.\\n5. Done\\n\\n---\\n\\n#### Log table with examples of correlatable log fields\\n\\n\\n| Table                        | Field              | Table                           | Field     |\\n|------------------------------|--------------------|---------------------------------|-----------|\\n| AzureActivity                | CallerIpAddress    | VMConnection                    | RemoteIp  |\\n| AzureDiagnostics             | CallerIPAddress    | W3CIISLog                       | cIP       |\\n| AWSCloudTrail                | SourceIpAddress    | _Im_NetworkSession              | SrcIpAddr |\\n| AppServiceHTTPLogs           | CIp                | _Im_NetworkSession              | DstIpAddr |\\n| AzureDiagnostics             | client_ip_s        | _Im_WebSession                  | SrcIpAddr |\\n| CommonSecurityLog            | SourceIpAddress    | SigninLogs                      | IPAddress |\\n| CommonSecurityLog            | DestinationIP      | AADNonInteractiveUserSignInLogs | IPAddress |\\n| DuoSecurityAuthentication_CL | access_device_ip_s |                                 |           |\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 11\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### IP (from logs)\"},\"customWidth\":\"50\",\"name\":\"text - 2\"},{\"type\":1,\"content\":{\"json\":\"### Recorded Future Risk List\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b91b8b5b-10cf-4106-99e2-793eb0d72dce\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IP_Logs_Time_Range\",\"label\":\"Logs from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":7776000000}},{\"id\":\"3300ad41-acbc-4ebd-900a-c6ab250b7c73\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IP_Logs_Table\",\"label\":\"IP Logs Table\",\"type\":2,\"description\":\"Log Table to correlate IPs Against\",\"isRequired\":true,\"query\":\"search * \\n| where TimeGenerated {IP_Logs_Time_Range:query}\\n| summarize count() by $table \\n| sort by count_ desc \\n| where $table != \\\"ThreatIntelligenceIndicator\\\" \\n| project $table\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"NetScreen_Firewall_CL\"},{\"id\":\"f4f77ada-b97c-4a82-9421-20a58fb7ce26\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"IP_Logs_Field\",\"label\":\"Log Field with IPs\",\"type\":2,\"description\":\"Select the field containing the IP that you want to correlate against\",\"isRequired\":true,\"query\":\"{IP_Logs_Table:value}\\n| where TimeGenerated {IP_Logs_Time_Range:query}\\n| getschema\\n| where DataType == \\\"System.String\\\"\\n| project ColumnName\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Dst_IPv4_s\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"95e78560-1e69-437c-8226-7b0f8c4dc199\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Threat_Intelligence_Time_Range\",\"label\":\"Data from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"value\":{\"durationMs\":5184000000}},{\"id\":\"e7c7e2ea-f5b3-4505-b64c-b18ca8561168\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RF_Risk_list\",\"label\":\"Risk List\",\"type\":2,\"description\":\"Which IP Risk List do you want to correlate against\",\"isRequired\":true,\"query\":\"ThreatIntelligenceIndicator\\n| where isnotempty(NetworkIP)\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where Description contains \\\"Recorded Future\\\"\\n//| summarize count() by Description\\n| distinct Description\\n| project output = strcat('\\\"', Description, '\\\"')\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\\\"Recorded Future - IP - Actively Communicating C&C Server\\\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 1\"}],\"exportParameters\":true},\"name\":\"group - 10\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected IPs Per Day\\n\\nThe chart displays the number of correlation detections per day between IP logs and Recorded Future's IP Risk lists.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {IP_Logs_Table:value}\\r\\n    | where TimeGenerated {IP_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend IP_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.NetworkIP == $right.{IP_Logs_Field:value}\\r\\n| summarize Correlation_Matches=count() by bin(IP_TimeGenerated, 1d)\\r\\n| render barchart\",\"size\":0,\"title\":\"Detected IPs Per Day\",\"noDataMessage\":\"No detected IPs\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 1\"}]},\"name\":\"group - 11\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected IPs\\n\\nThe Detected IPs table lists IPs from the correlated logs that have been matched with Recorded Future IP Risk Lists.\\n\\n**Table Columns**\\n\\n* **Risk Score:** The Recorded Future Risk Score for the IP (IOC), ranging from 1 to 99, with 99 being the highest level of severity.\\n* **IP:** The detected IP.\\n* **Detected:** The time when the log was correlated with a Risk List.\\n* **Log Created:** The time when the log event itself was created.\\n* **Threat Classification:** The type of threat associated with the IP (IOC).\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {IP_Logs_Table:value}\\r\\n    | where TimeGenerated {IP_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend IP_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.NetworkIP == $right.{IP_Logs_Field:value}\\r\\n| project [\\\"Risk Score\\\"]=ConfidenceScore, IP=NetworkIP, Detected=format_datetime(TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Log Created\\\"]=format_datetime(IP_TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Threat Classification\\\"]=ThreatType\\r\\n| summarize [\\\"Log Created\\\"]=max([\\\"Log Created\\\"]) by IP, [\\\"Risk Score\\\"], Detected, [\\\"Threat Classification\\\"]\\r\\n| project [\\\"Risk Score\\\"], IP, Detected, [\\\"Log Created\\\"], [\\\"Threat Classification\\\"]\\r\\n| sort by [\\\"Risk Score\\\"] desc\",\"size\":0,\"title\":\"Detected IPs\",\"noDataMessage\":\"No detected IPs\",\"exportedParameters\":[{\"fieldName\":\"IP\",\"parameterName\":\"MaliciousIPMatch\",\"parameterType\":5}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Risk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"90\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"65\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"25\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AdditionalInformation\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100%\"}}],\"sortBy\":[{\"itemKey\":\"$gen_thresholds_Risk_0\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"$gen_thresholds_Risk_0\",\"sortOrder\":2}]},\"customWidth\":\"70\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {IP_Logs_Table:value}\\r\\n    | where TimeGenerated {IP_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend IP_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.NetworkIP == $right.{IP_Logs_Field:value}\\r\\n| project Risk=ConfidenceScore, NetworkIP, ThreatType, Tags\\r\\n| extend Evidence=parse_json(Tags)[0]\\r\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\r\\n| extend Rule=Evidence['Rule']\\r\\n| summarize count() by tostring(Rule)\\r\\n| sort by count_ desc\",\"size\":0,\"title\":\"Top Triggered Risk Rules\",\"noDataMessage\":\"No triggered Risk Rules\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}}]}},\"customWidth\":\"30\",\"name\":\"query - 2\"},{\"type\":1,\"content\":{\"json\":\"### Detected IPs: Evidence Details\\n\\nTo view evidence details, click a row (IP) in the Detected IPs table.\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where Description contains {RF_Risk_list:value}\\n| where NetworkIP == \\\"{MaliciousIPMatch}\\\"\\n| where isnotempty(Tags)\\n//| where ExpirationDateTime > now()\\n| extend Evidence=parse_json(Tags)[0]\\n| take 1\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\n| project Rules = Evidence['Rule'], Criticality = Evidence['Criticality'], Evidence_String = Evidence['EvidenceString']\\n| sort by toint(Criticality) desc\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Evidence_String\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100%\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"MaliciousIPMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 5\"},{\"type\":1,\"content\":{\"json\":\"\\n### Source data from {IP_Logs_Table:value}\\nTo view source data of correlated IP, click a row (IP) in the Detected IPs table.\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{IP_Logs_Table:value}\\n| where TimeGenerated {IP_Logs_Time_Range:query}\\n| where {IP_Logs_Field:value} == \\\"{MaliciousIPMatch}\\\"\\n\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"MaliciousIPMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 9\"}]},\"name\":\"group - 11\"}],\"styleSettings\":{\"paddingStyle\":\"wide\"},\"fromTemplateId\":\"sentinel-RecordedFutureIPCorrelationWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId5'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFutureIPCorrelationWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future IP Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.1; title=Recorded Future - IP Correlation; templateRelativePath=RecordedFutureIPCorrelation.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId5')]",
                "contentId": "[variables('_workbookContentId5')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId5')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook5-name')]",
        "contentProductId": "[variables('_workbookcontentProductId5')]",
        "id": "[variables('_workbookcontentProductId5')]",
        "version": "[variables('workbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureURLCorrelationWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion6')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId6')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future URL Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel."
              },
              "properties": {
                "displayName": "[parameters('workbook6-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"d7ccc5ca-c8ec-458f-ab0d-564a7ef1d217\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Guide\",\"type\":10,\"isRequired\":true,\"jsonData\":\"[\\n    {\\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\n    {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\"}\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"No\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 7\"},{\"type\":1,\"content\":{\"json\":\"### Guide: URL Correlation \\n\\nRecorded Future’s URL Correlation Workbook helps you detect malicious URLs within your environment by correlating your logs with Recorded Future URL Risk Lists.\\n\\n### How to Correlate URLs\\n\\nTo correlate URLs, follow the steps below:\\n\\n1. In the **URL Logs Table** dropdown, select a log table that contains URL logs.\\n\\t* If a particular log table is not listed in the dropdown, ensure it is enabled in your environment.\\n2. In the **Log field with URLs** dropdown, select the log field that holds the URLs to be correlated.\\n\\t* The workbook can correlate URLs in the format: `https://testurl.here.net`.\\n3. Select a Recorded Future URL Risk List for correlation.\\n4. If necessary, adjust the values in the **Logs from** and **Data from** dropdowns to match your requirements.\\n5. Done\\n\\n---\\n\\n#### Log table with examples of correlatable log fields\\n\\n| Table             | Field      |\\n|-------------------|------------|\\n| CommonSecurityLog | RequestURL |\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 11\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"### URL (from logs)\"},\"customWidth\":\"50\",\"name\":\"text - 2\"},{\"type\":1,\"content\":{\"json\":\"### Recorded Future Risk List\"},\"customWidth\":\"50\",\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b91b8b5b-10cf-4106-99e2-793eb0d72dce\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"URL_Logs_Time_Range\",\"label\":\"Logs from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"value\":{\"durationMs\":7776000000}},{\"id\":\"3300ad41-acbc-4ebd-900a-c6ab250b7c73\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"URL_Logs_Table\",\"label\":\"URL Logs Table\",\"type\":2,\"description\":\"Log Table to correlate URLs Against\",\"isRequired\":true,\"query\":\"search \\\"*\\\" \\n| where TimeGenerated {URL_Logs_Time_Range:query}\\n| summarize count() by $table | sort by count_ desc | where $table != \\\"ThreatIntelligenceIndicator\\\" | project $table\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"Squid_Proxy_URL_CL\"},{\"id\":\"f4f77ada-b97c-4a82-9421-20a58fb7ce26\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"URL_Logs_Field\",\"label\":\"Log Field with URLs\",\"type\":2,\"description\":\"Select the field containing the URL that you want to correlate against\",\"isRequired\":true,\"query\":\"{URL_Logs_Table:value}\\n| getschema\\n| where DataType == \\\"System.String\\\"\\n| project ColumnName\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"URL_s\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"95e78560-1e69-437c-8226-7b0f8c4dc199\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Threat_Intelligence_Time_Range\",\"label\":\"Data from\",\"type\":4,\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"value\":{\"durationMs\":7776000000}},{\"id\":\"e7c7e2ea-f5b3-4505-b64c-b18ca8561168\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"RF_Risk_list\",\"label\":\"Risk List\",\"type\":2,\"description\":\"Which Domain Risk List do you want to correlate against\",\"isRequired\":true,\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where isnotempty(Url)\\n| where Description contains \\\"Recorded Future\\\"\\n| summarize count() by Description\\n| project output = strcat('\\\"', Description, '\\\"')\\n\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"\\\"Recorded Future - URL - Recently Reported by Insikt Group\\\"\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"parameters - 1\"}],\"exportParameters\":true},\"name\":\"group - 10\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected URLs Per Day\\n\\nThe chart displays the number of correlation detections per day between URL logs and Recorded Future's URL Risk lists.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {URL_Logs_Table:value}\\r\\n    | where TimeGenerated {URL_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend URL_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.Url == $right.{URL_Logs_Field:value}\\r\\n| summarize Correlation_Matches=count() by bin(URL_TimeGenerated, 1d)\\r\\n| render barchart\",\"size\":0,\"title\":\"Detected URLs Per Day\",\"noDataMessage\":\"No detected URLs\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"query - 1\"}]},\"name\":\"group - 11\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"\\n### Guide: Detected URLs\\n\\nThe Detected URLs table lists URLs from the correlated logs that have been matched with Recorded Future URL Risk Lists.\\n\\n**Table Columns**\\n\\n* **Risk Score:** The Recorded Future Risk Score for the URL (IOC), ranging from 1 to 99, with 99 being the highest level of severity.\\n* **URL:** The detected URL.\\n* **Detected:** The time when the log was correlated with a Risk List.\\n* **Log Created:** The time when the log event itself was created.\\n* **Threat Classification:** The type of threat associated with the URL (IOC).\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {URL_Logs_Table:value}\\r\\n    | where TimeGenerated {URL_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend IP_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.Url == $right.{URL_Logs_Field:value}\\r\\n| project [\\\"Risk Score\\\"]=ConfidenceScore, URL=Url, Detected = format_datetime(TimeGenerated, 'yyyy-MM-dd HH:mm:ss'), [\\\"Log Created\\\"] = IP_TimeGenerated, [\\\"Threat Classification\\\"]=ThreatType\\r\\n| summarize [\\\"Log Created\\\"]=max([\\\"Log Created\\\"]) by URL, [\\\"Risk Score\\\"], Detected, [\\\"Threat Classification\\\"]\\r\\n| project [\\\"Risk Score\\\"], URL, Detected, [\\\"Log Created\\\"], [\\\"Threat Classification\\\"]\\r\\n| sort by [\\\"Risk Score\\\"] desc\\r\\n\",\"size\":0,\"title\":\"Detected URLs\",\"noDataMessage\":\"No detected URLs\",\"exportFieldName\":\"URL\",\"exportParameterName\":\"MaliciousURLMatch\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Risk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\">=\",\"thresholdValue\":\"90\",\"representation\":\"redBright\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"65\",\"representation\":\"orange\",\"text\":\"{0}{1}\"},{\"operator\":\">=\",\"thresholdValue\":\"25\",\"representation\":\"yellow\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"blue\",\"text\":\"{0}{1}\"}]}}]}},\"customWidth\":\"70\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\r\\n| where Description contains {RF_Risk_list:value}\\r\\n| where isnotempty(Tags)\\r\\n| join (\\r\\n    {URL_Logs_Table:value}\\r\\n    | where TimeGenerated {URL_Logs_Time_Range:query}\\r\\n    // renaming time column so it is clear the log this came from\\r\\n    | extend URL_TimeGenerated = TimeGenerated\\r\\n)\\r\\non $left.Url == $right.{URL_Logs_Field:value}\\r\\n| project Risk=ConfidenceScore, Url, ThreatType, Tags\\r\\n| extend Evidence=parse_json(Tags)[0]\\r\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\r\\n| extend Rule=Evidence['Rule']\\r\\n| summarize count() by tostring(Rule)\\r\\n| sort by count_ desc\\r\\n\\r\\n\",\"size\":0,\"title\":\"Top Triggered Risk Rules\",\"noDataMessage\":\"No triggered Risk Rules\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"}}]}},\"customWidth\":\"30\",\"name\":\"query - 2\"},{\"type\":1,\"content\":{\"json\":\"### Detected URLs: Evidence Details\\n\\nTo view evidence details, click a row (URL) in the Detected URLs table.\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\n| where TimeGenerated {Threat_Intelligence_Time_Range:query}\\n| where Description contains {RF_Risk_list}\\n| where Url == \\\"{MaliciousURLMatch}\\\"\\n| where isnotempty(Tags)\\n//| where ExpirationDateTime > now()\\n| extend Evidence=parse_json(Tags)[0]\\n| take 1\\n| mv-expand Evidence = parse_json(tostring(Evidence))\\n| project Rules = Evidence['Rule'], Criticality = Evidence['Criticality'], Evidence_String = Evidence['EvidenceString']\\n| sort by toint(Criticality) desc\",\"size\":1,\"noDataMessage\":\"ExpirationDateTime\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"MaliciousURLMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 5\"},{\"type\":1,\"content\":{\"json\":\"\\n### Source data from {URL_Logs_Table:value}\\nTo view source data of correlated URL, click a row (URL) in the Detected URLs table.\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{URL_Logs_Table:value}\\n| where TimeGenerated {URL_Logs_Time_Range:query}\\n| where {URL_Logs_Field:value} == \\\"{MaliciousURLMatch}\\\"\\n\",\"size\":1,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"MaliciousURLMatch\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - 6\"}]},\"name\":\"group - 10\"}],\"styleSettings\":{\"paddingStyle\":\"wide\"},\"fromTemplateId\":\"sentinel-RecordedFutureURLCorrelationWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId6'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFutureURLCorrelationWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future URL Correlation Workbook. This workbook will visualize Recorded Future threat intelligence data together with infrastructure logs ingested in to Sentinel.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.1; title=Recorded Future - URL Correlation; templateRelativePath=RecordedFutureURLCorrelation.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId6')]",
                "contentId": "[variables('_workbookContentId6')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId6')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook6-name')]",
        "contentProductId": "[variables('_workbookcontentProductId6')]",
        "id": "[variables('_workbookcontentProductId6')]",
        "version": "[variables('workbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "RecordedFutureThreatActorHuntingWorkbook Workbook with template version 3.1.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion7')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId7')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Recorded Future Threat Hunting Workbook. This workbook will visualize Recorded Future threat map and hunting indicators ingested in to Microsoft Sentinel."
              },
              "properties": {
                "displayName": "[parameters('workbook7-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<h1>Threat Actor Map</h1>\\n\\n<p>This workbook shows Threat Actors imported from Recorded Future, their intent towards your company, and their opportunity.Data is fetched from Recorded Future thru the playbook ```RecordedFuture-ThreatMap-lmporter```.</p> \\n\\n\\n\",\"style\":\"info\"},\"name\":\"text - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"92c84cb2-9b9a-498f-9b18-a3a11f70618a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"description\":\"Time range for incident created and indicator import.\",\"isRequired\":true,\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"value\":{\"durationMs\":172800000}},{\"id\":\"29f50496-9072-4438-8ac5-7a0cf4cd7307\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Category\",\"label\":\"Threat Actor Category\",\"type\":2,\"isRequired\":true,\"query\":\"RecordedFutureThreatMap_CL\\r\\n| extend parsed_json = parse_json(categories_s)\\r\\n| mv-expand parsed_json\\r\\n| distinct id = tostring(parsed_json.id), name = tostring(parsed_json.name)\\r\\n\",\"typeSettings\":{\"additionalResourceOptions\":\"[variables('TemplateEmptyArray')]\",\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"value\":\"JW2OHE\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"RecordedFutureThreatMap_CL\\n| where TimeGenerated {TimeRange:query}\\n| where categories_s contains(\\\"{Category:value}\\\") \\n| project TimeGenerated, id_s, name_s, intent_d, opportunity_d\\n| summarize MaxTimeGenerated = max(TimeGenerated) by id_s, name_s, intent_d, opportunity_d\\n| project MaxTimeGenerated, id_s, name_s, intent_d, opportunity_d\",\"size\":1,\"aggregation\":2,\"title\":\"Threat Actor Map\",\"noDataMessage\":\"No data found\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"id_s\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"intent_d\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"xAxis\":\"intent_d\",\"yAxis\":[\"opportunity_d\"],\"group\":\"name_s\",\"createOtherGroup\":0,\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"intent_d\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"intent_d\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"intent_d\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 0 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"RecordedFutureThreatMap_CL\\n| where TimeGenerated {TimeRange:query}\\n| where categories_s contains(\\\"{Category:value}\\\")\\n| project TimeGenerated, id_s, name_s, intent_d, opportunity_d, combine= intent_d+opportunity_d\\n| summarize MaxTimeGenerated = max(TimeGenerated) by id_s, name_s, intent_d, opportunity_d,combine\\n| order by combine desc \\n| project Name=name_s, Intent=intent_d, Opportunity=opportunity_d, id_s\\n\",\"size\":1,\"title\":\"Threat Actors\",\"exportFieldName\":\"id_s\",\"exportParameterName\":\"ThreatIdRef\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"id_s\",\"formatter\":5}]}},\"customWidth\":\"50\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"RecordedFutureThreatMap_CL\\n| where TimeGenerated {TimeRange:query}\\n| where id_s == \\\"{ThreatIdRef}\\\"\\n| project TimeGenerated, id_s, name_s, intent_d, opportunity_d, alias_s, categories_s\\n| summarize MaxTimeGenerated = max(TimeGenerated) by id_s, name_s, intent_d, opportunity_d, alias_s, categories_s\\n| mv-expand dynamicArray= parse_json(categories_s)\\n| summarize [\\\"Threat Actor Categories\\\"] = make_list(dynamicArray.name) by   Link=strcat(\\\"https://app.recordedfuture.com/live/sc/entity/\\\",id_s)\\n, Name=name_s, MaxTimeGenerated, Id=id_s, Aliases=array_strcat(parse_json(alias_s),',')\",\"size\":4,\"title\":\"Actor Details\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Link\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"External Link\"}},{\"columnMatch\":\"Id\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Open Generic Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Threat Actor Categories\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"150ch\"}},{\"columnMatch\":\"https://app.recordedfuture.com/live/sc/entity/{Id}\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"\"}},{\"columnMatch\":\"Categories\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"150ch\"}},{\"columnMatch\":\"id_s\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"GenericDetails\",\"linkLabel\":\"Open Generic Details\",\"linkIsContextBlade\":true}}],\"labelSettings\":[{\"columnId\":\"Link\",\"label\":\"Recorded Future\"}]},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Id\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Intent\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ThreatIntelligenceIndicator\\r\\n| where ExpirationDateTime > now()\\r\\n| where Description contains(\\\"{ThreatIdRef}\\\")\\r\\n| summarize Indicators=count(Description) by  Description \",\"size\":0,\"title\":\"Active Indicators for Hunting\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Description\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Indicators\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false,\"sortCriteriaField\":\"Indicators\",\"sortOrderField\":2,\"size\":\"auto\"},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Description\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Indicators\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityIncident\\r\\n| where TimeGenerated {TimeRange:query}\\r\\n| where Title contains \\\"{ThreatIdRef}\\\"\\r\\n| distinct CreatedTime, Title,Description, IncidentUrl\",\"size\":0,\"title\":\"Incidents created\",\"noDataMessage\":\"No incidents found, but try different time range to display incidents future back in time.\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IncidentUrl\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"\"}}]}},\"customWidth\":\"50\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"RecordedFutureThreatMapLogEntries_CL\\n| where TimeGenerated {TimeRange:query}\\n| where id_s == \\\"{ThreatIdRef}\\\"\\n| project TimeGenerated,  name_s, date_t, watchlist_id_s, watchlist_name_s, entity_id_s, entity_name_s, axis_s, Severity\\n| summarize MaxTimeGenerated = max(TimeGenerated) by  name_s, date_t, watchlist_id_s, watchlist_name_s, entity_id_s, entity_name_s, axis_s, Severity\\n| project   Actor=name_s, Id=watchlist_id_s, [\\\"Recorded Future Watchlist Name\\\"]=watchlist_name_s, EntityName=entity_name_s, Axis=axis_s, Score=Severity\",\"size\":1,\"title\":\"Recorded Future Related Watchlist Entries\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"query - 4\"},{\"type\":1,\"content\":{\"json\":\"Use indicators in analytic rules to correlate data from infrastructure logs with hunting indicators. \\r\\n\\r\\nInstall and modify the provided analytic rule templates to match your environent. \\r\\n```\\r\\nRecorded Future - Threat Hunting - Domain - All Actors\\r\\nRecorded Future - Threat Hunting - IP - All Actors\\r\\nRecorded Future - Threat Hunting - Hash - All Actors\\r\\nRecorded Future - Threat Hunting - Url - All Actors\\r\\n```\\r\\nInstall and configure Recorded Future Incident Enrichment Playbook to get additional information when incidents are created ```RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash```\\r\\n\",\"style\":\"info\"},\"customWidth\":\"50\",\"name\":\"text - 7\"}],\"styleSettings\":{\"paddingStyle\":\"none\",\"spacingStyle\":\"none\"},\"fromTemplateId\":\"sentinel-RecordedFutureThreatActorHuntingWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId7'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=RecordedFutureThreatActorHuntingWorkbook; logoFileName=RecordedFuture.svg; description=Recorded Future Threat Hunting Workbook. This workbook will visualize Recorded Future threat map and hunting indicators ingested in to Microsoft Sentinel.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=Recorded Future Threat Actor Hunting; templateRelativePath=RecordedFutureThreatActorHunting.json; subtitle=; provider=Recorded Future}.description",
                "parentId": "[variables('workbookId7')]",
                "contentId": "[variables('_workbookContentId7')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "Recorded Future",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Recorded Future Premier Integrations",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Recorded Future Support Team",
                  "email": "support@recordedfuture.com",
                  "tier": "Partner",
                  "link": "http://support.recordedfuture.com/"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId7')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook7-name')]",
        "contentProductId": "[variables('_workbookcontentProductId7')]",
        "id": "[variables('_workbookcontentProductId7')]",
        "version": "[variables('workbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.1.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "Recorded Future",
        "publisherDisplayName": "Recorded Future Support Team",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p><a href=\"https://www.recordedfuture.com/\">Recorded Future</a> is the worlds largest provider of intelligence for enterprise security. By combining persistent and pervasive automated data collection and analytics with human analysis, Recorded Future delivers intelligence that is timely, accurate, and actionable.</p>\n<p>Playbooks have internal dependencies to RecordedFuture-ImportToSentinel so install the RecordedFuture-ImportToSentinel playbook before any of the others.</p>\n<p>This solution takes a dependency on functionality like Azure Logic Apps, Azure Monitor Logs. Some of these dependencies might result in additional ingestion or operational costs.</p>\n<ul>\n<li><a href=\"https://learn.microsoft.com/en-us/azure/azure-monitor/logs/workspace-design\">https://learn.microsoft.com/en-us/azure/azure-monitor/logs/workspace-design</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/azure/logic-apps/\">https://learn.microsoft.com/en-us/azure/logic-apps/</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/azure/sentinel/work-with-threat-indicators\">https://learn.microsoft.com/en-us/azure/sentinel/work-with-threat-indicators</a></li>\n</ul>\n<p><strong>Parsers:</strong> 8, <strong>Workbooks:</strong> 7, <strong>Analytic Rules:</strong> 6, <strong>Custom Azure Logic Apps Connectors:</strong> 1, <strong>Playbooks:</strong> 17</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/RecordedFuture.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Recorded Future",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Recorded Future Premier Integrations",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Recorded Future Support Team",
          "email": "support@recordedfuture.com",
          "tier": "Partner",
          "link": "http://support.recordedfuture.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId1')]",
              "version": "[variables('analyticRuleVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId2')]",
              "version": "[variables('analyticRuleVersion2')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId3')]",
              "version": "[variables('analyticRuleVersion3')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId4')]",
              "version": "[variables('analyticRuleVersion4')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId5')]",
              "version": "[variables('analyticRuleVersion5')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRulecontentId6')]",
              "version": "[variables('analyticRuleVersion6')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId2')]",
              "version": "[variables('parserVersion2')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId3')]",
              "version": "[variables('parserVersion3')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId4')]",
              "version": "[variables('parserVersion4')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId5')]",
              "version": "[variables('parserVersion5')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId6')]",
              "version": "[variables('parserVersion6')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId7')]",
              "version": "[variables('parserVersion7')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId8')]",
              "version": "[variables('parserVersion8')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-IOC_Enrichment-IP_Domain_URL_Hash')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-Sandbox_Enrichment-Url')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-Playbook-Alert-Importer')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-Alert-Importer')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-ThreatIntelligenceImport')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-Domain-IndicatorImport')]",
              "version": "[variables('playbookVersion6')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-Hash-IndicatorImport')]",
              "version": "[variables('playbookVersion7')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-IP-IndicatorImport')]",
              "version": "[variables('playbookVersion8')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-URL-IndicatorImport')]",
              "version": "[variables('playbookVersion9')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-ImportToSentinel')]",
              "version": "[variables('playbookVersion10')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-DOMAIN-C2_DNS_Name-IndicatorProcessor')]",
              "version": "[variables('playbookVersion11')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-HASH-Observed_in_Underground_Virus_Test_Sites-IndicatorProcessor')]",
              "version": "[variables('playbookVersion12')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-IP-Actively_Comm_C2_Server-IndicatorProcessor')]",
              "version": "[variables('playbookVersion13')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-URL-Recent_Rep_by_Insikt_Group-IndicatorProcessor')]",
              "version": "[variables('playbookVersion14')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-Ukraine-IndicatorProcessor')]",
              "version": "[variables('playbookVersion15')]"
            },
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_RecordedFuture-Azure-Connector')]",
              "version": "[variables('playbookVersion16')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-ThreatMap-Importer')]",
              "version": "[variables('playbookVersion17')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_RecordedFuture-ThreatHunt-IndicatorImport')]",
              "version": "[variables('playbookVersion18')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId2')]",
              "version": "[variables('workbookVersion2')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId3')]",
              "version": "[variables('workbookVersion3')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId4')]",
              "version": "[variables('workbookVersion4')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId5')]",
              "version": "[variables('workbookVersion5')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId6')]",
              "version": "[variables('workbookVersion6')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId7')]",
              "version": "[variables('workbookVersion7')]"
            }
          ]
        },
        "firstPublishDate": "2021-11-01",
        "lastPublishDate": "2023-09-19",
        "providers": [
          "Recorded Future"
        ],
        "categories": {
          "domains": [
            "Security - Threat Intelligence"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
