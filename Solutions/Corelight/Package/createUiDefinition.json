{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/Corelight/Data Connectors/Logo/corelight.svg\" width=\"75px\" height=\"75px\">\n\n**Important:** _This Microsoft Sentinel Solution is currently in public preview. This feature is provided without a service level agreement, and it's not recommended for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)._\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThe [Corelight](https://corelight.com/) solution provides the capability to ingest events from [Zeek](https://zeek.org/) and [Suricata](https://suricata.io/) via Corelight Sensors into Microsoft Sentinel.\n\n**Underlying Microsoft Technologies used:**\n\nThis solution takes a dependency on the following technologies, and some of these dependencies either may be in [Preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) state or might result in additional ingestion or operational costs:\n\na. [Agent based logs collection from Windows and Linux machines](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources-custom-logs)\n\nMicrosoft Sentinel Solutions provide a consolidated way to acquire Microsoft Sentinel content like data connectors, workbooks, analytics, and automations in your workspace with a single deployment step.\n\n**Data Connectors:** 1, **Parsers:** 108, **Workbooks:** 1, **Analytic Rules:** 10, **Hunting Queries:** 10\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "dataconnectors",
        "label": "Data Connectors",
        "bladeTitle": "Data Connectors",
        "elements": [
          {
            "name": "dataconnectors1-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Solution installs the data connector for Corelight. You can get Corelight custom log data in your Microsoft Sentinel workspace. Configure and enable this data connector in the Data Connector gallery after this Solution deploys. This data connector creates custom log table(s) Corelight_v2_bacnet Corelight_v2_capture_loss Corelight_v2_cip Corelight_v2_conn_long Corelight_v2_conn_red Corelight_v2_conn Corelight_v2_Corelight_v2_burst Corelight_v2_Corelight_v2_overall_capture_loss Corelight_v2_Corelight_v2_profiling Corelight_v2_datared Corelight_v2_dce_rpc Corelight_v2_dga Corelight_v2_dhcp Corelight_v2_dnp3 Corelight_v2_dns_red Corelight_v2_dns Corelight_v2_dpd Corelight_v2_encrypted_dns Corelight_v2_enip_debug Corelight_v2_enip_list_identity Corelight_v2_enip Corelight_v2_etc_viz Corelight_v2_files_red Corelight_v2_files Corelight_v2_ftp Corelight_v2_generic_dns_tunnels Corelight_v2_generic_icmp_tunnels Corelight_v2_http2 Corelight_v2_http_red Corelight_v2_http Corelight_v2_icmp_specific_tunnels Corelight_v2_intel Corelight_v2_ipsec Corelight_v2_irc Corelight_v2_iso_cotp Corelight_v2_kerberos Corelight_v2_known_certs Corelight_v2_known_devices Corelight_v2_known_domains Corelight_v2_known_hosts Corelight_v2_known_names Corelight_v2_known_remotes Corelight_v2_known_services Corelight_v2_known_users Corelight_v2_local_subnets_dj Corelight_v2_local_subnets_graphs Corelight_v2_local_subnets Corelight_v2_log4shell Corelight_v2_modbus Corelight_v2_mqtt_connect Corelight_v2_mqtt_publish Corelight_v2_mqtt_subscribe Corelight_v2_mysql Corelight_v2_notice Corelight_v2_ntlm Corelight_v2_ntp Corelight_v2_ocsp Corelight_v2_openflow Corelight_v2_packet_filter Corelight_v2_pe Corelight_v2_profinet_dce_rpc Corelight_v2_profinet_debug Corelight_v2_profinet Corelight_v2_radius Corelight_v2_rdp Corelight_v2_reporter Corelight_v2_rfb Corelight_v2_s7comm Corelight_v2_signatures Corelight_v2_sip Corelight_v2_smartpcap_stats Corelight_v2_smartpcap Corelight_v2_smb_files Corelight_v2_smb_mapping Corelight_v2_smtp_links Corelight_v2_smtp Corelight_v2_snmp Corelight_v2_socks Corelight_v2_software Corelight_v2_specific_dns_tunnels Corelight_v2_ssh Corelight_v2_ssl_red Corelight_v2_ssl Corelight_v2_stats Corelight_v2_stepping Corelight_v2_stun_nat Corelight_v2_stun Corelight_v2_suricata_corelight Corelight_v2_suricata_eve Corelight_v2_suricata_stats Corelight_v2_suricata_zeek_stats Corelight_v2_syslog Corelight_v2_tds_rpc Corelight_v2_tds_sql_batch Corelight_v2_tds Corelight_v2_traceroute Corelight_v2_tunnel Corelight Corelight_v2_unknown_smartpcap Corelight_v2_util_stats Corelight_v2_vpn Corelight_v2_weird_red Corelight_v2_weird_stats Corelight_v2_weird Corelight_v2_wireguard Corelight_v2_x509_red Corelight_v2_x509 Corelight_v2_zeek_doctor in your Microsoft Sentinel / Azure Log Analytics workspace."
            }
          },
          {
            "name": "dataconnectors-parser-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "The Solution installs a parser that transforms the ingested data into Microsoft Sentinel normalized format. The normalized format enables better correlation of different types of data from different data sources to drive end-to-end outcomes seamlessly in security monitoring, hunting, incident investigation and response scenarios in Microsoft Sentinel."
            }
          },
          {
            "name": "dataconnectors-link1",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about normalized format",
                "uri": "https://docs.microsoft.com/azure/sentinel/normalization-schema"
              }
            }
          },
          {
            "name": "dataconnectors-link2",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more about connecting data sources",
                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
              }
            }
          }
        ]
      },
      {
        "name": "workbooks",
        "label": "Workbooks",
        "subLabel": {
          "preValidation": "Configure the workbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Workbooks",
        "elements": [
          {
            "name": "workbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Microsoft Sentinel Solution installs workbooks. Workbooks provide a flexible canvas for data monitoring, analysis, and the creation of rich visual reports within the Azure portal. They allow you to tap into one or many data sources from Microsoft Sentinel and combine them into unified interactive experiences.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data"
              }
            }
          },
          {
            "name": "workbook1",
            "type": "Microsoft.Common.Section",
            "label": "Corelight",
            "elements": [
              {
                "name": "workbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Sample Corelight workbook"
                }
              },
              {
                "name": "workbook1-name",
                "type": "Microsoft.Common.TextBox",
                "label": "Display Name",
                "defaultValue": "Corelight",
                "toolTip": "Display name for the workbook.",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a workbook name"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Microsoft Sentinel Solution installs analytic rules for Corelight that you can enable for custom alert generation in Microsoft Sentinel. These analytic rules will be deployed in disabled mode in the analytics rules gallery of your Microsoft Sentinel workspace. Configure and enable these rules in the analytic rules gallery after this Solution deploys.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - C2 DGA Detected Via Repetitive Failures",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects large amounts of DNS resolution failures."
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - External Proxy Detected",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects external proxy usage."
                }
              }
            ]
          },
          {
            "name": "analytic3",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Forced External Outbound SMB",
            "elements": [
              {
                "name": "analytic3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects SMB requests that originate internally and communicate with an external IP address."
                }
              }
            ]
          },
          {
            "name": "analytic4",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Multiple Compressed Files Transferred over HTTP",
            "elements": [
              {
                "name": "analytic4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects compressed archives transferre over HTTP."
                }
              }
            ]
          },
          {
            "name": "analytic5",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Multiple files sent over HTTP with abnormal requests",
            "elements": [
              {
                "name": "analytic5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects sources sending multiple compressed files greater than 10MBs sent over HTTP in a short amount of time."
                }
              }
            ]
          },
          {
            "name": "analytic6",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Network Service Scanning Multiple IP Addresses",
            "elements": [
              {
                "name": "analytic6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Identify scanning of services that may be available on the internal network."
                }
              }
            ]
          },
          {
            "name": "analytic7",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Possible Webshell",
            "elements": [
              {
                "name": "analytic7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects post requests to unusual extensions."
                }
              }
            ]
          },
          {
            "name": "analytic8",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Possible Webshell (Rare PUT or POST)",
            "elements": [
              {
                "name": "analytic8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects rare post requests to a single webserver location."
                }
              }
            ]
          },
          {
            "name": "analytic9",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - SMTP Email containing NON Ascii Characters within the Subject",
            "elements": [
              {
                "name": "analytic9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects where an emails contain non ascii characters within the Subject."
                }
              }
            ]
          },
          {
            "name": "analytic10",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Possible Typo Squatting or Punycode Phishing HTTP Request",
            "elements": [
              {
                "name": "analytic10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when an HTTP request was made to a domain that was using unicode/punycode."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "huntingqueries",
        "label": "Hunting Queries",
        "bladeTitle": "Hunting Queries",
        "elements": [
          {
            "name": "huntingqueries-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Microsoft Sentinel Solution installs hunting queries for Corelight that you can run in Microsoft Sentinel. These hunting queries will be deployed in the Hunting gallery of your Microsoft Sentinel workspace. Run these hunting queries to hunt for threats in the Hunting gallery after this Solution deploys.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/hunting"
              }
            }
          },
          {
            "name": "huntingquery1",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Abnormal Email Subject",
            "elements": [
              {
                "name": "huntingquery1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for emails with NON-Ascii characters within the Subject . It depends on the Corelight data connector and Corelight_v2_smtp data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery2",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Compressed Files Transferred over HTTP",
            "elements": [
              {
                "name": "huntingquery2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for top sources which transferred compressed archives over HTTP. It depends on the Corelight data connector and Corelight_v2_http data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery3",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Top sources of data transferred",
            "elements": [
              {
                "name": "huntingquery3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for top sources by transferred data over period of time. It depends on the Corelight data connector and Corelight_v2_http data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery4",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - External Facing Services",
            "elements": [
              {
                "name": "huntingquery4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for external facing services. It depends on the Corelight data connector and Corelight_v2_conn data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery5",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Files in logs",
            "elements": [
              {
                "name": "huntingquery5-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for files which where seen in logs over period of time. It depends on the Corelight data connector and Corelight_v2_files data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery6",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - File transferred by source",
            "elements": [
              {
                "name": "huntingquery6-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for files transferred over period of time by each source. It depends on the Corelight data connector and Corelight_v2_http data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery7",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Multiple Remote SMB Connections from single client",
            "elements": [
              {
                "name": "huntingquery7-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Detects when a single source is connecting to many different SMB or file shares. It depends on the Corelight data connector and Corelight_v2_smb_mapping data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery8",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Obfuscated binary filenames",
            "elements": [
              {
                "name": "huntingquery8-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for downloaded obfuscated binary file names. It depends on the Corelight data connector and Corelight_v2_http data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery9",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Rare PUT or POST",
            "elements": [
              {
                "name": "huntingquery9-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for rare post requests to a single location. It depends on the Corelight data connector and Corelight_v2_http data type and Corelight parser."
                }
              }
            ]
          },
          {
            "name": "huntingquery10",
            "type": "Microsoft.Common.Section",
            "label": "Corelight - Repetitive DNS Failures",
            "elements": [
              {
                "name": "huntingquery10-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Query searches for repetitive DNS resolution failures from single host. It depends on the Corelight data connector and Corelight_v2_dns data type and Corelight parser."
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]",
      "workbook1-name": "[steps('workbooks').workbook1.workbook1-name]"
    }
  }
}
