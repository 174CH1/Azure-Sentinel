id: 50c61708-9824-46f3-87cf-22490796fae2
name: Corelight - SMTP Email containing NON Ascii Characters within the Subject
description: |
  'Detects where an emails contain non ascii characters within the Subject.'
severity: Low
status: Available
requiredDataConnectors:
  - connectorId: Corelight
    dataTypes:
      - smtp
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
relevantTechniques:
  - T1566 
query: |
  smtp
  // FIXME: need to validate this
  | where subject hasprefix  @'\=?utf-16'
  | summarize recipients = dcount(to)
  | extend k = 1
  | join (smtp
          | where subject hasprefix  @'\=?utf-16'
          | summarize by to
          | extend k = 1) on k
  | where recipients > 1
  | extend MailCustomEntity = to
entityMappings:
  - entityType: MailMessage
    fieldMappings:
      - identifier: Recipient
        columnName: MailCustomEntity
version: 2.1.0
kind: Scheduled
