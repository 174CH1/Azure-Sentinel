id: 4ef8a4e9-1d08-4743-939f-c995c795c5e8
name: 1Password - Manual account creation
version: 1.0.0
kind: Scheduled
description: |-
  This will alert when a new account was created manually within 1Password. This should only be used when a 1Password integration via a SCIM Bridge has been implemented.

  Ref: https://support.1password.com/scim/
  Ref: https://1password.com/
  Ref: https://github.com/securehats/
severity: Medium
queryFrequency: 5m
queryPeriod: 5m
triggerOperator: gt
triggerThreshold: 0
tactics:
- Persistence
relevantTechniques:
- T1136
query: |-
  OnePasswordEventLogs_CL
  | where actor_details.email !endswith "@1passwordserviceaccounts.com"
  | where action == "create"
      and object_type == "invite"
  | extend
      TargetUsername = target_user.email
      , SrcIpAddr = client.ip_address
suppressionEnabled: false
incidentConfiguration:
  createIncident: true
  groupingConfiguration:
    enabled: true
    reopenClosedIncident: false
    lookbackDuration: 5m
    matchingMethod: AllEntities
    groupByEntities: []
    groupByAlertDetails: []
    groupByCustomDetails: []
eventGroupingSettings:
  aggregationKind: SingleAlert
entityMappings:
- entityType: Account
  fieldMappings:
  - identifier: FullName
    columnName: TargetUsername
- entityType: IP
  fieldMappings:
  - identifier: Address
    columnName: SrcIpAddr
suppressionDuration: 5h

