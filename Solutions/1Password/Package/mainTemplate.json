{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "1Password",
    "comments": "Solution template for 1Password"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": null,
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "_solutionName": "1Password",
    "_solutionVersion": "3.0.0",
    "solutionId": "1Password.1Password_mss",
    "_solutionId": "[variables('solutionId')]",
    "uiConfigId1": "1Password",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "1Password",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1'))))]",
    "dataConnectorVersion1": "1.0.0",
    "_dataConnectorcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentId1'),'-', variables('dataConnectorVersion1'))))]",
    "workbookVersion1": "",
    "workbookContentId1": "",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "TemplateEmptyArray": "[json('[]')]",
    "analyticRuleObject1": {
      "analyticRuleVersion1": "1.0.0",
      "_analyticRulecontentId1": "4ef8a4e9-1d08-4743-939f-c995c795c5e8",
      "analyticRuleId1": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '4ef8a4e9-1d08-4743-939f-c995c795c5e8')]",
      "analyticRuleTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('4ef8a4e9-1d08-4743-939f-c995c795c5e8')))]",
      "_analyticRulecontentProductId1": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','4ef8a4e9-1d08-4743-939f-c995c795c5e8','-', '1.0.0')))]"
    },
    "analyticRuleObject2": {
      "analyticRuleVersion2": "1.0.0",
      "_analyticRulecontentId2": "395db1d2-fb5a-44a8-9f8c-bf539d4d26ce",
      "analyticRuleId2": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '395db1d2-fb5a-44a8-9f8c-bf539d4d26ce')]",
      "analyticRuleTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('395db1d2-fb5a-44a8-9f8c-bf539d4d26ce')))]",
      "_analyticRulecontentProductId2": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','395db1d2-fb5a-44a8-9f8c-bf539d4d26ce','-', '1.0.0')))]"
    },
    "analyticRuleObject3": {
      "analyticRuleVersion3": "1.0.0",
      "_analyticRulecontentId3": "6ac54655-e213-424f-a676-c90cfe59e927",
      "analyticRuleId3": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '6ac54655-e213-424f-a676-c90cfe59e927')]",
      "analyticRuleTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('6ac54655-e213-424f-a676-c90cfe59e927')))]",
      "_analyticRulecontentProductId3": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','6ac54655-e213-424f-a676-c90cfe59e927','-', '1.0.0')))]"
    },
    "analyticRuleObject4": {
      "analyticRuleVersion4": "1.0.0",
      "_analyticRulecontentId4": "969e2e5c-9cc6-423c-a3de-514f7ad75fe7",
      "analyticRuleId4": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '969e2e5c-9cc6-423c-a3de-514f7ad75fe7')]",
      "analyticRuleTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('969e2e5c-9cc6-423c-a3de-514f7ad75fe7')))]",
      "_analyticRulecontentProductId4": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','969e2e5c-9cc6-423c-a3de-514f7ad75fe7','-', '1.0.0')))]"
    },
    "analyticRuleObject5": {
      "analyticRuleVersion5": "1.0.0",
      "_analyticRulecontentId5": "51617533-cf51-4415-9020-b15bd47d69d2",
      "analyticRuleId5": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', '51617533-cf51-4415-9020-b15bd47d69d2')]",
      "analyticRuleTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('51617533-cf51-4415-9020-b15bd47d69d2')))]",
      "_analyticRulecontentProductId5": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','51617533-cf51-4415-9020-b15bd47d69d2','-', '1.0.0')))]"
    },
    "analyticRuleObject6": {
      "analyticRuleVersion6": "1.0.0",
      "_analyticRulecontentId6": "cb23d6cb-4b2e-44a7-b48e-040dd043147b",
      "analyticRuleId6": "[resourceId('Microsoft.SecurityInsights/AlertRuleTemplates', 'cb23d6cb-4b2e-44a7-b48e-040dd043147b')]",
      "analyticRuleTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-ar-',uniquestring('cb23d6cb-4b2e-44a7-b48e-040dd043147b')))]",
      "_analyticRulecontentProductId6": "[concat(take(variables('_solutionId'),50),'-','ar','-', uniqueString(concat(variables('_solutionId'),'-','AnalyticsRule','-','cb23d6cb-4b2e-44a7-b48e-040dd043147b','-', '1.0.0')))]"
    },
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password data connector with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "GenericUI",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "1Password (using Azure Functions)",
                  "publisher": "1Password",
                  "descriptionMarkdown": "The [1Password](https://www.1password.com) solution for Microsoft Sentinel enables you to ingest sign-in attempts, item usage, and audit events from your 1Password Business account using the [1Password Events Reporting API](https://developer.1password.com/docs/events-api). This allows you to monitor and investigate events in 1Password in Microsoft Sentinel along with the other applications and services your organization uses.\n\n**Underlying Microsoft Technologies used:**\n\nThis solution depends on the following technologies, and some of which may be in [Preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) state or may incur additional ingestion or operational costs:\n\n-  [Azure Functions](https://azure.microsoft.com/services/functions/#overview)",
                  "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution.",
                  "graphQueries": [
                    {
                      "metricName": "Total data received",
                      "legend": "1Password",
                      "baseQuery": "OnePasswordEventLogs_CL"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Top 10 Users",
                      "query": "OnePasswordEventLogs_CL\n | summarize count() by tostring(target_user.name) \n | top 10 by count_"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "OnePasswordEventLogs_CL",
                      "lastDataReceivedQuery": "OnePasswordEventLogs_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "IsConnectedQuery",
                      "value": [
                        "OnePasswordEventLogs_CL\n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(7d)"
                      ]
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions on the workspace are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Microsoft.Web/sites permissions",
                        "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
                      },
                      {
                        "name": "1Password API Token",
                        "description": "A 1Password API Token is required. [See the documentation to learn more about the 1Password API](https://developer.1password.com/docs/events-api/reference). \n\n**Note:** A 1Password account is required"
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": ">**NOTE:** This connector uses Azure Functions to connect to 1Password to pull logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
                    },
                    {
                      "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected which is deployed as part of the solution. To view the function code in Log Analytics, open Log Analytics/Microsoft Sentinel Logs blade, click Functions and search for the alias 1PasswordLogs and load the function code or click [here](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/1PasswordLogs/Parsers/1PasswordLogs.yaml), The function usually takes 10-15 minutes to activate after solution installation/update."
                    },
                    {
                      "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
                    },
                    {
                      "description": "**STEP 1 - Configuration steps for the 1Password API**\n\n [Follow these instructions](https://support.1password.com/events-reporting/#appendix-issue-or-revoke-bearer-tokens) provided by 1Password to obtain an API Token. **Note:** A 1Password account is required"
                    },
                    {
                      "description": "**STEP 2 - Deploy the functionApp using DeployToAzure button to create the table, dcr and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the 1Password connector, a custom table needs to be created."
                    },
                    {
                      "description": "This method provides an automated deployment of the 1Password connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri//https%3A%2F%2Fraw.githubusercontent.com%2Fazurekid%2FAzure-Sentinel%2Ffeature%2F1password%2FSolutions%2F1Password%2FData%20Connectors%2F1Password%2Fazuredeploy_1Password_API_FunctionApp.json)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace Name**, **Workspace Name**, **API Key**, and **URI**.\n - The default **Time Interval** is set to pull the last five (5) minutes of data. If the time interval needs to be modified, it is recommended to change the Function App Timer Trigger accordingly (in the function.json file, post deployment) to prevent overlapping data ingestion.\n - Note: If using Azure Key Vault secrets for any of the values above, use the`@Microsoft.KeyVault(SecretUri={Security Identifier})`schema in place of the string values. Refer to [Key Vault references documentation](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) for further details. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
                      "title": "Azure Resource Manager (ARM) Template"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2023-04-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "contentKind": "DataConnector",
        "displayName": "1Password (using Azure Functions)",
        "contentProductId": "[variables('_dataConnectorcontentProductId1')]",
        "id": "[variables('_dataConnectorcontentProductId1')]",
        "version": "[variables('dataConnectorVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "1Password",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "1Password"
        },
        "support": {
          "name": "1Password",
          "tier": "1Password",
          "link": "https://support.1password.com/"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "GenericUI",
      "properties": {
        "connectorUiConfig": {
          "title": "1Password (using Azure Functions)",
          "publisher": "1Password",
          "descriptionMarkdown": "The [1Password](https://www.1password.com) solution for Microsoft Sentinel enables you to ingest 1Password logs and events into Microsoft Sentinel. The connector provides visibility into 1Password Events and Alerts in Microsoft Sentinel to improve monitoring and investigation capabilities.\n\n**Underlying Microsoft Technologies used:**\n\nThis solution takes a dependency on the following technologies, and some of these dependencies either may be in [Preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) state or might result in additional ingestion or operational costs:\n\n-  [Azure Functions](https://azure.microsoft.com/services/functions/#overview)",
          "graphQueries": [
            {
              "metricName": "Total data received",
              "legend": "1Password",
              "baseQuery": "OnePasswordEventLogs_CL"
            }
          ],
          "dataTypes": [
            {
              "name": "OnePasswordEventLogs_CL",
              "lastDataReceivedQuery": "OnePasswordEventLogs_CL\n | summarize Time = max(TimeGenerated)\n | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "IsConnectedQuery",
              "value": [
                "OnePasswordEventLogs_CL\n | summarize LastLogReceived = max(TimeGenerated)\n | project IsConnected = LastLogReceived > ago(7d)"
              ]
            }
          ],
          "sampleQueries": [
            {
              "description": "Top 10 Users",
              "query": "OnePasswordEventLogs_CL\n | summarize count() by tostring(target_user.name) \n | top 10 by count_"
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "read and write permissions on the workspace are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              }
            ],
            "customs": [
              {
                "name": "Microsoft.Web/sites permissions",
                "description": "Read and write permissions to Azure Functions to create a Function App is required. [See the documentation to learn more about Azure Functions](https://docs.microsoft.com/azure/azure-functions/)."
              },
              {
                "name": "1Password API Token",
                "description": "A 1Password API Token is required. [See the documentation to learn more about the 1Password API](https://developer.1password.com/docs/events-api/reference). \n\n**Note:** A 1Password account is required"
              }
            ]
          },
          "instructionSteps": [
            {
              "description": ">**NOTE:** This connector uses Azure Functions to connect to 1Password to pull logs into Microsoft Sentinel. This might result in additional data ingestion costs. Check the [Azure Functions pricing page](https://azure.microsoft.com/pricing/details/functions/) for details."
            },
            {
              "description": ">**NOTE:** This data connector depends on a parser based on a Kusto Function to work as expected which is deployed as part of the solution. To view the function code in Log Analytics, open Log Analytics/Microsoft Sentinel Logs blade, click Functions and search for the alias 1PasswordLogs and load the function code or click [here](https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/1PasswordLogs/Parsers/1PasswordLogs.yaml), The function usually takes 10-15 minutes to activate after solution installation/update."
            },
            {
              "description": ">**(Optional Step)** Securely store workspace and API authorization key(s) or token(s) in Azure Key Vault. Azure Key Vault provides a secure mechanism to store and retrieve key values. [Follow these instructions](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) to use Azure Key Vault with an Azure Function App."
            },
            {
              "description": "**STEP 1 - Configuration steps for the 1Password API**\n\n [Follow these instructions](https://support.1password.com/events-reporting/#appendix-issue-or-revoke-bearer-tokens) provided by 1Password to obtain an API Token. **Note:** A 1Password account is required"
            },
            {
              "description": "**STEP 2 - Deploy the functionApp using DeployToAzure button to create the table, dcr and the associated Azure Function**\n\n>**IMPORTANT:** Before deploying the 1Password connector, a custom table needs to be created."
            },
            {
              "description": "This method provides an automated deployment of the 1Password connector using an ARM Tempate.\n\n1. Click the **Deploy to Azure** button below. \n\n\t[![Deploy To Azure](https://aka.ms/deploytoazurebutton)](https://portal.azure.com/#create/Microsoft.Template/uri//https%3A%2F%2Fraw.githubusercontent.com%2Fazurekid%2FAzure-Sentinel%2Ffeature%2F1password%2FSolutions%2F1Password%2FData%20Connectors%2F1Password%2Fazuredeploy_1Password_API_FunctionApp.json)\n2. Select the preferred **Subscription**, **Resource Group** and **Location**. \n3. Enter the **Workspace Name**, **Workspace Name**, **API Key**, and **URI**.\n - The default **Time Interval** is set to pull the last five (5) minutes of data. If the time interval needs to be modified, it is recommended to change the Function App Timer Trigger accordingly (in the function.json file, post deployment) to prevent overlapping data ingestion.\n - Note: If using Azure Key Vault secrets for any of the values above, use the`@Microsoft.KeyVault(SecretUri={Security Identifier})`schema in place of the string values. Refer to [Key Vault references documentation](https://docs.microsoft.com/azure/app-service/app-service-key-vault-references) for further details. \n4. Mark the checkbox labeled **I agree to the terms and conditions stated above**. \n5. Click **Purchase** to deploy.",
              "title": "Azure Resource Manager (ARM) Template"
            }
          ],
          "id": "[variables('_uiConfigId1')]",
          "additionalRequirementBanner": "These queries are dependent on a parser based on a Kusto Function deployed as part of the solution."
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": ""
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"1ca69445-60fc-4806-b43d-ac7e6aad630a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"value\":\"/subscriptions/ba161e49-a831-48e5-a0b2-e9c6d7a310e3\",\"typeSettings\":{\"includeAll\":false},\"label\":\"☁️ Subscription\"},{\"id\":\"e94aafa3-c5d9-4523-89f0-4e87aa754511\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources \\n| where type =~ \\\"microsoft.operationalinsights/workspaces\\\" \\n| order by name \\n| project id, name, selected=row_number()==1, group=resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true}},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"label\":\"🗂️ Workspace\"},{\"id\":\"c4b69c01-2263-4ada-8d9c-43433b739ff3\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"label\":\"⏱️ Time Range\"},{\"id\":\"6ed3bbc6-be3f-44ed-84b3-9908e7c92315\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"type\":10,\"isRequired\":true,\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\",\"label\":\"📖 Help\",\"value\":\"Yes\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"customWidth\":\"70\",\"name\":\"parameters - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"e648443b-bf59-4ae6-8c04-a5edf7097da6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Measurement\",\"type\":10,\"isRequired\":true,\"jsonData\":\"[\\r\\n{\\\"value\\\": \\\"KM\\\", \\\"label\\\": \\\"KM\\\"},\\r\\n{\\\"value\\\": \\\"Miles\\\", \\\"label\\\": \\\"Miles\\\", \\\"selected\\\":true}\\r\\n]\",\"value\":\"KM\"},{\"id\":\"ba4eb749-336e-4aa0-8a4b-2b7987507852\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Top\",\"label\":\"Show Top locations\",\"type\":2,\"description\":\"Only show this amount of locations om the map\",\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n{ \\\"value\\\": \\\"5\\\", \\\"label\\\": \\\"5\\\"},\\r\\n{\\\"value\\\": \\\"10\\\", \\\"label\\\": \\\"10\\\", \\\"selected\\\":true },\\r\\n{\\\"value\\\": \\\"20\\\", \\\"label\\\": \\\"20\\\" },\\r\\n{\\\"value\\\": \\\"30\\\", \\\"label\\\": \\\"30\\\" },\\r\\n{\\\"value\\\": \\\"50\\\", \\\"label\\\": \\\"50\\\" }\\r\\n]\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"30\",\"name\":\"parameters - settings\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"182ff415-dc4f-42d3-a39a-eab397510bc7\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"All Data\",\"subTarget\":\"AllData\",\"style\":\"link\"},{\"id\":\"0d78c03f-f8d7-40da-8761-3ef454b14ad8\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"User Data\",\"subTarget\":\"UserData\",\"style\":\"link\"}]},\"name\":\"links - 5\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"All Data\",\"loadType\":\"always\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| summarize count() by bin (TimeGenerated, 1d), log_source\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\",\"chartSettings\":{\"xAxis\":\"TimeGenerated\"}},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend city_  = tostring(location.city) \\r\\n| extend state_ = tostring(location.state) \\r\\n| extend countryOrRegion_ =  tostring((geo_info_from_ip_address (tostring(client.ip_address))).region)\\r\\n| extend latitude_  = tostring(location.latitude)\\r\\n| extend longitude_ = tostring(location.longitude) \\r\\n| order by TimeGenerated asc, city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_, 1)\\r\\n| extend pLon = prev(longitude_, 1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(row_number() > 1,tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = distance_in,\\r\\n                       distanceTravelled2 = strcat(distance_in,' ','{Measurement}'),\\r\\n                       latitude_,\\r\\n                       longitude_\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",\"size\":0,\"title\":\"User Locations\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"map\",\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"City\",\"sizeAggregation\":\"Count\",\"minSize\":20,\"labelSettings\":\"distanceTravelled\",\"legendMetric\":\"distanceTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"CountryorRegion\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = \\r\\nOnePasswordEventLogs_CL\\r\\n| where log_source == 'signinattempts'\\r\\n  and tostring(target_user.name) notcontains 'Provisioning';\\r\\ndata\\r\\n| summarize count() by tostring(target_user.name), bin (TimeGenerated, 1d)\",\"size\":1,\"title\":\"User Sign-ins\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"customWidth\":\"50\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend countryOrRegion_ =  tostring((geo_info_from_ip_address (tostring(client.ip_address))).country)\\r\\n| order by TimeGenerated asc\\r\\n| summarize count() by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       Country=countryOrRegion_ \\r\\n| order by count_ desc\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"countries\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| distinct tostring(target_user.name)\\r\\n| count\\r\\n\\r\\n\",\"size\":4,\"title\":\"Active Users\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false,\"sortOrderField\":1}},\"customWidth\":\"15\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where object_type == \\\"group\\\"\\r\\n| where action == \\\"create\\\"\\r\\n| count\",\"size\":4,\"title\":\"Groups Added\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false}},\"customWidth\":\"15\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where object_type == \\\"group\\\"\\r\\n| where action == \\\"delete\\\"\\r\\n| count\",\"size\":4,\"title\":\"Groups deleted\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"}},\"showBorder\":false}},\"customWidth\":\"15\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n//| where category != \\\"success\\\"\\r\\n| extend actiontype_ = tostring(action_type)\\r\\n| order by TimeGenerated asc, category asc\\r\\n| summarize count() by Category=category \\r\\n| order by count_ desc\",\"size\":1,\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Category\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend applicationName_ = tostring(client.app_name)\\r\\n| where applicationName_ notcontains \\\"SCIM\\\"\\r\\n| order by TimeGenerated asc , applicationName_\\r\\n| summarize count() by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       ApplicationName=applicationName_ \\r\\n| order by count_ desc\",\"size\":1,\"showAnalytics\":true,\"title\":\"All Users : Used Application by most frequent\",\"color\":\"green\",\"noDataMessage\":\"Select a workspace\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Namespace\",\"exportParameterName\":\"Namespace\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"areachart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"chartSettings\":{\"group\":\"ApplicationName\",\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - by Location  - All User - Copy - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"AllData\"},\"name\":\"Group: AllData\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Group: UserMap\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"268ebde4-5b20-4106-9e91-8e7d36b26d4f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Select\",\"label\":\"Select Users method\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"jsonData\":\"[\\r\\n {\\\"value\\\": \\\"name\\\", \\\"label\\\": \\\"Select User by Name\\\", \\\"selected\\\":true },\\r\\n {\\\"value\\\": \\\"letter\\\", \\\"label\\\": \\\"Select User by letter\\\"},\\r\\n {\\\"value\\\": \\\"free\\\", \\\"label\\\": \\\"Select User using free text search\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 10\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"4fd13b3f-9856-4e1d-93f5-c4681a6b4c16\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectUserName\",\"type\":2,\"isRequired\":true,\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where TimeGenerated  {TimeRange:query}\\r\\n| where isnotempty(UserDisplayName) and  UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| summarize Count = count() by UserDisplayName\\r\\n| order by Count desc, UserDisplayName asc\\r\\n| project Value = UserDisplayName, Label = strcat(UserDisplayName, ' - ', Count, ' sign-ins'), Selected = false\\r\\n\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":\"1Password Test Account\",\"timeContext\":{\"durationMs\":5184000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"label\":\"\"},{\"id\":\"8aa43840-1b93-449a-861e-450856dc1297\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"userCount\",\"label\":\"How many unique Users?\",\"type\":10,\"description\":\"1000 users max are shown\",\"isRequired\":true,\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where isnotempty(UserDisplayName) and  UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| distinct UserDisplayName\\r\\n| summarize Count = strcat(count(),\\\" of 1000\\\")\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Select\",\"comparison\":\"isEqualTo\",\"value\":\"name\"},\"name\":\"parameters - 7\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"adb47350-f652-4bd3-b2c7-dcfc3e380a23\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"UserFilter\",\"type\":2,\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| distinct UserDisplayName\\r\\n| project  Alpha = toupper(substring(UserDisplayName,0,1))\\r\\n| summarize Count = count() by Alpha\\r\\n| order by Alpha asc\\r\\n| project Value=Alpha, Label=Alpha, selected = false\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":1209600000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"ad7f576a-5df8-49c1-99c2-f8fdbca5557b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectUserLetter\",\"label\":\" Select User Letter\",\"type\":2,\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName startswith '{UserFilter:label}'\\r\\n| summarize by UserDisplayName\\r\\n| order by UserDisplayName asc\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":1209600000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"96d46227-91be-4519-a83d-449e38b5f32c\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"selectedUserCount\",\"label\":\"How many unique Users?\",\"type\":10,\"description\":\"1000 users max are shown\",\"isRequired\":true,\"query\":\"SigninLogs\\r\\n| where UserDisplayName startswith '{UserFilter:label}'\\r\\n| distinct UserDisplayName\\r\\n| summarize Count = strcat(count(),\\\" of 1000\\\")\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Select\",\"comparison\":\"isEqualTo\",\"value\":\"letter\"},\"name\":\"parameters - 9\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"c2577785-56e7-415e-b95d-4af62446fb49\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectUserFree\",\"label\":\"Search for a User here\",\"type\":1,\"description\":\"Enter a free text search for a User Name \",\"value\":\"\",\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"TimeRange\"},{\"id\":\"38ee7b13-de6b-48da-a98f-0ae75ae0517e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectUserwithin\",\"label\":\"Matched User(s)\",\"type\":2,\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName contains '{SelectUserFree}'\\r\\n| distinct UserDisplayName\\r\\n| project UserDisplayName \\r\\n| order by UserDisplayName asc\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":5184000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"1407f53f-c0b3-4eae-a3a8-8d60c737fb4d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"selectedUserCount2\",\"label\":\"How many unique Users?\",\"type\":10,\"description\":\"1000 users max are shown\",\"isRequired\":true,\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName contains '{SelectUserFree}'\\r\\n| distinct UserDisplayName\\r\\n| summarize Count = strcat(count(),\\\" of 1000\\\")\",\"crossComponentResources\":[\"{Workspace}\"],\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":7776000000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"Select\",\"comparison\":\"isEqualTo\",\"value\":\"free\"},\"name\":\"parameters - 12\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Workspace}\"],\"parameters\":[{\"id\":\"ba660562-9b21-4412-b2d7-cc12bb64c33d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectUser\",\"type\":1,\"description\":\"Only shows user from name or letter parameter - depending on Toggle\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| extend SelectUser = case( '{Select}' == \\\"name\\\"   , '{SelectUserName}',\\r\\n                            '{Select}' == \\\"letter\\\" , '{SelectUserLetter}',\\r\\n                            '{Select}' == \\\"free\\\"   , '{SelectUserwithin}',\\r\\n                            // else\\r\\n                            \\\"error\\\"\\r\\n                            )\\r\\n| limit 1\\r\\n| project SelectUser\",\"crossComponentResources\":[\"{Workspace}\"],\"isHiddenWhenLocked\":true,\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 12\"},{\"type\":1,\"content\":{\"json\":\"### Missing Input data Warning: diagnostics\\r\\n\\r\\nUser Name displayed, from the selected parameter: \\r\\n## {SelectUser}\\r\\n\\r\\n|Parameter|Value detected|\\r\\n|---|---|\\r\\n|Name|{SelectUserName}|\\r\\n|Letter|{SelectUserLetter}|\\r\\n|Free|{SelectUserFree}|\"},\"conditionalVisibility\":{\"parameterName\":\"SelectUser\",\"comparison\":\"isEqualTo\"},\"name\":\"text - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(location.city) \\r\\n| extend state_ = tostring(location.state) \\r\\n| extend countryOrRegion_ = tostring(location.region) \\r\\n| extend latitude_  = tostring(location.latitude)\\r\\n| extend longitude_ = tostring(location.longitude) \\r\\n| order by TimeGenerated asc, city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_, 1)\\r\\n| extend pLon = prev(longitude_, 1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(row_number() > 1,tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = distance_in,\\r\\n                       distanceTravelled2 = strcat(distance_in,' ','{Measurement}'),\\r\\n                       latitude_,\\r\\n                       longitude_\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",\"size\":0,\"showAnalytics\":true,\"title\":\"Map showing locations for user: '{SelectUser}'\",\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"Namespace\",\"parameterName\":\"Namespace\",\"defaultValue\":\"All\"},{\"parameterName\":\"SelectedUsers\",\"parameterType\":1}],\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"map\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"distanceTravelled\",\"sizeAggregation\":\"Sum\",\"opacity\":0.7,\"labelSettings\":\"City\",\"legendMetric\":\"distanceTravelled\",\"numberOfMetrics\":10,\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"distanceTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"categorical\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"extend a = parse_json('{SelectedUsers}')\\r\\n| project  ['User']='{SelectUser}', ['city']=a.regionName, ['latitude']=a.latitude, ['longitude']=a.longitude\\r\\n| limit 1\",\"size\":4,\"title\":\"Please select a map region for more details\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"]},\"customWidth\":\"50\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let data = \\r\\nOnePasswordEventLogs_CL\\r\\n| where log_source == 'signinattempts'\\r\\n  and tostring(target_user.name) in ('{SelectUser}');\\r\\ndata\\r\\n| summarize count() by tostring(target_user.name), bin (TimeGenerated,1h)\",\"size\":1,\"title\":\"'{SelectUser}': Sign-in pattern\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"areachart\"},\"name\":\"query - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| where target_user.name == '{SelectUser}'\\r\\n| extend city_  = tostring(location.city) \\r\\n| extend state_ = tostring(location.state) \\r\\n| extend countryOrRegion_ = tostring(location.region) \\r\\n| extend latitude_  = tostring(location.latitude)\\r\\n| extend longitude_ = tostring(location.longitude)\\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(row_number() > 1,tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),strcat(\\\"FirstLocation\\\",' ','({Measurement})') ) \\r\\n| extend dwell_in = datetime_diff(\\\"second\\\",TimeGenerated, prev(TimeGenerated))\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| extend\\r\\n    UserDisplayName = tostring(target_user.name)\\r\\n    , City = city_\\r\\n    , State = state_\\r\\n    , location = location.country\\r\\n    , IPAddress = tostring(client.ip_address)\\r\\n    , ClientAppUsed = tostring(client.app_version)\\r\\n    , AppDisplayName = tostring(client.app_name)\\r\\n| extend ResourceGroup = 'Microsoft.aadiam'\\r\\n| summarize by TimeGenerated,\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       State = state_,\\r\\n                       Location=countryOrRegion_, \\r\\n                       visitOrder = row_number(),\\r\\n                       distanceBetweenLocations = distance_in, // strcat(distance_in,' ','({Measurement})')\\r\\n                       dwell_in, IPAddress, ResourceGroup, AppDisplayName, ClientAppUsed\\r\\n| order by TimeGenerated asc, visitOrder asc\",\"size\":1,\"showAnalytics\":true,\"title\":\"Looking for '{SelectUser}' - click a row for more IP detail\",\"color\":\"green\",\"timeContextFromParameter\":\"TimeRange\",\"exportedParameters\":[{\"fieldName\":\"Namespace\",\"parameterName\":\"Namespace\",\"defaultValue\":\"All\"},{\"fieldName\":\"IPAddress\",\"parameterName\":\"ipAddress\",\"parameterType\":1},{\"fieldName\":\"ResourceGroup\",\"parameterName\":\"resourceGroup\",\"parameterType\":1}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"distanceBetweenLocations\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"}},{\"columnMatch\":\"dwell_in\",\"formatter\":8,\"formatOptions\":{\"palette\":\"greenRed\"},\"numberFormat\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumSignificantDigits\":3}}},{\"columnMatch\":\"ResourceGroup\",\"formatter\":5},{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\"},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\"}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"visitOrder\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"visitOrder\",\"sortOrder\":1}],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"name\":\"query - get User details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"headers\\\":[],\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Workspace:subscriptionid}/resourceGroups/Microsoft.aadiam/providers/Microsoft.SecurityInsights/enrichment/ip/geodata/?ipaddress={ipAddress}&api-version=2021-09-01-preview\\\",\\\"urlParams\\\":[],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$\\\",\\\"columns\\\":[]}}]}\\r\\n\",\"size\":4,\"title\":\"🖧 Lookup IP Address: {ipAddress} from Microsoft geoLocation api\",\"queryType\":12,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"country\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"Globe\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ipAddr\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"gray\",\"text\":\"{0}{1}\"}]}}]}},\"conditionalVisibility\":{\"parameterName\":\"ipAddress\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - geoLocation api\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IP_Data = external_data(network:string,geoname_id:long,continent_code:string,continent_name:string ,country_iso_code:string,country_name:string,is_anonymous_proxy:bool,is_satellite_provider:bool)\\r\\n    ['https://raw.githubusercontent.com/datasets/geoip2-ipv4/master/data/geoip2-ipv4.csv']\\r\\n    with (ignoreFirstRecord=true, format=\\\"csv\\\");\\r\\nIP_Data\\r\\n| evaluate ipv4_lookup(IP_Data, '{ipAddress}', network)\\r\\n| summarize arg_max(network,*) by '{ipAddress}'\\r\\n| extend IPaddress = '{ipAddress}'\\r\\n| project-away *1\\r\\n| project-reorder IPaddress\\r\\n\\r\\n\",\"size\":4,\"title\":\"🖧  Lookup IP Address: {ipAddress} from GeoIP2\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IPaddress\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"representation\":\"gray\",\"text\":\"{0}{1}\"}]}}]}},\"conditionalVisibility\":{\"parameterName\":\"ipAddress\",\"comparison\":\"isNotEqualTo\"},\"name\":\"query - ip lookup GeoIP2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName !=\\\"On-Premises Directory Synchronization Service Account\\\"\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(location.city) \\r\\n| extend state_ = tostring(location.state) \\r\\n| extend countryOrRegion_ = tostring(location.region) \\r\\n| extend latitude_  = tostring(location.latitude)\\r\\n| extend longitude_ = tostring(location.longitude)  \\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(isnotempty(pLat),tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = strcat(distance_in,' ','{Measurement}')\\r\\n//| top {Top} by City\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\\r\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\" '{SelectUser}' : Cities visitied\",\"color\":\"green\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Namespace\",\"exportParameterName\":\"Namespace\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"unstackedbar\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"chartSettings\":{\"group\":\"City\",\"createOtherGroup\":10,\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - by Location  - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend city_  = tostring(location.city) \\r\\n| extend state_ = tostring(location.state) \\r\\n| extend countryOrRegion_ = tostring(location.region) \\r\\n| extend latitude_  = tostring(location.latitude)\\r\\n| extend longitude_ = tostring(location.longitude)\\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(isnotempty(pLat),tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = strcat(distance_in,' ','{Measurement}')\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",\"size\":1,\"showAnalytics\":true,\"title\":\" '{SelectUser}' : distance travelled\",\"color\":\"green\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Namespace\",\"exportParameterName\":\"Namespace\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"unstackedbar\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"chartSettings\":{\"group\":\"distanceTravelled\",\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - by Location \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where target_user.name == '{SelectUser}'\\r\\n| extend city_  = tostring(location.city) \\r\\n| extend state_ = tostring(location.state) \\r\\n| extend countryOrRegion_ = tostring(location.region) \\r\\n| extend latitude_  = tostring(location.latitude)\\r\\n| extend longitude_ = tostring(location.longitude)\\r\\n| order by TimeGenerated asc , city_ asc\\r\\n| serialize \\r\\n| extend pLat = prev(latitude_,1)\\r\\n| extend pLon = prev(longitude_,1)\\r\\n| extend distanceType = iif('{Measurement}' == \\\"KM\\\", todouble(1000), todouble(1609.344))\\r\\n| extend distance_in = iif(isnotempty(pLat),tostring(round(geo_distance_2points(todouble(longitude_), todouble(latitude_), todouble(pLon), todouble(pLat))/distanceType ,2)),\\\"FirstLocation\\\")\\r\\n| where distance_in !=\\\"0.0\\\"\\r\\n| summarize by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       UserDisplayName,\\r\\n                       City=city_ ,\\r\\n                       CountryorRegion=countryOrRegion_, \\r\\n                       visitedInThisOrder = row_number(),\\r\\n                       distanceTravelled = strcat(distance_in,' ','{Measurement}')\\r\\n| order by TimeGenerated asc, visitedInThisOrder asc\",\"size\":4,\"showAnalytics\":true,\"title\":\" '{SelectUser}' : Regions visitied \",\"color\":\"green\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Namespace\",\"exportParameterName\":\"Namespace\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"chartSettings\":{\"group\":\"CountryorRegion\",\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - by Location  - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n| extend applicationName_ = tostring(client.app_name)\\r\\n| where applicationName_ notcontains \\\"SCIM\\\"\\r\\n| order by TimeGenerated asc , applicationName_\\r\\n| summarize count() by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       ApplicationName=applicationName_ \\r\\n| order by count_ desc\",\"size\":4,\"showAnalytics\":true,\"title\":\"'{SelectUser}' : Used Application by most frequent\",\"color\":\"green\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Namespace\",\"exportParameterName\":\"Namespace\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"chartSettings\":{\"group\":\"ApplicationName\",\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - by Location  - All User - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"OnePasswordEventLogs_CL\\r\\n| where log_source contains \\\"signinattempts\\\"\\r\\n| extend UserDisplayName = tostring(target_user.name)\\r\\n| where UserDisplayName == '{SelectUser}'\\r\\n//| where category != \\\"success\\\"\\r\\n| extend actiontype_ = tostring(action_type)\\r\\n| order by TimeGenerated asc, category asc\\r\\n| summarize count() by bin(TimeGenerated, {TimeRange:grain}),\\r\\n                       Category=category \\r\\n| order by count_ desc\",\"size\":4,\"showAnalytics\":true,\"title\":\"'{SelectUser}' : Authentication\",\"color\":\"green\",\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Namespace\",\"exportParameterName\":\"Namespace\",\"exportDefaultValue\":\"All\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Table Entries\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"green\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"Table Size Trend\",\"formatter\":9,\"formatOptions\":{\"min\":0,\"palette\":\"blue\",\"showIcon\":true}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"visit_order\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":false},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"UserDisplayName\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\",\"showIcon\":true}},\"centerContent\":{\"columnMatch\":\"count_\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"userNameLocation\",\"sourceIdField\":\"TimeGenerated\",\"targetIdField\":\"MilesTravelled\",\"staticNodeSize\":100,\"hivesMargin\":5},\"chartSettings\":{\"group\":\"Category\",\"showMetrics\":false,\"showLegend\":true},\"mapSettings\":{\"locInfo\":\"LatLong\",\"latitude\":\"latitude_\",\"longitude\":\"longitude_\",\"sizeSettings\":\"MilesTravelled\",\"sizeAggregation\":\"Sum\",\"labelSettings\":\"visit_order\",\"legendMetric\":\"MilesTravelled\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"nodeColorField\":\"MilesTravelled\",\"colorAggregation\":\"Sum\",\"type\":\"heatmap\",\"heatmapPalette\":\"redDark\"}}},\"customWidth\":\"50\",\"name\":\"query - 6 - by Location  - All User - Copy - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"UserData\"},\"name\":\"group - UserMap\"}],\"fromTemplateId\":\"sentinel-UserWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": ".description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject1').analyticRuleTemplateSpecName1]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password - Manual Account Creation_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject1').analyticRuleVersion1]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert when a new account was created manually within 1Password. This should only be used when a 1Password integration via a SCIM Bridge has been implemented.\n\nRef: https://support.1password.com/scim/\nRef: https://1password.com/\nRef: https://github.com/securehats/",
                "displayName": "1Password - Manual account creation",
                "enabled": false,
                "query": "OnePasswordEventLogs_CL\n| where actor_details.email !endswith \"@1passwordserviceaccounts.com\"\n| where action == \"create\"\n    and object_type == \"invite\"\n| extend\n    TargetUsername = target_user.email\n    , SrcIpAddr = client.ip_address",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT5M",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": "[variables('TemplateEmptyArray')]",
                "tactics": [
                  "Persistence"
                ],
                "techniques": [
                  "T1136"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "TargetUsername"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SrcIpAddr"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [],
                    "matchingMethod": "AllEntities",
                    "groupByCustomDetails": [],
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5m",
                    "groupByAlertDetails": []
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject1').analyticRuleId1,'/'))))]",
              "properties": {
                "description": "1Password Analytics Rule 1",
                "parentId": "[variables('analyticRuleObject1').analyticRuleId1]",
                "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject1').analyticRuleVersion1]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
        "contentKind": "AnalyticsRule",
        "displayName": "1Password - Manual account creation",
        "contentProductId": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "id": "[variables('analyticRuleObject1')._analyticRulecontentProductId1]",
        "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject2').analyticRuleTemplateSpecName2]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password - Secret Extraction Post Vault Access Change By Administrator_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject2').analyticRuleVersion2]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert when a secret extraction has occurred after an administrator has changed their own vault access permissions within that same vault.\nRef: https://1password.com/\nRef: https://github.com/securehats/",
                "displayName": "1Password - Secret extraction post vault access change by administrator",
                "enabled": false,
                "query": "let ruleFrequency = 5m;\nlet lookback = 1h;\nlet secretExtractionActivity =\n    OnePasswordEventLogs_CL\n    | where TimeGenerated between (ago(lookback) .. ago(now() - ago(ruleFrequency)))\n    | where log_source == \"itemusages\"\n    | where action has_any(\"server-fetch\", \"reveal\", \"secure-copy\")\n;\nOnePasswordEventLogs_CL\n| where log_source == \"auditevents\"\n| where (action == \"grant\" and object_type  == \"uva\") or (action == \"update\" and object_type  == \"uva\")\n| where tostring(actor_details.uuid) == tostring(aux_details.uuid)\n| extend\n    userUuid = tostring(actor_details.uuid)\n    , vaultUuid = tostring(object_uuid)\n| join (\n    secretExtractionActivity\n    | extend\n        userUuid = tostring(user.uuid)\n        , vaultUuid = tostring(vault_uuid)\n    )\n    on $left.userUuid == $right.userUuid and $left.vaultUuid == $right.vaultUuid\n| extend\n    auditevents = bag_pack(\"action\", action, \"object_type\", object_type)\n    , itemusages = bag_pack(\"action\", action1, \"object_type\", object_type1)\n    , vault_details = bag_pack(\"vault_uuid\", vault_uuid1, \"item_uuid\", item_uuid1)\n| project\n    TimeGenerated\n    , actor_details\n    , target_details = aux_details\n    , location_details = location\n    , client_details = client1\n    , auditevents\n    , itemusages\n    , vault_details\n    , TargetUsername = tostring(user1.email)\n    , SrcIpAddr = tostring(client1.ip_address)",
                "queryFrequency": "PT5M",
                "queryPeriod": "PT1H",
                "severity": "High",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": "[variables('TemplateEmptyArray')]",
                "tactics": [
                  "CredentialAccess"
                ],
                "techniques": [
                  "T1555"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "TargetUsername"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SrcIpAddr"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [],
                    "matchingMethod": "AllEntities",
                    "groupByCustomDetails": [],
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "groupByAlertDetails": []
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject2').analyticRuleId2,'/'))))]",
              "properties": {
                "description": "1Password Analytics Rule 2",
                "parentId": "[variables('analyticRuleObject2').analyticRuleId2]",
                "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject2').analyticRuleVersion2]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
        "contentKind": "AnalyticsRule",
        "displayName": "1Password - Secret extraction post vault access change by administrator",
        "contentProductId": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "id": "[variables('analyticRuleObject2')._analyticRulecontentProductId2]",
        "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject3').analyticRuleTemplateSpecName3]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password - Successful Anomalous SignIn_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject3').analyticRuleVersion3]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert when a new successful MFA confirmed sign-in has occurred from a location that was not seen within the last 14 days.\nRef: https://1password.com/\nRef: https://github.com/securehats/",
                "displayName": "1Password - Successful anomalous sign-in",
                "enabled": false,
                "query": "let ruleFrequency = 1h;\nlet lookback = 14d;\nlet onePasswordSigninBaseline =\n    OnePasswordEventLogs_CL\n    | where TimeGenerated between (ago(lookback) .. ago(now() - ago(ruleFrequency)))\n    | where log_source == \"signinattempts\"\n    | where (category == \"success\" and action_type == \"mfa_ok\") or (category == \"success\" and action_type == \"credentials_ok\")\n    | summarize count() by tostring(target_user.uuid), tostring(target_user.email), tostring(client.ip_address), tostring(location.country)\n    | extend identifier = strcat(target_user_uuid, client_ip_address)\n    | summarize make_list(identifier)\n;\nOnePasswordEventLogs_CL\n| where log_source == \"signinattempts\"\n| where (category == \"success\" and action_type == \"mfa_ok\") or (category == \"success\" and action_type == \"credentials_ok\")\n| extend identifier = strcat(target_user.uuid, client.ip_address)\n| where identifier !in (onePasswordSigninBaseline)\n| extend\n    TargetUsername = target_user.email\n    , SrcIpAddr = client.ip_address",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": "[variables('TemplateEmptyArray')]",
                "tactics": [
                  "InitialAccess"
                ],
                "techniques": [
                  "T1078"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "TargetUsername"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SrcIpAddr"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "alertDetailsOverride": {
                  "alertDynamicProperties": []
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [],
                    "matchingMethod": "AllEntities",
                    "groupByCustomDetails": [],
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "groupByAlertDetails": []
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject3').analyticRuleId3,'/'))))]",
              "properties": {
                "description": "1Password Analytics Rule 3",
                "parentId": "[variables('analyticRuleObject3').analyticRuleId3]",
                "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject3').analyticRuleVersion3]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
        "contentKind": "AnalyticsRule",
        "displayName": "1Password - Successful anomalous sign-in",
        "contentProductId": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "id": "[variables('analyticRuleObject3')._analyticRulecontentProductId3]",
        "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject4').analyticRuleTemplateSpecName4]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password - Vault Export Post Account Creation_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject4').analyticRuleVersion4]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert when a successful vault export has occurred within 14 days of a new account being created within 1Password.\nRef: https://1password.com/\nRef: https://github.com/securehats/",
                "displayName": "1Password - Vault export post account creation",
                "enabled": false,
                "query": "let ruleFrequency = 1h;\nlet lookback = 14d;\nlet onePasswordUserCreationCheck =\n    OnePasswordEventLogs_CL\n    | where TimeGenerated between (ago(lookback) .. ago(now() - ago(ruleFrequency)))\n    | extend creationActivityFound = iff(action == \"activate\" and object_type == \"user\", bool(1), bool(0))\n;\nOnePasswordEventLogs_CL\n| where action == \"export\" and object_type == \"vault\"\n| extend userUuid = tostring(actor_details.uuid)\n| join (\n    onePasswordUserCreationCheck\n    | where creationActivityFound == true\n    | extend userUuid = tostring(object_details.uuid)\n    )\n    on $left.userUuid == $right.userUuid\n| extend\n    TargetUsername = object_details1.email\n    , SrcIpAddr = session1.ip_address",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": "[variables('TemplateEmptyArray')]",
                "tactics": [
                  "CredentialAccess",
                  "Persistence"
                ],
                "techniques": [
                  "T1555",
                  "T1136"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "TargetUsername"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SrcIpAddr"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [],
                    "matchingMethod": "AllEntities",
                    "groupByCustomDetails": [],
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "groupByAlertDetails": []
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject4').analyticRuleId4,'/'))))]",
              "properties": {
                "description": "1Password Analytics Rule 4",
                "parentId": "[variables('analyticRuleObject4').analyticRuleId4]",
                "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject4').analyticRuleVersion4]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
        "contentKind": "AnalyticsRule",
        "displayName": "1Password - Vault export post account creation",
        "contentProductId": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "id": "[variables('analyticRuleObject4')._analyticRulecontentProductId4]",
        "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject5').analyticRuleTemplateSpecName5]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password - Vault export prior to account suspension or deletion_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject5').analyticRuleVersion5]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert when a successful vault export has occurred within the last 14 days prior to an account being suspended or deleted from 1Password.\nRef: https://1password.com/\nRef: https://github.com/securehats/",
                "displayName": "1Password - Vault export prior to account suspension or deletion",
                "enabled": false,
                "query": "let ruleFrequency = 1h;\nlet lookback = 14d;\nlet onePasswordVaultExportCheck =\n    OnePasswordEventLogs_CL\n    | where TimeGenerated between (ago(lookback) .. ago(now() - ago(ruleFrequency)))\n    | where action == \"export\" and object_type == \"vault\"\n;\nOnePasswordEventLogs_CL\n| where (action == \"suspend\" and object_type == \"user\") or (action == \"delete\" and object_type == \"user\")\n| extend\n    userUuid = tostring(object_details.uuid)\n    , auditevents = bag_pack(\"action\", action, \"object_type\", object_type)\n| join (\n    onePasswordVaultExportCheck\n    | extend userUuid = tostring(actor_details.uuid)\n    )\n    on $left.userUuid == $right.userUuid\n| extend\n    TargetUsername = actor_details1.email\n    , SrcIpAddr = session1.ip_address\n| project\n    TimeGenerated\n    , auditevents\n    , actor_details\n    , location_details = location\n    , session_details = session\n    , exported_vault = object_details\n    , TargetUsername\n    , SrcIpAddr",
                "queryFrequency": "PT1H",
                "queryPeriod": "P14D",
                "severity": "Medium",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": "[variables('TemplateEmptyArray')]",
                "tactics": [
                  "CredentialAccess"
                ],
                "techniques": [
                  "T1555"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "TargetUsername"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SrcIpAddr"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": true,
                    "groupByEntities": [],
                    "matchingMethod": "AllEntities",
                    "groupByCustomDetails": [],
                    "reopenClosedIncident": false,
                    "lookbackDuration": "1h",
                    "groupByAlertDetails": []
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject5').analyticRuleId5,'/'))))]",
              "properties": {
                "description": "1Password Analytics Rule 5",
                "parentId": "[variables('analyticRuleObject5').analyticRuleId5]",
                "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject5').analyticRuleVersion5]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
        "contentKind": "AnalyticsRule",
        "displayName": "1Password - Vault export prior to account suspension or deletion",
        "contentProductId": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "id": "[variables('analyticRuleObject5')._analyticRulecontentProductId5]",
        "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('analyticRuleObject6').analyticRuleTemplateSpecName6]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "1Password - Vault Export_AnalyticalRules Analytics Rule with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('analyticRuleObject6').analyticRuleVersion6]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.SecurityInsights/AlertRuleTemplates",
              "name": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "apiVersion": "2022-04-01-preview",
              "kind": "Scheduled",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "description": "This will alert when a successful vault export has occurred within 1Password.\nRef: https://1password.com/\nRef: https://github.com/securehats/",
                "displayName": "1Password - Vault export",
                "enabled": false,
                "query": "OnePasswordEventLogs_CL\n| where action == \"export\" and object_type == \"vault\"\n| extend\n    TargetUsername = actor_details.email\n    , SrcIpAddr = session.ip",
                "queryFrequency": "PT1H",
                "queryPeriod": "PT1H",
                "severity": "Low",
                "suppressionDuration": "PT1H",
                "suppressionEnabled": false,
                "triggerOperator": "GreaterThan",
                "triggerThreshold": 0,
                "status": "Available",
                "requiredDataConnectors": "[variables('TemplateEmptyArray')]",
                "tactics": [
                  "CredentialAccess"
                ],
                "techniques": [
                  "T1555"
                ],
                "entityMappings": [
                  {
                    "entityType": "Account",
                    "fieldMappings": [
                      {
                        "identifier": "FullName",
                        "columnName": "TargetUsername"
                      }
                    ]
                  },
                  {
                    "entityType": "IP",
                    "fieldMappings": [
                      {
                        "identifier": "Address",
                        "columnName": "SrcIpAddr"
                      }
                    ]
                  }
                ],
                "eventGroupingSettings": {
                  "aggregationKind": "SingleAlert"
                },
                "incidentConfiguration": {
                  "groupingConfiguration": {
                    "enabled": false,
                    "groupByEntities": [],
                    "matchingMethod": "AllEntities",
                    "groupByCustomDetails": [],
                    "reopenClosedIncident": false,
                    "lookbackDuration": "5h",
                    "groupByAlertDetails": []
                  },
                  "createIncident": true
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('AnalyticsRule-', last(split(variables('analyticRuleObject6').analyticRuleId6,'/'))))]",
              "properties": {
                "description": "1Password Analytics Rule 6",
                "parentId": "[variables('analyticRuleObject6').analyticRuleId6]",
                "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
                "kind": "AnalyticsRule",
                "version": "[variables('analyticRuleObject6').analyticRuleVersion6]",
                "source": {
                  "kind": "Solution",
                  "name": "1Password",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "1Password"
                },
                "support": {
                  "name": "1Password",
                  "tier": "1Password",
                  "link": "https://support.1password.com/"
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
        "contentKind": "AnalyticsRule",
        "displayName": "1Password - Vault export",
        "contentProductId": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "id": "[variables('analyticRuleObject6')._analyticRulecontentProductId6]",
        "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "1Password",
        "publisherDisplayName": "1Password",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The <a href=\"https://www.1password.com\">1Password</a> solution for Microsoft Sentinel enables you to ingest 1Password logs and events into Microsoft Sentinel. The connector provides visibility into 1Password Events and Alerts in Microsoft Sentinel to improve monitoring and investigation capabilities.</p>\n<p><strong>Underlying Microsoft Technologies used:</strong></p>\n<p>This solution takes a dependency on the following technologies, and some of these dependencies either may be in <a href=\"https://azure.microsoft.com/support/legal/preview-supplemental-terms/\">Preview</a> state or might result in additional ingestion or operational costs:</p>\n<ul>\n<li><a href=\"https://azure.microsoft.com/services/functions/#overview\">Azure Functions</a></li>\n</ul>\n<p><strong>Data Connectors:</strong> 1, <strong>Workbooks:</strong> 1, <strong>Analytic Rules:</strong> 6</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Azure_Sentinel.svg\" width=\"75px\" height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "1Password",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "1Password"
        },
        "support": {
          "name": "1Password",
          "tier": "1Password",
          "link": "https://support.1password.com/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject1')._analyticRulecontentId1]",
              "version": "[variables('analyticRuleObject1').analyticRuleVersion1]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject2')._analyticRulecontentId2]",
              "version": "[variables('analyticRuleObject2').analyticRuleVersion2]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject3')._analyticRulecontentId3]",
              "version": "[variables('analyticRuleObject3').analyticRuleVersion3]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject4')._analyticRulecontentId4]",
              "version": "[variables('analyticRuleObject4').analyticRuleVersion4]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject5')._analyticRulecontentId5]",
              "version": "[variables('analyticRuleObject5').analyticRuleVersion5]"
            },
            {
              "kind": "AnalyticsRule",
              "contentId": "[variables('analyticRuleObject6')._analyticRulecontentId6]",
              "version": "[variables('analyticRuleObject6').analyticRuleVersion6]"
            }
          ]
        },
        "firstPublishDate": "2023-12-01",
        "providers": [
          "1Password"
        ],
        "categories": {
          "domains": [
            "Security - Identity & Access Management"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
