{
    "name": "1PasswordDCR",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
        "dataCollectionEndpointId": "[format('{0}/providers/Microsoft.Insights/dataCollectionEndpoints/{1}', resourceGroup().id, parameters('workspace'))]",
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace'))]",
                    "name": "[parameters('workspace')]"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-OnePasswordEventLogs_CL"
                ],
                "destinations": [
                    "[parameters('workspace')]"
                ],
                "outputStream": "Custom-OnePasswordEventLogs_CL",
                "transformKql": "source | extend TimeGenerated = now(), log_source = case(isnotempty(used_version) or isnotempty(aux_id), 'itemusages', isnotempty(country), 'signinattempts', isempty(used_version) and isempty(aux_id) and isempty(country), 'auditevents', 'unknown')"
            }
        ]
    }
}