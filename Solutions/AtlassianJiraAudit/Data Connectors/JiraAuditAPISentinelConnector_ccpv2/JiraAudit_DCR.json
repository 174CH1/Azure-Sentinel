{
    "name": "AtlassianJIRADCR",
    "apiVersion": "2021-09-01-preview",
    "type": "Microsoft.Insights/dataCollectionRules",
    "location": "{{location}}",
    "properties": {
        "dataCollectionEndpointId": "{{dataCollectionEndpointId}}",
        "streamDeclarations": {
            "Custom-Jira_Audit_v2_CL": {
                "columns": [
                    {
                        "name": "id",
                        "type": "int"
                    },
                    {
                        "name": "summary",
                        "type": "string"
                    },
                    {
                        "name": "created",
                        "type": "datetime"
                    },
                    {
                        "name": "category",
                        "type": "string"
                    },
                    {
                        "name": "eventSource",
                        "type": "string"
                    },
                    {
                        "name": "objectItem",
                        "type": "dynamic"
                    },
                    {
                        "name": "changedValues",
                        "type": "dynamic"
                    },
                    {
                        "name": "associatedItems",
                        "type": "dynamic"
                    },
                    {
                        "name": "remoteAddress",
                        "type": "string"
                    },
                    {
                        "name": "authorKey",
                        "type": "string"
                    },
                    {
                        "name": "authorAccountId",
                        "type": "string"
                    }
                ]
            }
        },
        "destinations": {
            "logAnalytics": [
                {
                    "workspaceId": "{{workspaceResourceId}}",
                    "name": "clv2ws1"
                }
            ]
        },
        "dataFlows": [
            {
                "streams": [
                    "Custom-Jira_Audit_v2_CL"
                ],
                "destinations": [
                    "clv2ws1"
                ],
                "transformKql": "source\n| extend\n        TimeGenerated = now(),\n        EventVendor=\"Atlassian\",\n        EventProduct=\"Jira Audit\",\n        EventId=id,\n        EventMessage=summary,\n        SrcIpAddr=remoteAddress,\n        UserName=authorKey,\n        UserSid=authorAccountId,\n        EventCreationTime=created,\n        EventSource=eventSource,\n        ObjectItemId=objectItem.id,\n        ObjectItemName=objectItem.name,\n        ObjectItemTypeName=objectItem.typeName,\n        ChangedValues=changedValues,\n        AssociatedItems=associatedItems,\n        ObjectItemParentId=objectItem.parentId,\n        ObjectItemParentName=objectItem.parentName,\n        EventCategoryType= category\n               \n",
                "outputStream": "Custom-Jira_Audit_v2_CL"
            }
        ]
    }
}